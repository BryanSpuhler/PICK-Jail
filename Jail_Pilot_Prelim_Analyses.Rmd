---
title: "Jail Pilot Mixed Methods Evaluation"
subtitle: "Preliminary Quantitative Analyses and Results"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  pdf_document: 
    toc: true
    toc_depth: 4
    number_sections: true
csl: apa.csl
fontsize: 11pt
mainfont: Century

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, comment = NA, tidy=TRUE, tidy.opts=list(width.cutoff=60))

library(tidyverse)
library(furniture)
library(corrplot)
library(psych)
library(ltm)

load(file="./Data/Jail_clean_long.Rda", verbose = FALSE)
load(file="./Data/Jail_clean_long2.Rda", verbose = FALSE)
load(file="./Data/Jail_clean_longlong.Rda", verbose = FALSE)
load(file="./Data/Jail_clean_longlong2.Rda", verbose = FALSE)
load(file="./Data/Jail_clean.Rda", verbose = FALSE)

## Set Seed (needed for parallel analysis)

set.seed(84322)

## tableM

tableM = function(.data, ..., resp.opts = NULL){
  
  ## Iniital objects
  .call      = match.call()
  list_vars  = eval(substitute(list(...)), .data)
  df         = do.call("data.frame", list_vars)
  df         = data.frame(df)
  names(df)  = paste(substitute(list(...)))[-1]

  final_list = list()
  
  ## Creating counts
  for(i in names(df)){
    
      var = df[i]
      ## Summary statistics
      Freq = table(var, useNA="ifany")

      ## If there is missing, add a blank line below the valids
      if (any(is.na(var))){
          names(Freq)[length(names(Freq))] = "Missing_Missing_Missing.Missing"
          final = data.frame("Var"     = names(Freq),
                             "Freq"    = as.character(Freq))
          names(final) = c("Value", i) 
          final[] = lapply(final, as.character)
      } else {
          final = data.frame("Var"     = names(Freq),
                             "Freq"    = as.character(Freq))
          names(final) = c("Value", i) 
          final[] = lapply(final, as.character)
      }
  
  final_list[[i]] = final
  
  }

  
  ## Join all count tables
  table.part0 <- purrr::reduce(final_list, dplyr::full_join, by = "Value")
  
  ## Replace NAs with 0.
  table.part0[is.na(table.part0)] <- 0
  ## Make counts numeric, but not labels
  table.part0[, c(2:ncol(table.part0))] <- sapply(table.part0[, c(2:ncol(table.part0))],
                                                  as.numeric)
  ## Removes row of missing values
  table.part1 <- table.part0[which(table.part0$Value != "Missing_Missing_Missing.Missing"),]
  ## Adds total (if no missing)/valid total (if missing; name changed below)
  table.part1 <- janitor::adorn_totals(table.part1, where = "row")
  
  # Different approaches are used based on whether there are missing data.      
  if('Missing_Missing_Missing.Missing' %in% table.part0$Value){
  
    # Changes "Total" to "Valid Total" in table.part1
    table.part1[nrow(table.part1),1] <- "Valid Total"
    # Caclulates total including missing
    table.part2 = janitor::adorn_totals(table.part0, where = "row")
    # Select "Missing" row and "Total" row
    table.part2 <-  table.part2[which(table.part2$Value == "Missing_Missing_Missing.Missing" | 
                                         table.part2$Value == "Total"),]
    # Rename "Missing" row
    table.part2[1,1] <- "Missing"
    # Combine table components
    table.final = rbind(table.part1, "---", table.part2)
    
  } else {
      
    table.final = table.part1
    
  }

  ## Adjusting response options (changing order). Must be spelled correctly. Can include extra levels.  
  if (!is.null(resp.opts)){ 
    if ('Missing' %in% table.final$Value){
      
      rownames(table.final) = table.final$Value
      table.final = table.final[c(resp.opts, "Valid Total", "---", "Missing", "Total"), ]
    
    } else {
      
      rownames(table.final) = table.final$Value
      table.final = table.final[c(resp.opts, "Total"), ]
  
    }
  }
  
  rownames(table.final) <- NULL
  table.final
    
}

# Source: https://stackoverflow.com/questions/12643391/how-to-remove-leading-0-in-a-numeric-r-variable

numformat_no0 <- function(val) { sub("^(-?)0.", "\\1.", sprintf("%.3f", val)) }

numformat <- function(val) {  noquote(formatC(val, format = "f", digits = 3)) }

pvaluer <- function(p) {
    if(p < .001){
        p_formatted = "*p* < .001"
    }
    else{
        p_formatted = paste0("*p* = ", numformat0(p))
    }
    
return(p_formatted)    
    }

pvaluer_anova <- function(p){

    p1 = noquote(formatC(p, format = "f", digits = 3))
    
    if(p1 < .001){
        p_formatted = "*p* < .001"
    }
    else{
        p_formatted = paste0("*p* = ", numformat0(p1))
    }
    
return(p_formatted)            
    
}




format_chi = function(chi){
    
    formatted_chi = noquote(formatC(chi, format = "f", digits = 2))
    return(formatted_chi)
    }



```

\newpage

# Data Summary

```{r, include=FALSE}
Jail_clean %>% 
        dplyr::mutate(Age_Decades = `Age (Decades)`) %>% 
    dplyr::mutate(Income_10K = `Income (10K)`) %>% 
    dplyr::mutate(in.analysis.sample1 = factor(in.analysis.sample1)) %>% 
    dplyr::select(Age, `Age (Decades)`, Age_Groups, 
                  Gender,
                  Ethnicity, Ethnicity_Dich,
                  TotalChildren,
                  Education, Ed_Recoded,
                  Education_Old, Education_collapsed, Education_3cat,
                  Religious,
                  Income, `Income (10K)`,
                  Div_Dich,
                  Married_Dich,
                  FinancialWorry, FinancialWorry_cat,
                  RelEd_Dich,
                  PeopleCareAbtMe, TalkToSomeoneITrust, FreedomAndFlexibility,
                  JailAffectsRelationChildren, JailAffectsRelationPartner,
                  HappyPerson, SatisfiedLife, SatisfiedRelationship, FeelLovedWanted, RelationshipsFullComplete,
                  
                  LoveSufficientMarriage_T1, LoveEnoughSustain_T1, FoolWalksAway_T1, 
                  PaceRelationshipSafe, SpotWarningSigns, WeighProsCons, 
                  KeepPartnerDoing_T1, ForbidPartnerTalking_T1, WouldNotStay_T1, 
                  
                  LoveSufficientMarriage_T2, LoveEnoughSustain_T2, FoolWalksAway_T2,
                  PaceRelationshipSafe_Before, PaceRelationshipSafe_After, SpotWarningSigns_Before,
                  SpotWarningSigns_After, WeighProsCons_Before, WeighProsCons_After, 
                  KeepPartnerDoing_T2, ForbidPartnerTalking_T2, WouldNotStay_T2, 
                  
                  WouldRecommend, InformationUseful, AnsweredQuestionsWell, 
                  ManagedTimeWell, AppreciatesMe, CaresLikesMe, Trustfacilitator, 
                  FreeAndFlex_Coded, 
                   
                  HappyPerson.n, SatisfiedLife.n, SatisfiedRelationship.n, 
                  FeelLovedWanted.n, RelationshipsFullComplete.n,
                  
                  LoveSufficientMarriage_T1.n, LoveEnoughSustain_T1.n, FoolWalksAway_T1.n, 
                  PaceRelationshipSafe.n, SpotWarningSigns.n, WeighProsCons.n, 
                  KeepPartnerDoing_T1.n, ForbidPartnerTalking_T1.n, WouldNotStay_T1.n, 
                  
                  LoveSufficientMarriage_T2.n, LoveEnoughSustain_T2.n, FoolWalksAway_T2.n,
                  PaceRelationshipSafe_Before.n, PaceRelationshipSafe_After.n, SpotWarningSigns_Before.n,
                  SpotWarningSigns_After.n, WeighProsCons_Before.n, WeighProsCons_After.n, 
                  KeepPartnerDoing_T2.n, ForbidPartnerTalking_T2.n, WouldNotStay_T2.n,
                  
                  
                  PWB_Summed2, PWB_Dich,   
                  WAI, BL_T1, BL_T2, VF_T1, VF_Before, VF_After, Control_T1, Control_T2, 
                  BL_Change, VF_Change, Control_Change, 
                  miss.change, miss.pre, miss.post, miss.scores, at.least.one.score, at.least.one.change.score,
                  in.analysis.sample1, in.analysis.sample2, in.analysis.sample3, Missing.preds                    
                  ) %>% 
    dplyr::glimpse()
```


## Means and Standard Deviations. Also Testing for Difference in Analytic Sample vs. Full Sample.

```{r, echo=FALSE}
Jail_clean %>% 
    dplyr::mutate(Age_Decades = `Age (Decades)`) %>% 
    dplyr::mutate(Income_10K = `Income (10K)`) %>% 
    dplyr::mutate(`In Analysis Sample` = factor(in.analysis.sample1)) %>% 
    dplyr::select(Age, `Age (Decades)`, Age_Groups, 
                  Gender,
                  Ethnicity, Ethnicity_Dich,
                  TotalChildren,
                  Education, Ed_Recoded,
                  Education_Old, Education_collapsed, Education_3cat,
                  Religious,
                  Income, `Income (10K)`,
                  Div_Dich,
                  Married_Dich,
                  FinancialWorry, FinancialWorry_cat,
                  RelEd_Dich,
                  
                  PWB_Summed2, PWB_Dich,   
                  WAI, BL_T1, BL_T2, VF_T1, VF_Before, VF_After, Control_T1, Control_T2, 
                  BL_Change, VF_Change, Control_Change,
                  
                  PeopleCareAbtMe, TalkToSomeoneITrust, FreedomAndFlexibility, FreeAndFlex_Coded,
                  JailAffectsRelationChildren, JailAffectsRelationPartner,
                  
                  WouldRecommend, InformationUseful, AnsweredQuestionsWell, 
                  ManagedTimeWell, AppreciatesMe, CaresLikesMe, Trustfacilitator, 
                  
                   
                  HappyPerson.n, SatisfiedLife.n, SatisfiedRelationship.n, 
                  FeelLovedWanted.n, RelationshipsFullComplete.n,
                  
                  LoveSufficientMarriage_T1.n, LoveEnoughSustain_T1.n, FoolWalksAway_T1.n, 
                  PaceRelationshipSafe.n, SpotWarningSigns.n, WeighProsCons.n, 
                  KeepPartnerDoing_T1.n, ForbidPartnerTalking_T1.n, WouldNotStay_T1.n, 
                  
                  LoveSufficientMarriage_T2.n, LoveEnoughSustain_T2.n, FoolWalksAway_T2.n,
                  PaceRelationshipSafe_Before.n, PaceRelationshipSafe_After.n, SpotWarningSigns_Before.n,
                  SpotWarningSigns_After.n, WeighProsCons_Before.n, WeighProsCons_After.n, 
                  KeepPartnerDoing_T2.n, ForbidPartnerTalking_T2.n, WouldNotStay_T2.n,
                  
                  `In Analysis Sample1`) %>% 
    furniture::table1(na.rm = FALSE,
                      digits = 2,
                      splitby = ~ `In Analysis Sample`,
                      test = TRUE)
```

\newpage

## Testing for Difference in a Larger Analytic Sample (Restricted to complete cases on significant predictors only and at least one outcome) vs. Full Sample.

```{r, echo=FALSE}


Jail_clean %>% 
    dplyr::mutate(Age_Decades = `Age (Decades)`) %>% 
    dplyr::mutate(Income_10K = `Income (10K)`) %>% 
    dplyr::mutate(`In Larger Analysis Sample` = factor(in.analysis.sample3)) %>% 
    dplyr::select(Age, `Age (Decades)`, Age_Groups, 
                  Gender,
                  Ethnicity, Ethnicity_Dich,
                  TotalChildren,
                  Education, Ed_Recoded,
                  Education_Old, Education_collapsed, Education_3cat,
                  Religious,
                  Income, `Income (10K)`,
                  Div_Dich,
                  Married_Dich,
                  FinancialWorry, FinancialWorry_cat,
                  RelEd_Dich,
                  
                  PWB_Summed2, PWB_Dich,   
                  WAI, BL_T1, BL_T2, VF_T1, VF_Before, VF_After, Control_T1, Control_T2, 
                  BL_Change, VF_Change, Control_Change,
                  
                  PeopleCareAbtMe, TalkToSomeoneITrust, FreedomAndFlexibility, FreeAndFlex_Coded,
                  JailAffectsRelationChildren, JailAffectsRelationPartner,
                  
                  WouldRecommend, InformationUseful, AnsweredQuestionsWell, 
                  ManagedTimeWell, AppreciatesMe, CaresLikesMe, Trustfacilitator, 
                  
                   
                  HappyPerson.n, SatisfiedLife.n, SatisfiedRelationship.n, 
                  FeelLovedWanted.n, RelationshipsFullComplete.n,
                  
                  LoveSufficientMarriage_T1.n, LoveEnoughSustain_T1.n, FoolWalksAway_T1.n, 
                  PaceRelationshipSafe.n, SpotWarningSigns.n, WeighProsCons.n, 
                  KeepPartnerDoing_T1.n, ForbidPartnerTalking_T1.n, WouldNotStay_T1.n, 
                  
                  LoveSufficientMarriage_T2.n, LoveEnoughSustain_T2.n, FoolWalksAway_T2.n,
                  PaceRelationshipSafe_Before.n, PaceRelationshipSafe_After.n, SpotWarningSigns_Before.n,
                  SpotWarningSigns_After.n, WeighProsCons_Before.n, WeighProsCons_After.n, 
                  KeepPartnerDoing_T2.n, ForbidPartnerTalking_T2.n, WouldNotStay_T2.n,
                  
                  `In Larger Analysis Sample`) %>% 
    furniture::table1(na.rm = FALSE,
                      digits = 2,
                      splitby = ~`In Larger Analysis Sample`,
                      test = TRUE)
```

\newpage

## Continuous Outcomes: Means and Standard Deviations. Also Testing for Difference in Analytic Sample vs. Full Sample.


```{r, echo=FALSE}
Jail_clean %>% 
    dplyr::mutate(Age_Decades = `Age (Decades)`) %>% 
    dplyr::mutate(Income_10K = `Income (10K)`) %>% 
    dplyr::mutate(`In Analysis Sample3` = factor(in.analysis.sample3)) %>% 
    dplyr::select(Age_Decades,
                  Age_Groups,
                  Ethnic_Code, 
                  Education_3cat,
                  # Income,
                  Income_10K,
                  Gender,
                  Divorced_Dichotomous,
                  FinancialWorry_cat,
                  # Prior_RshpEducation,
                  Prior_RshpEducation_collapsed,
                  Number_Attended,
                  Dosage,
                  Healthy_Rel_Skills_Before,
                  Partner_Selection_Before,
                  Past_Rel_Behav_Before,
                  Rel_Behav_Attit_Before,
                  Healthy_Rel_Skills,
                  Partner_Selection,
                  Past_Rel_Behav,
                  Rel_Behav_Attit,
                  
                  `In Analysis Sample3`) %>% 
    furniture::table1(na.rm = FALSE,
                      digits = 2,
                      splitby = ~ `In Analysis Sample3`,
                      test = TRUE)
```




\newpage
## Categorical Outcomes: Means and Standard Deviations. Also Testing for Difference in Analytic Sample vs. Full Sample.



```{r, echo=FALSE}
Jail_clean %>% 
    dplyr::mutate(Age_Decades = `Age (Decades)`) %>% 
    dplyr::mutate(Income_10K = `Income (10K)`) %>% 
    dplyr::mutate(`In Analysis Sample3` = factor(in.analysis.sample3)) %>% 
    dplyr::select(Age_Decades,
                  Age_Groups,
                  Ethnic_Code, 
                  Education_3cat,
                  # Income,
                  Income_10K,
                  Gender,
                  Divorced_Dichotomous,
                  FinancialWorry_cat,
                  # Prior_RshpEducation,
                  Prior_RshpEducation_collapsed,
                  Number_Attended,
                  Dosage,
                  

                  Healthy_Rel_Before.3c, Communicate_Before.3c, ConflictManagement_Before.3c,
                  Healthy_Rel.3c, Communicate.3c, ConflictManagement.3c,
                  
                  RightPartner_Before.3c, LearnPartner_Before.3c, 
                  PaceRelationship_Before.3c, WarningSigns_Before.3c,
                  RightPartner.3c, LearnPartner.3c, 
                  PaceRelationship.3c, WarningSigns.3c,
                  
                  LearnedGrowingUp_Before.3c, PastRelationships_Before.3c, 
                  GetAlongParents_Before.3c, FriendshipsAreLike_Before.3c,
                  LearnedGrowingUp.3c, PastRelationships.3c, 
                  GetAlongParents.3c, FriendshipsAreLike.3c,
                  
                  Fights_Before.3c, FeelingsHurt_Before.3c, RightandWrong_Before.3c,
                  Fights.3c, FeelingsHurt.3c, RightandWrong.3c,
                  
                  `In Analysis Sample3`) %>% 
    furniture::table1(na.rm = FALSE,
                      digits = 2,
                      splitby = ~ `In Analysis Sample3`,
                      test = TRUE)
```

\newpage

## Correlations

### Outcomes

#### Retrospective Pre-Program Item-Level

&nbsp;

```{r, echo = FALSE}
Jail_clean_outcome_pre_corr <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>%
    dplyr::select(Healthy_Rel_Before.n, Communicate_Before.n, ConflictManagement_Before.n,

                  RightPartner_Before.n, LearnPartner_Before.n, 
                  PaceRelationship_Before.n, WarningSigns_Before.n,

                  LearnedGrowingUp_Before.n, PastRelationships_Before.n, 
                  GetAlongParents_Before.n, FriendshipsAreLike_Before.n,

                  Fights_Before.n, FeelingsHurt_Before.n, RightandWrong_Before.n) %>% 
    dplyr::mutate(`Healthy Rel` = Healthy_Rel_Before.n) %>% 
    dplyr::mutate(`Commun.` = Communicate_Before.n) %>% 
    dplyr::mutate(`Confl. Man.` = ConflictManagement_Before.n) %>% 
    dplyr::mutate(`Right Partner` = RightPartner_Before.n) %>% 
    dplyr::mutate(`Learn Partner` =  LearnPartner_Before.n) %>% 
    dplyr::mutate(`Pace Rel.` = PaceRelationship_Before.n) %>% 
    dplyr::mutate(`Warn Signs` = WarningSigns_Before.n) %>% 
    dplyr::mutate(Learned = LearnedGrowingUp_Before.n) %>% 
    dplyr::mutate(`Past Rel` = PastRelationships_Before.n) %>% 
    dplyr::mutate(`Get Along Par.` = GetAlongParents_Before.n) %>% 
    dplyr::mutate(`Friendships` = FriendshipsAreLike_Before.n) %>% 
    dplyr::mutate(`Fights` = Fights_Before.n) %>% 
    dplyr::mutate(`Feelings` = FeelingsHurt_Before.n) %>% 
    dplyr::mutate(`Right Wrong` = RightandWrong_Before.n) %>% 
    dplyr::select(`Healthy Rel`, `Commun.`, `Confl. Man.`,
                  `Right Partner`, `Learn Partner`, `Pace Rel.`, `Warn Signs`,
                  Learned, `Past Rel`, `Get Along Par.`, `Friendships`,
                  `Fights`, `Feelings`, `Right Wrong`) %>% 
    # cor(use = "pairwise.complete.obs")
    as.matrix() %>% 
    Hmisc::rcorr(type = "pearson")




# p.mat.pre <- cor.mtest(Jail_clean_outcome_pre_corr)

col <- colorRampPalette(c("#BB4444", "#EE9988", "#FFFFFF", "#77AADD", "#4477AA"))


corrplot::corrplot(Jail_clean_outcome_pre_corr$r, 
         method="color", 
         col=col(200),  
         type="upper", 
         # order="hclust", 
         addCoef.col = "black", # Add coefficient of correlation
         tl.col="black", tl.srt=45, #Text label color and rotation
         # Combine with significance
         p.mat = Jail_clean_outcome_pre_corr$P, 
         sig.level = 0.05, 
         insig = "blank", 
         # hide correlation coefficient on the principal diagonal
         diag=FALSE, 
         number.cex= 0.7,
         tl.cex = .7,
         title = "Retrospective Pre-Program Item Correlations",
                             mar=c(0,0,1,0))



```

\newpage

#### Post-Program Item-Level

&nbsp;

```{r, echo = FALSE}
Jail_clean_outcome_post_corr <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>%
    dplyr::select(Healthy_Rel.n, Communicate.n, ConflictManagement.n,

                  RightPartner.n, LearnPartner.n, 
                  PaceRelationship.n, WarningSigns.n,

                  LearnedGrowingUp.n, PastRelationships.n, 
                  GetAlongParents.n, FriendshipsAreLike.n,

                  Fights.n, FeelingsHurt.n, RightandWrong.n) %>% 
    dplyr::mutate(`Healthy Rel` = Healthy_Rel.n) %>% 
    dplyr::mutate(`Commun.` = Communicate.n) %>% 
    dplyr::mutate(`Confl. Man.` = ConflictManagement.n) %>% 
    dplyr::mutate(`Right Partner` = RightPartner.n) %>% 
    dplyr::mutate(`Learn Partner` =  LearnPartner.n) %>% 
    dplyr::mutate(`Pace Rel.` = PaceRelationship.n) %>% 
    dplyr::mutate(`Warn Signs` = WarningSigns.n) %>% 
    dplyr::mutate(`Learned` = LearnedGrowingUp.n) %>% 
    dplyr::mutate(`Past Rel` = PastRelationships.n) %>% 
    dplyr::mutate(`Get Along Par.` = GetAlongParents.n) %>% 
    dplyr::mutate(`Friendships` = FriendshipsAreLike.n) %>% 
    dplyr::mutate(`Fights` = Fights.n) %>% 
    dplyr::mutate(`Feelings` = FeelingsHurt.n) %>% 
    dplyr::mutate(`Right Wrong` = RightandWrong.n) %>% 
    dplyr::select(`Healthy Rel`, `Commun.`, `Confl. Man.`,
                  `Right Partner`, `Learn Partner`, `Pace Rel.`, `Warn Signs`,
                  `Learned`, `Past Rel`, `Get Along Par.`, `Friendships`,
                  `Fights`, `Feelings`, `Right Wrong`) %>% 
    # cor(use = "pairwise.complete.obs")
    as.matrix() %>% 
    Hmisc::rcorr(type = "pearson")




# p.mat.post <- cor.mtest(Jail_clean_outcome_post_corr)

col <- colorRampPalette(c("#BB4444", "#EE9988", "#FFFFFF", "#77AADD", "#4477AA"))


corrplot::corrplot(Jail_clean_outcome_post_corr$r, 
         method="color", 
         col=col(200),
         type="upper", 
         # order="hclust", 
         addCoef.col = "black", # Add coefficient of correlation
         tl.col="black", tl.srt=45, #Text label color and rotation
         # Combine with significance
         p.mat = Jail_clean_outcome_post_corr$P,
         sig.level = 0.05, insig = "blank", 
         # hide correlation coefficient on the principal diagonal
         diag=FALSE, 
         number.cex= 0.7,
         tl.cex = .7,
         title = "Post-Program Item Correlations",
                             mar=c(0,0,1,0))
```


\newpage

#### Retrospective Pre-Program to Post-Program Item-Level

&nbsp;

```{r, echo = FALSE}
Jail_clean_outcome_prepost_corr <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>%
    dplyr::select(Healthy_Rel_Before.n, Communicate_Before.n, ConflictManagement_Before.n,

                  RightPartner_Before.n, LearnPartner_Before.n, 
                  PaceRelationship_Before.n, WarningSigns_Before.n,

                  LearnedGrowingUp_Before.n, PastRelationships_Before.n, 
                  GetAlongParents_Before.n, FriendshipsAreLike_Before.n,

                  Fights_Before.n, FeelingsHurt_Before.n, RightandWrong_Before.n,
                  
                  Healthy_Rel.n, Communicate.n, ConflictManagement.n,

                  RightPartner.n, LearnPartner.n, 
                  PaceRelationship.n, WarningSigns.n,

                  LearnedGrowingUp.n, PastRelationships.n, 
                  GetAlongParents.n, FriendshipsAreLike.n,

                  Fights.n, FeelingsHurt.n, RightandWrong.n) %>% 
    dplyr::mutate(`Healthy Rel RPre` = Healthy_Rel_Before.n) %>% 
    dplyr::mutate(`Commun. RPre` = Communicate_Before.n) %>% 
    dplyr::mutate(`Confl. Man. RPre` = ConflictManagement_Before.n) %>% 
    dplyr::mutate(`Right Partner RPre` = RightPartner_Before.n) %>% 
    dplyr::mutate(`Learn Partner RPre` =  LearnPartner_Before.n) %>% 
    dplyr::mutate(`Pace Rel. RPre` = PaceRelationship_Before.n) %>% 
    dplyr::mutate(`Warn Signs RPre` = WarningSigns_Before.n) %>% 
    dplyr::mutate(`Learned RPre` = LearnedGrowingUp_Before.n) %>% 
    dplyr::mutate(`Past Rel RPre` = PastRelationships_Before.n) %>% 
    dplyr::mutate(`Get Along Par. RPre` = GetAlongParents_Before.n) %>% 
    dplyr::mutate(`Friendships RPre` = FriendshipsAreLike_Before.n) %>% 
    dplyr::mutate(`Fights RPre` = Fights_Before.n) %>% 
    dplyr::mutate(`Feelings RPre` = FeelingsHurt_Before.n) %>% 
    dplyr::mutate(`Right Wrong RPre` = RightandWrong_Before.n) %>%
    
    dplyr::mutate(`Healthy Rel Post` = Healthy_Rel.n) %>% 
    dplyr::mutate(`Commun. Post` = Communicate.n) %>% 
    dplyr::mutate(`Confl. Man. Post` = ConflictManagement.n) %>% 
    dplyr::mutate(`Right Partner Post` = RightPartner.n) %>% 
    dplyr::mutate(`Learn Partner Post` =  LearnPartner.n) %>% 
    dplyr::mutate(`Pace Rel. Post` = PaceRelationship.n) %>% 
    dplyr::mutate(`Warn Signs Post` = WarningSigns.n) %>% 
    dplyr::mutate(`Learned Post` = LearnedGrowingUp.n) %>% 
    dplyr::mutate(`Past Rel Post` = PastRelationships.n) %>% 
    dplyr::mutate(`Get Along Par. Post` = GetAlongParents.n) %>% 
    dplyr::mutate(`Friendships Post` = FriendshipsAreLike.n) %>% 
    dplyr::mutate(`Fights Post` = Fights.n) %>% 
    dplyr::mutate(`Feelings Post` = FeelingsHurt.n) %>% 
    dplyr::mutate(`Right Wrong Post` = RightandWrong.n) %>% 

    
    dplyr::select(`Healthy Rel RPre`, `Commun. RPre`, `Confl. Man. RPre`,
                  `Right Partner RPre`, `Learn Partner RPre`, 
                  `Pace Rel. RPre`, `Warn Signs RPre`,
                  `Learned RPre`, `Past Rel RPre`, 
                  `Get Along Par. RPre`, `Friendships RPre`,
                  `Fights RPre`, `Feelings RPre`, `Right Wrong RPre`,
                  
                  `Healthy Rel Post`, `Commun. Post`, `Confl. Man. Post`,
                  `Right Partner Post`, `Learn Partner Post`, 
                  `Pace Rel. Post`, `Warn Signs Post`,
                  `Learned Post`, `Past Rel Post`, 
                  `Get Along Par. Post`, `Friendships Post`,
                  `Fights Post`, `Feelings Post`, `Right Wrong Post`) %>% 
    # cor(use = "pairwise.complete.obs")
    as.matrix() %>% 
    Hmisc::rcorr(type = "pearson")
    # corrr::correlate() %>% 
    # corrr::focus(`Healthy Rel Post`, `Commun. Post`, `Confl. Man. Post`,
    #               `Right Partner Post`, `Learn Partner Post`, 
    #               `Pace Rel. Post`, `Warn Signs Post`,
    #               `Learned Post`, `Past Rel Post`, 
    #               `Get Along Par. Post`, `Friendships Post`,
    #               `Fights Post`, `Feelings Post`, `Right Wrong Post`)



# p.mat.pre <- cor.mtest(Jail_clean_outcome_pre_corr)

col <- colorRampPalette(c("#BB4444", "#EE9988", "#FFFFFF", "#77AADD", "#4477AA"))

corrplot::corrplot(Jail_clean_outcome_prepost_corr$r[1:14,14:28],
                   number.digits = 2,
         method="color", 
         col=col(200),  
         type="upper", 
         # order="hclust", 
         addCoef.col = "black", # Add coefficient of correlation
         tl.col="black", tl.srt=45, #Text label color and rotation
         # Combine with significance
         p.mat = Jail_clean_outcome_prepost_corr$P[1:14,14:28], 
         sig.level = 0.05, 
         insig = "blank", 
         # hide correlation coefficient on the principal diagonal
         diag=FALSE, 
         number.cex= 0.6,
         tl.cex = .5,
         title = "Retrospective Pre-Post Program Item Correlations",
                             mar=c(0,0,1.7,0))



```

\newpage



#### Change Scores at Item Level

&nbsp;


```{r, echo = FALSE}
Jail_clean_outcome_change_corr <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample == TRUE) %>%
    dplyr::select(Healthy_Rel_Change, Communicate_Change, ConflictManagement_Change,

                  RightPartner_Change, LearnPartner_Change, 
                  PaceRelationship_Change, WarningSigns_Change,

                  LearnedGrowingUp_Change, PastRelationships_Change, 
                  GetAlongParents_Change, FriendshipsAreLike_Change,

                  Fights_Change, FeelingsHurt_Change, RightandWrong_Change) %>% 
    dplyr::mutate(`Healthy Rel` = Healthy_Rel_Change) %>% 
    dplyr::mutate(`Commun.` = Communicate_Change) %>% 
    dplyr::mutate(`Confl. Man.` = ConflictManagement_Change) %>% 
    dplyr::mutate(`Right Partner` = RightPartner_Change) %>% 
    dplyr::mutate(`Learn Partner` =  LearnPartner_Change) %>% 
    dplyr::mutate(`Pace Rel.` = PaceRelationship_Change) %>% 
    dplyr::mutate(`Warn Signs` = WarningSigns_Change) %>% 
    dplyr::mutate(`Learned` = LearnedGrowingUp_Change) %>% 
    dplyr::mutate(`Past Rel` = PastRelationships_Change) %>% 
    dplyr::mutate(`Get Along Par.` = GetAlongParents_Change) %>% 
    dplyr::mutate(`Friendships` = FriendshipsAreLike_Change) %>% 
    dplyr::mutate(`Fights` = Fights_Change) %>% 
    dplyr::mutate(`Feelings` = FeelingsHurt_Change) %>% 
    dplyr::mutate(`Right Wrong` = RightandWrong_Change) %>% 
    dplyr::select(`Healthy Rel`, `Commun.`, `Confl. Man.`,
                  `Right Partner`, `Learn Partner`, `Pace Rel.`, `Warn Signs`,
                  `Learned`, `Past Rel`, `Get Along Par.`, `Friendships`,
                  `Fights`, `Feelings`, `Right Wrong`) %>% 
    # cor(use = "pairwise.complete.obs")
    as.matrix() %>% 
    Hmisc::rcorr(type = "pearson")


# p.mat <- cor.mtest(cor(Jail_clean_outcome_change_corr))

col <- colorRampPalette(c("#BB4444", "#EE9988", "#FFFFFF", "#77AADD", "#4477AA"))


corrplot::corrplot(Jail_clean_outcome_change_corr$r, 
         method="color", 
         col=col(200),  
         type="upper", 
         # order="hclust", 
         addCoef.col = "black", # Add coefficient of correlation
         tl.col="black", tl.srt=45, #Text label color and rotation
         # Combine with significance
         p.mat = Jail_clean_outcome_change_corr$P, 
         sig.level = 0.05, insig = "blank", 
         # hide correlation coefficient on the principal diagonal
         diag=FALSE, 
         number.cex= 0.7,
         tl.cex = .7,
         title = "Change Score Item Correlations",
                             mar=c(0,0,1,0))
```

\newpage




#### Categorical Retrospective Pre-Program Item-Level

&nbsp;

```{r, echo = FALSE}
Jail_clean_outcome_pre.cat_corr <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>%
    dplyr::select(Healthy_Rel_Before.3c, Communicate_Before.3c, ConflictManagement_Before.3c,

                  RightPartner_Before.3c, LearnPartner_Before.3c, 
                  PaceRelationship_Before.3c, WarningSigns_Before.3c,

                  LearnedGrowingUp_Before.3c, PastRelationships_Before.3c, 
                  GetAlongParents_Before.3c, FriendshipsAreLike_Before.3c,

                  Fights_Before.3c, FeelingsHurt_Before.3c, RightandWrong_Before.3c) %>% 
    dplyr::mutate(`Healthy Rel` = Healthy_Rel_Before.3c) %>% 
    dplyr::mutate(`Commun.` = Communicate_Before.3c) %>% 
    dplyr::mutate(`Confl. Man.` = ConflictManagement_Before.3c) %>% 
    dplyr::mutate(`Right Partner` = RightPartner_Before.3c) %>% 
    dplyr::mutate(`Learn Partner` =  LearnPartner_Before.3c) %>% 
    dplyr::mutate(`Pace Rel.` = PaceRelationship_Before.3c) %>% 
    dplyr::mutate(`Warn Signs` = WarningSigns_Before.3c) %>% 
    dplyr::mutate(Learned = LearnedGrowingUp_Before.3c) %>% 
    dplyr::mutate(`Past Rel` = PastRelationships_Before.3c) %>% 
    dplyr::mutate(`Get Along Par.` = GetAlongParents_Before.3c) %>% 
    dplyr::mutate(`Friendships` = FriendshipsAreLike_Before.3c) %>% 
    dplyr::mutate(`Fights` = Fights_Before.3c) %>% 
    dplyr::mutate(`Feelings` = FeelingsHurt_Before.3c) %>% 
    dplyr::mutate(`Right Wrong` = RightandWrong_Before.3c) %>% 
    dplyr::select(`Healthy Rel`, `Commun.`, `Confl. Man.`,
                  `Right Partner`, `Learn Partner`, `Pace Rel.`, `Warn Signs`,
                  Learned, `Past Rel`, `Get Along Par.`, `Friendships`,
                  `Fights`, `Feelings`, `Right Wrong`) %>% 
    # cor(use = "pairwise.complete.obs")
    # as.matrix() %>% 
    # Hmisc::rcorr(type = "pearson")
    psych::polychoric()



# p.mat.pre <- cor.mtest(Jail_clean_outcome_pre_corr)

col <- colorRampPalette(c("#BB4444", "#EE9988", "#FFFFFF", "#77AADD", "#4477AA"))


corrplot::corrplot(Jail_clean_outcome_pre.cat_corr$r, 
         method="color", 
         col=col(200),  
         type="upper", 
         # order="hclust", 
         addCoef.col = "black", # Add coefficient of correlation
         tl.col="black", tl.srt=45, #Text label color and rotation
         # Combine with significance
         p.mat = Jail_clean_outcome_pre.cat_corr$P, 
         sig.level = 0.05, 
         insig = "blank", 
         # hide correlation coefficient on the principal diagonal
         diag=FALSE, 
         number.cex= 0.7,
         tl.cex = .7,
         title = "Retrospective Pre-Program Item Correlations",
                             mar=c(0,0,1,0))



```

* Items
    1.  Healthy Rel
    2.  Commun.
    3.  Confl. Man.
    4.  Right Partner
    5.  Learn Partner
    6.  Pace Rel.
    7.  Warn Signs
    8.  Learned
    9.  Past Rel
    10.  Get Along Par.
    11.  Friendships
    12.  Fights
    13.  Feelings
    14.  Right Wrong

\newpage

#### Categorical Post-Program Item-Level

&nbsp;

```{r, echo = FALSE}
Jail_clean_outcome_post.cat_corr <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>%
    dplyr::select(Healthy_Rel.3c, Communicate.3c, ConflictManagement.3c,

                  RightPartner.3c, LearnPartner.3c, 
                  PaceRelationship.3c, WarningSigns.3c,

                  LearnedGrowingUp.3c, PastRelationships.3c, 
                  GetAlongParents.3c, FriendshipsAreLike.3c,

                  Fights.3c, FeelingsHurt.3c, RightandWrong.3c) %>% 
    dplyr::mutate(`Healthy Rel` = Healthy_Rel.3c) %>% 
    dplyr::mutate(`Commun.` = Communicate.3c) %>% 
    dplyr::mutate(`Confl. Man.` = ConflictManagement.3c) %>% 
    dplyr::mutate(`Right Partner` = RightPartner.3c) %>% 
    dplyr::mutate(`Learn Partner` =  LearnPartner.3c) %>% 
    dplyr::mutate(`Pace Rel.` = PaceRelationship.3c) %>% 
    dplyr::mutate(`Warn Signs` = WarningSigns.3c) %>% 
    dplyr::mutate(`Learned` = LearnedGrowingUp.3c) %>% 
    dplyr::mutate(`Past Rel` = PastRelationships.3c) %>% 
    dplyr::mutate(`Get Along Par.` = GetAlongParents.3c) %>% 
    dplyr::mutate(`Friendships` = FriendshipsAreLike.3c) %>% 
    dplyr::mutate(`Fights` = Fights.3c) %>% 
    dplyr::mutate(`Feelings` = FeelingsHurt.3c) %>% 
    dplyr::mutate(`Right Wrong` = RightandWrong.3c) %>% 
    dplyr::select(`Healthy Rel`, `Commun.`, `Confl. Man.`,
                  `Right Partner`, `Learn Partner`, `Pace Rel.`, `Warn Signs`,
                  `Learned`, `Past Rel`, `Get Along Par.`, `Friendships`,
                  `Fights`, `Feelings`, `Right Wrong`) %>% 
    # cor(use = "pairwise.complete.obs")
    # as.matrix() %>% 
    # Hmisc::rcorr(type = "pearson")
psych::polychoric()




# p.mat.post <- cor.mtest(Jail_clean_outcome_post_corr)

col <- colorRampPalette(c("#BB4444", "#EE9988", "#FFFFFF", "#77AADD", "#4477AA"))


corrplot::corrplot(Jail_clean_outcome_post.cat_corr$r, 
         method="color", 
         col=col(200),
         type="upper", 
         # order="hclust", 
         addCoef.col = "black", # Add coefficient of correlation
         tl.col="black", tl.srt=45, #Text label color and rotation
         # Combine with significance
         p.mat = Jail_clean_outcome_post.cat_corr$P,
         sig.level = 0.05, insig = "blank", 
         # hide correlation coefficient on the principal diagonal
         diag=FALSE, 
         number.cex= 0.7,
         tl.cex = .7,
         title = "Post-Program Item Correlations",
                             mar=c(0,0,1,0))
```

* Items
    1.  Healthy Rel
    2.  Commun.
    3.  Confl. Man.
    4.  Right Partner
    5.  Learn Partner
    6.  Pace Rel.
    7.  Warn Signs
    8.  Learned
    9.  Past Rel
    10.  Get Along Par.
    11.  Friendships
    12.  Fights
    13.  Feelings
    14.  Right Wrong

\newpage

#### Retrospective Pre-Program to Post-Program Item-Level

&nbsp;

```{r, echo = FALSE}
Jail_clean_outcome_prepost.cat_corr <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>%
    dplyr::select(Healthy_Rel_Before.3c, Communicate_Before.3c, ConflictManagement_Before.3c,

                  RightPartner_Before.3c, LearnPartner_Before.3c, 
                  PaceRelationship_Before.3c, WarningSigns_Before.3c,

                  LearnedGrowingUp_Before.3c, PastRelationships_Before.3c, 
                  GetAlongParents_Before.3c, FriendshipsAreLike_Before.3c,

                  Fights_Before.3c, FeelingsHurt_Before.3c, RightandWrong_Before.3c,
                  
                  Healthy_Rel.3c, Communicate.3c, ConflictManagement.3c,

                  RightPartner.3c, LearnPartner.3c, 
                  PaceRelationship.3c, WarningSigns.3c,

                  LearnedGrowingUp.3c, PastRelationships.3c, 
                  GetAlongParents.3c, FriendshipsAreLike.3c,

                  Fights.3c, FeelingsHurt.3c, RightandWrong.3c) %>% 
    dplyr::mutate(`Healthy Rel RPre` = Healthy_Rel_Before.3c) %>% 
    dplyr::mutate(`Commun. RPre` = Communicate_Before.3c) %>% 
    dplyr::mutate(`Confl. Man. RPre` = ConflictManagement_Before.3c) %>% 
    dplyr::mutate(`Right Partner RPre` = RightPartner_Before.3c) %>% 
    dplyr::mutate(`Learn Partner RPre` =  LearnPartner_Before.3c) %>% 
    dplyr::mutate(`Pace Rel. RPre` = PaceRelationship_Before.3c) %>% 
    dplyr::mutate(`Warn Signs RPre` = WarningSigns_Before.3c) %>% 
    dplyr::mutate(`Learned RPre` = LearnedGrowingUp_Before.3c) %>% 
    dplyr::mutate(`Past Rel RPre` = PastRelationships_Before.3c) %>% 
    dplyr::mutate(`Get Along Par. RPre` = GetAlongParents_Before.3c) %>% 
    dplyr::mutate(`Friendships RPre` = FriendshipsAreLike_Before.3c) %>% 
    dplyr::mutate(`Fights RPre` = Fights_Before.3c) %>% 
    dplyr::mutate(`Feelings RPre` = FeelingsHurt_Before.3c) %>% 
    dplyr::mutate(`Right Wrong RPre` = RightandWrong_Before.3c) %>%
    
    dplyr::mutate(`Healthy Rel Post` = Healthy_Rel.3c) %>% 
    dplyr::mutate(`Commun. Post` = Communicate.3c) %>% 
    dplyr::mutate(`Confl. Man. Post` = ConflictManagement.3c) %>% 
    dplyr::mutate(`Right Partner Post` = RightPartner.3c) %>% 
    dplyr::mutate(`Learn Partner Post` =  LearnPartner.3c) %>% 
    dplyr::mutate(`Pace Rel. Post` = PaceRelationship.3c) %>% 
    dplyr::mutate(`Warn Signs Post` = WarningSigns.3c) %>% 
    dplyr::mutate(`Learned Post` = LearnedGrowingUp.3c) %>% 
    dplyr::mutate(`Past Rel Post` = PastRelationships.3c) %>% 
    dplyr::mutate(`Get Along Par. Post` = GetAlongParents.3c) %>% 
    dplyr::mutate(`Friendships Post` = FriendshipsAreLike.3c) %>% 
    dplyr::mutate(`Fights Post` = Fights.3c) %>% 
    dplyr::mutate(`Feelings Post` = FeelingsHurt.3c) %>% 
    dplyr::mutate(`Right Wrong Post` = RightandWrong.3c) %>% 

    
    dplyr::select(`Healthy Rel RPre`, `Commun. RPre`, `Confl. Man. RPre`,
                  `Right Partner RPre`, `Learn Partner RPre`, 
                  `Pace Rel. RPre`, `Warn Signs RPre`,
                  `Learned RPre`, `Past Rel RPre`, 
                  `Get Along Par. RPre`, `Friendships RPre`,
                  `Fights RPre`, `Feelings RPre`, `Right Wrong RPre`,
                  
                  `Healthy Rel Post`, `Commun. Post`, `Confl. Man. Post`,
                  `Right Partner Post`, `Learn Partner Post`, 
                  `Pace Rel. Post`, `Warn Signs Post`,
                  `Learned Post`, `Past Rel Post`, 
                  `Get Along Par. Post`, `Friendships Post`,
                  `Fights Post`, `Feelings Post`, `Right Wrong Post`) %>% 
    as.matrix() %>% 
    # Hmisc::rcorr(type = "pearson")
    psych::polychoric()



# p.mat.pre <- cor.mtest(Jail_clean_outcome_pre_corr)

col <- colorRampPalette(c("#BB4444", "#EE9988", "#FFFFFF", "#77AADD", "#4477AA"))

corrplot::corrplot(Jail_clean_outcome_prepost.cat_corr$r[1:14,14:28],
                   number.digits = 2,
         method="color", 
         col=col(200),  
         type="upper", 
         # order="hclust", 
         addCoef.col = "black", # Add coefficient of correlation
         tl.col="black", tl.srt=45, #Text label color and rotation
         # Combine with significance
         p.mat = Jail_clean_outcome_prepost.cat_corr$P[1:14,14:28], 
         sig.level = 0.05, 
         insig = "blank", 
         # hide correlation coefficient on the principal diagonal
         diag=FALSE, 
         number.cex= 0.6,
         tl.cex = .5,
         title = "Retrospective Pre-Post Program Item Correlations",
                             mar=c(0,0,1.7,0))



```

* Row Items Retrospective-Pre
    1.  Healthy Rel
    2.  Commun.
    3.  Confl. Man.
    4.  Right Partner
    5.  Learn Partner
    6.  Pace Rel.
    7.  Warn Signs
    8.  Learned
    9.  Past Rel
    10.  Get Along Par.
    11.  Friendships
    12.  Fights
    13.  Feelings
    14.  Right Wrong

* Column Items Post
    2.  Healthy Rel
    3.  Commun.
    4.  Confl. Man.
    5.  Right Partner
    6.  Learn Partner
    7.  Pace Rel.
    8.  Warn Signs
    9.  Learned
    10.  Past Rel
    11.  Get Along Par.
    12.  Friendships
    13.  Fights
    14.  Feelings
    15.  Right Wrong

\newpage



#### Outcomes Scales

&nbsp;


```{r, echo = FALSE}
Jail_clean_outcomes_corr <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>%
    dplyr::select(Healthy_Rel_Skills_Before,
                  Partner_Selection_Before,
                  Past_Rel_Behav_Before,
                  Rel_Behav_Attit_Before,
                  Healthy_Rel_Skills,
                  Partner_Selection,
                  Past_Rel_Behav,
                  Rel_Behav_Attit,
                  Healthy_Rel_Skills_Change,
                  Partner_Selection_Change,
                  Past_Rel_Behav_Change,
                  Rel_Behav_Attit_Change) %>%
    dplyr::mutate(`Retro-Pre Skills` = Healthy_Rel_Skills_Before) %>% 
    dplyr::mutate(`Retro-Pre Partner` = Partner_Selection_Before) %>% 
    dplyr::mutate(`Retro-Pre Patterns` = Past_Rel_Behav_Before) %>% 
    dplyr::mutate(`Retro-Pre Behavior` = Rel_Behav_Attit_Before) %>% 
    dplyr::mutate(`Post Skills` = Healthy_Rel_Skills) %>% 
    dplyr::mutate(`Post Partner` = Partner_Selection) %>% 
    dplyr::mutate(`Post Patterns` = Past_Rel_Behav) %>% 
    dplyr::mutate(`Post Behavior` = Rel_Behav_Attit) %>% 
    dplyr::mutate(`Change Skills` = Healthy_Rel_Skills_Change) %>% 
    dplyr::mutate(`Change Partner` = Partner_Selection_Change) %>% 
    dplyr::mutate(`Change Patterns` = Past_Rel_Behav_Change) %>% 
    dplyr::mutate(`Change Behavior` = Rel_Behav_Attit_Change) %>% 
    dplyr::select(`Retro-Pre Skills`, `Retro-Pre Partner`, 
                  `Retro-Pre Patterns`, `Retro-Pre Behavior`,
                  `Post Skills`, `Post Partner`, 
                  `Post Patterns`, `Post Behavior`,
                  `Change Skills`, `Change Partner`, 
                  `Change Patterns`, `Change Behavior`) %>% 
    # dplyr::mutate(`Healthy Rel` = Healthy_Rel_Change) %>% 
    # dplyr::mutate(`Commun.` = Communicate_Change) %>% 
    # dplyr::mutate(`Confl. Man.` = ConflictManagement_Change) %>% 
    # dplyr::mutate(`Right Partner` = RightPartner_Change) %>% 
    # dplyr::mutate(`Learn Partner` =  LearnPartner_Change) %>% 
    # dplyr::mutate(`Pace Rel.` = PaceRelationship_Change) %>% 
    # dplyr::mutate(`Warn Signs` = WarningSigns_Change) %>% 
    # dplyr::mutate(`Learned` = LearnedGrowingUp_Change) %>% 
    # dplyr::mutate(`Past Rel` = PastRelationships_Change) %>% 
    # dplyr::mutate(`Get Along Par.` = GetAlongParents_Change) %>% 
    # dplyr::mutate(`Friendships` = FriendshipsAreLike_Change) %>% 
    # dplyr::mutate(`Fights` = Fights_Change) %>% 
    # dplyr::mutate(`Feelings` = FeelingsHurt_Change) %>% 
    # dplyr::mutate(`Right Wrong` = RightandWrong_Change) %>% 
    # dplyr::select(`Healthy Rel`, `Commun.`, `Confl. Man.`,
    #               `Right Partner`, `Learn Partner`, `Pace Rel.`, `Warn Signs`,
    #               `Learned`, `Past Rel`, `Get Along Par.`, `Friendships`,
    #               `Fights`, `Feelings`, `Right Wrong`) %>% 
    # cor(use = "pairwise.complete.obs")
    as.matrix() %>% 
    Hmisc::rcorr(type = "pearson")




p.mat <- cor.mtest(Jail_clean_outcomes_corr$r)

col <- colorRampPalette(c("#BB4444", "#EE9988", "#FFFFFF", "#77AADD", "#4477AA"))


corrplot::corrplot(Jail_clean_outcomes_corr$r, 
         method="color", 
         col=col(200),  
         type="upper", 
         # order="hclust", 
         addCoef.col = "black", # Add coefficient of correlation
         tl.col="black", tl.srt=45, #Text label color and rotation
         # Combine with significance
         p.mat = Jail_clean_outcomes_corr$P, 
         sig.level = 0.05, insig = "blank", 
         # hide correlation coefficient on the principal diagonal
         diag=FALSE, 
         number.cex= 0.7,
         tl.cex = .7,
         title = "Correlations Among Outcomes Scales",
                             mar=c(0,0,1,0))
```

\newpage


## Multicollinearity of Predictors

* Warnings Signs

    *  VIF greater than 10 is cause for concern.
    *  Average VIF substantially greater than 1
    *  Tolerance below 0.1 indicates serious problem, below 0.2 potential problems.

### Checking Multicollinearity when Using Dosage as 3 levels and Age as Continuous

#### VIF

&nbsp;


```{r,echo=FALSE}

VIF.fit1 <- lm(Healthy_Rel_Before.n~`Age (Decades)` + Ethnic_Code + Education_3cat + 
                               + Prior_RshpEducation + FinancialWorry_cat + 
                               `Income (10K)` + Number_Attended + Gender + 
                               Divorced_Dichotomous, 
               data = Jail_clean %>% dplyr::filter(in.analysis.sample3 == TRUE))

car::vif(VIF.fit1)%>% data.frame() %>% pander::pander()

```

* Mean VIF is `r mean(car::vif(VIF.fit1))`

#### Tolerance

&nbsp;


```{r, echo = FALSE}

tol.fit1 <- round((1/car::vif(VIF.fit1))[,1], 3) %>% 
    data.frame() 

colnames(tol.fit1) <- "Tolerance"
 
tol.fit1 %>% 
    pander::pander()

```

\newpage

### Checking Multicollinearity when Using Dosage as 2 levels, Age as Continuous

#### VIF

&nbsp;


```{r,echo=FALSE}

VIF.fit2 <- lm(Healthy_Rel_Before.n~`Age (Decades)` + Ethnic_Code + Education_3cat + 
                               + Prior_RshpEducation + FinancialWorry_cat + 
                               `Income (10K)` + Dosage + Gender + 
                               Divorced_Dichotomous, 
               data = Jail_clean %>% dplyr::filter(in.analysis.sample3 == TRUE))

car::vif(VIF.fit2) %>% data.frame() %>% pander::pander()

```

* Mean VIF is `r mean(car::vif(VIF.fit2))`

#### Tolerance

&nbsp;


```{r, echo = FALSE}

tol.fit2 <- round((1/car::vif(VIF.fit2))[,1], 3) %>% 
    data.frame() 

colnames(tol.fit2) <- "Tolerance"
 
tol.fit2 %>% 
    pander::pander()

```

\newpage

## Frequencies

### Frequencies of Predictors

#### Age

* Age (Decades)

```{r,echo=FALSE}
Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>% 
    furniture::tableF(`Age (Decades)`)
```

* Age Groups


```{r,echo=FALSE}
Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>% 
    furniture::tableF(Age_Groups)
```

\newpage

#### Ethnicity

* Collapsing categories

```{r,echo=FALSE}
Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>% 
    furniture::tableF(Ethnic_Code)
```

* Collapsing categories to two

```{r,echo=FALSE}
Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>% 
    furniture::tableF(Race_Dichotomous)
```

#### Education

* Collapsing to three

```{r,echo=FALSE}
Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>% 
    furniture::tableF(Education_3cat)
```

\newpage

#### Income in $10,000

```{r,echo=FALSE}
Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>% 
    furniture::tableF(`Income (10K)`)


```

#### Gender

```{r,echo=FALSE}
Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>% 
    furniture::tableF(Gender)
```


#### Divorced

```{r,echo=FALSE}
Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>% 
    furniture::tableF(Divorced_Dichotomous)
```

#### Financial Strain

* Collapsed
```{r,echo=FALSE}
Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>% 
    furniture::tableF(FinancialWorry_cat)
```

#### Prior Relationship Education

* 2 categories

```{r,echo=FALSE}
Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>% 
    furniture::tableF(Prior_RshpEducation_collapsed)

```

#### Dosage

* All Categories

```{r,echo=FALSE}
Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>% 
    furniture::tableF(Number_Attended)
```

* Dosage: Full vs. Partial
```{r,echo=FALSE}
Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>% 
    furniture::tableF(Dosage)
```

\newpage

### Frequencies of Outcomes Variables at Item Level

#### Perceived Knowledge About Relationship Skills

##### Retro-Pre
```{r,echo=FALSE}
Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>% 
    dplyr::mutate(`Healthy Rel.` = Healthy_Rel_Before.n) %>% 
    dplyr::mutate(Communicate = Communicate_Before.n) %>%  
    dplyr::mutate(`Confl. Mng.` = ConflictManagement_Before.n) %>% 
    tableM(`Healthy Rel.`, Communicate, `Confl. Mng.`,
           resp.opts = c(1:5)) %>% 
    pander::pander()

```

##### Post
```{r,echo=FALSE}

Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>% 
    dplyr::mutate(`Healthy Rel.` = Healthy_Rel.n) %>% 
    dplyr::mutate(Communicate = Communicate.n) %>%  
    dplyr::mutate(`Confl. Mng.` = ConflictManagement.n) %>% 
    tableM(`Healthy Rel.`, Communicate, `Confl. Mng.`,
           resp.opts = c(1:5)) %>% 
    pander::pander()

```
\newpage
 
##### Change
```{r,echo=FALSE}

Jail_clean %>% 
    dplyr::filter(in.analysis.sample == TRUE) %>% 
    dplyr::mutate(`Healthy Rel.` = Healthy_Rel_Change) %>%  
    dplyr::mutate(Communicate = Communicate_Change) %>% 
    dplyr::mutate(`Confl. Mng.` = ConflictManagement_Change) %>% 
    tableM(`Healthy Rel.`, Communicate, `Confl. Mng.`,
           resp.opts = c(-2:4)) %>% 
    pander::pander()

```

##### Categorical Retro-Pre
```{r,echo=FALSE}
Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>% 
    dplyr::mutate(`Healthy Rel.` = Healthy_Rel_Before.3c) %>% 
    dplyr::mutate(Communicate = Communicate_Before.3c) %>%  
    dplyr::mutate(`Confl. Mng.` = ConflictManagement_Before.3c) %>% 
    tableM(`Healthy Rel.`, Communicate, `Confl. Mng.`,
           resp.opts = c(3:5)) %>% 
    pander::pander()

```

##### Categorical Post
```{r,echo=FALSE}

Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>% 
    dplyr::mutate(`Healthy Rel.` = Healthy_Rel.3c) %>% 
    dplyr::mutate(Communicate = Communicate.3c) %>%  
    dplyr::mutate(`Confl. Mng.` = ConflictManagement.3c) %>% 
    tableM(`Healthy Rel.`, Communicate, `Confl. Mng.`,
           resp.opts = c(3:5)) %>% 
    pander::pander()

```

\newpage

#### Perceived Knowledge About Partner Selection

##### Retro-Pre
```{r,echo=FALSE}
Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>% 
    dplyr::rename(`Right Partner` = RightPartner_Before.n,
                  `Learn Partner` = LearnPartner_Before.n,
                  `Pace Rel.` = PaceRelationship_Before.n,
                  `Warning Signs` = WarningSigns_Before.n) %>% 
    tableM(`Right Partner`, `Learn Partner`, 
           `Pace Rel.`, `Warning Signs`,
           resp.opts = c(1:5)) %>% 
    pander::pander()

```

##### Post
```{r,echo=FALSE}

Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>% 
    dplyr::rename(`Right Partner` = RightPartner.n,
                  `Learn Partner` = LearnPartner.n,
                  `Pace Rel.` = PaceRelationship.n,
                  `Warning Signs` = WarningSigns.n) %>% 
    tableM(`Right Partner`, `Learn Partner`, 
           `Pace Rel.`, `Warning Signs`,
           resp.opts = c(1:5)) %>% 
    pander::pander()
```

\newpage

##### Change
```{r,echo=FALSE}

Jail_clean %>% 
    dplyr::filter(in.analysis.sample == TRUE) %>% 
    dplyr::rename(`Right Partner` = RightPartner_Change,
                  `Learn Partner` = LearnPartner_Change,
                  `Pace Rel.` = PaceRelationship_Change,
                  `Warning Signs` = WarningSigns_Change) %>% 
    tableM(`Right Partner`, `Learn Partner`, 
           `Pace Rel.`, `Warning Signs`,
           resp.opts = c(-2:4)) %>% 
    pander::pander()
```

##### Categorical Retro-pre

```{r,echo=FALSE}
Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>% 
    dplyr::rename(`Right Partner` = RightPartner_Before.3c,
                  `Learn Partner` = LearnPartner_Before.3c,
                  `Pace Rel.` = PaceRelationship_Before.3c,
                  `Warning Signs` = WarningSigns_Before.3c) %>% 
    tableM(`Right Partner`, `Learn Partner`, 
           `Pace Rel.`, `Warning Signs`,
           resp.opts = c(3:5)) %>% 
    pander::pander()

```

##### Categorical Post
```{r,echo=FALSE}

Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>% 
    dplyr::rename(`Right Partner` = RightPartner.3c,
                  `Learn Partner` = LearnPartner.3c,
                  `Pace Rel.` = PaceRelationship.3c,
                  `Warning Signs` = WarningSigns.3c) %>% 
    tableM(`Right Partner`, `Learn Partner`, 
           `Pace Rel.`, `Warning Signs`,
           resp.opts = c(3:5)) %>% 
    pander::pander()
```


\newpage

#### Perceived Importance of Knowledge About a Potential Partner's Relationships Patterns

##### Retro-Pre
```{r,echo=FALSE}
Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>% 
    dplyr::rename(`Lrn. Grow. Up` = LearnedGrowingUp_Before.n,
                  `Past Rels.` = PastRelationships_Before.n, 
                  `Get Along Pars.` = GetAlongParents_Before.n, 
                  `Friendships` = FriendshipsAreLike_Before.n) %>% 
    tableM(`Lrn. Grow. Up`, `Past Rels.`, 
           `Get Along Pars.`, `Friendships` ,
           resp.opts = c(1:5)) %>% 
    pander::pander()

```

##### Post
```{r,echo=FALSE}

Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>% 
    dplyr::rename(`Lrn. Grow. Up` = LearnedGrowingUp.n,
                  `Past Rels.` = PastRelationships.n, 
                  `Get Along Pars.` = GetAlongParents.n, 
                  `Friendships` = FriendshipsAreLike.n) %>% 
    tableM(`Lrn. Grow. Up`, `Past Rels.`, 
           `Get Along Pars.`, Friendships,
           resp.opts = c(1:5)) %>% 
    pander::pander()
```
\newpage

##### Change
```{r,echo=FALSE}

Jail_clean %>% 
    dplyr::filter(in.analysis.sample == TRUE) %>% 
    dplyr::rename(`Lrn. Grow. Up` = LearnedGrowingUp_Change,
                  `Past Rels.` = PastRelationships_Change, 
                  `Get Along Pars.` = GetAlongParents_Change, 
                  `Friendships` = FriendshipsAreLike_Change) %>% 
    tableM(`Lrn. Grow. Up`, `Past Rels.`, 
           `Get Along Pars.`, Friendships,
           resp.opts = c(-2:4)) %>% 
    pander::pander()

```

##### Categorical Retro-Pre
```{r,echo=FALSE}
Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>% 
    dplyr::rename(`Lrn. Grow. Up` = LearnedGrowingUp_Before.3c,
                  `Past Rels.` = PastRelationships_Before.3c, 
                  `Get Along Pars.` = GetAlongParents_Before.3c, 
                  `Friendships` = FriendshipsAreLike_Before.3c) %>% 
    tableM(`Lrn. Grow. Up`, `Past Rels.`, 
           `Get Along Pars.`, `Friendships` ,
           resp.opts = c(3:5)) %>% 
    pander::pander()

```

##### Categorical Post
```{r,echo=FALSE}

Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>% 
    dplyr::rename(`Lrn. Grow. Up` = LearnedGrowingUp.3c,
                  `Past Rels.` = PastRelationships.3c, 
                  `Get Along Pars.` = GetAlongParents.3c, 
                  `Friendships` = FriendshipsAreLike.3c) %>% 
    tableM(`Lrn. Grow. Up`, `Past Rels.`, 
           `Get Along Pars.`, Friendships,
           resp.opts = c(3:5)) %>% 
    pander::pander()
```

\newpage


#### Perceived Importance of Knowledge About a Potential Partner's Relationship Behavior and Attitudes

##### Retro-Pre
```{r,echo=FALSE}
Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>% 
    dplyr::mutate(Fights = Fights_Before.n, 
                  `Feelings Hurt` = FeelingsHurt_Before.n, 
                  `Right and Wrong` = RightandWrong_Before.n)  %>% 
    tableM(Fights, `Feelings Hurt`, `Right and Wrong`,
           resp.opts = c(1:5)) %>% 
    pander::pander()

```

##### Post
```{r,echo=FALSE}

Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>% 
    dplyr::mutate(Fights = Fights.n, 
                  `Feelings Hurt` = FeelingsHurt.n, 
                  `Right and Wrong` = RightandWrong.n)  %>% 
    tableM(Fights, `Feelings Hurt`, `Right and Wrong`,
           resp.opts = c(1:5)) %>% 
    pander::pander()
```


\newpage

##### Change
```{r,echo=FALSE}

Jail_clean %>% 
    dplyr::filter(in.analysis.sample == TRUE) %>% 
    dplyr::mutate(Fights = Fights_Change, 
                  `Feelings Hurt` = FeelingsHurt_Change, 
                  `Right and Wrong` = RightandWrong_Change)  %>% 
    tableM(Fights, `Feelings Hurt`, `Right and Wrong`,
           resp.opts = c(-2:4)) %>% 
    pander::pander()
```


##### Categorical Retro-Pre
```{r,echo=FALSE}
Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>% 
    dplyr::mutate(Fights = Fights_Before.3c, 
                  `Feelings Hurt` = FeelingsHurt_Before.3c, 
                  `Right and Wrong` = RightandWrong_Before.3c)  %>% 
    tableM(Fights, `Feelings Hurt`, `Right and Wrong`,
           resp.opts = c(3:5)) %>% 
    pander::pander()

```

##### Categorical Post
```{r,echo=FALSE}

Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>% 
    dplyr::mutate(Fights = Fights.3c, 
                  `Feelings Hurt` = FeelingsHurt.3c, 
                  `Right and Wrong` = RightandWrong.3c)  %>% 
    tableM(Fights, `Feelings Hurt`, `Right and Wrong`,
           resp.opts = c(3:5)) %>% 
    pander::pander()
```

\newpage

### Frequencies of Change in Outcomes Variables at Scale Level

* Collapsing Categories for Display of Frequencies, but not for Analyses

```{r,echo=FALSE}

Jail_clean %>% 
    dplyr::filter(in.analysis.sample == TRUE) %>%
    
    dplyr::mutate(Healthy_Rel_Skills_Change = dplyr::case_when(round(Healthy_Rel_Skills_Change, 2) <= 0 ~ "[-1,0]",
                                                               round(Healthy_Rel_Skills_Change, 2) <= 1 ~ "(0,1]",
                                                               round(Healthy_Rel_Skills_Change, 2) <= 2 ~ "(1,2]",
                                                               round(Healthy_Rel_Skills_Change, 2) <= 3 ~ "(2,3]",
                                                               round(Healthy_Rel_Skills_Change, 2) <= 4 ~ "(3,4]")) %>% 
    dplyr::mutate(Healthy_Rel_Skills_Change = factor(Healthy_Rel_Skills_Change, 
                                                      levels = c("[-1,0]", 
                                                                 "(0,1]",
                                                                 "(1,2]",
                                                                 "(2,3]",
                                                                 "(3,4]"))) %>% 
    
    dplyr::mutate(Partner_Selection_Change = dplyr::case_when(round(Partner_Selection_Change, 2) <= 0 ~ "[-1,0]",
                                                               round(Partner_Selection_Change, 2) <= 1 ~ "(0,1]",
                                                               round(Partner_Selection_Change, 2) <= 2 ~ "(1,2]",
                                                               round(Partner_Selection_Change, 2) <= 3 ~ "(2,3]",
                                                               round(Partner_Selection_Change, 2) <= 4 ~ "(3,4]")) %>% 
    dplyr::mutate(Partner_Selection_Change = factor(Partner_Selection_Change, 
                                                      levels = c("[-1,0]", 
                                                                 "(0,1]",
                                                                 "(1,2]",
                                                                 "(2,3]",
                                                                 "(3,4]"))) %>% 
    
    dplyr::mutate(Past_Rel_Behav_Change = dplyr::case_when(round(Past_Rel_Behav_Change, 2) <= 0 ~ "[-1,0]",
                                                               round(Past_Rel_Behav_Change, 2) <= 1 ~ "(0,1]",
                                                               round(Past_Rel_Behav_Change, 2) <= 2 ~ "(1,2]",
                                                               round(Past_Rel_Behav_Change, 2) <= 3 ~ "(2,3]",
                                                               round(Past_Rel_Behav_Change, 2) <= 4 ~ "(3,4]")) %>% 
    dplyr::mutate(Past_Rel_Behav_Change = factor(Past_Rel_Behav_Change, 
                                                      levels = c("[-1,0]", 
                                                                 "(0,1]",
                                                                 "(1,2]",
                                                                 "(2,3]",
                                                                 "(3,4]"))) %>%
    
    dplyr::mutate(Rel_Behav_Attit_Change = dplyr::case_when(round(Rel_Behav_Attit_Change, 2) <= 0 ~ "[-1,0]",
                                                               round(Rel_Behav_Attit_Change, 2) <= 1 ~ "(0,1]",
                                                               round(Rel_Behav_Attit_Change, 2) <= 2 ~ "(1,2]",
                                                               round(Rel_Behav_Attit_Change, 2) <= 3 ~ "(2,3]",
                                                               round(Rel_Behav_Attit_Change, 2) <= 4 ~ "(3,4]")) %>% 
    dplyr::mutate(Rel_Behav_Attit_Change = factor(Rel_Behav_Attit_Change, 
                                                      levels = c("[-1,0]", 
                                                                 "(0,1]",
                                                                 "(1,2]",
                                                                 "(2,3]",
                                                                 "(3,4]"))) %>% 
    dplyr::mutate(`Rel. Skills` = Healthy_Rel_Skills_Change,
                  `Prtnr. Sel.` = Partner_Selection_Change, 
                  `Past Rel. Beh.` = Past_Rel_Behav_Change,
                  `Rel. Beh. Att.` = Rel_Behav_Attit_Change) %>% 
    tableM(`Rel. Skills`, `Prtnr. Sel.`, `Past Rel. Beh.`, `Rel. Beh. Att.`)  %>% 
    pander::pander()


```

\newpage

# Exploratory Factor Analysis Treating Data as Continuous (On Full Sample)

## Retrospective-Pre

```{r, echo = FALSE}

Pre_vars <- Jail_clean %>% 
    dplyr::select(Healthy_Rel_Before.n, Communicate_Before.n, 
                  ConflictManagement_Before.n,

                  RightPartner_Before.n, LearnPartner_Before.n, 
                  PaceRelationship_Before.n, WarningSigns_Before.n,

                  LearnedGrowingUp_Before.n, PastRelationships_Before.n, 
                  GetAlongParents_Before.n, FriendshipsAreLike_Before.n,

                  Fights_Before.n, FeelingsHurt_Before.n, RightandWrong_Before.n)


Pre.EFA.Results1 <- psych::fa(r = Pre_vars,
                             nfactors = 1,
                             cor = "cor",
                             fm = "pa",
                             rotate = "Promax")

Pre.EFA.Results2 <- psych::fa(r =Pre_vars,
                             nfactors = 2,
                             cor = "cor",
                             fm = "pa",
                             rotate = "Promax")


Pre.EFA.Results3 <- psych::fa(r =Pre_vars,
                             nfactors = 3,
                             cor = "cor",
                             fm = "pa",
                             rotate = "Promax")


Pre.EFA.Results4 <- psych::fa(r =Pre_vars,
                             nfactors = 4,
                             cor = "cor",
                             fm = "pa",
                             rotate = "Promax")



Pre.EFA.Results5 <- psych::fa(r =Pre_vars,
                             nfactors = 5,
                             cor = "cor",
                             fm = "pa",
                             rotate = "Promax")



```

```{r, include=FALSE}

# Pre.EFA.Results1 <- factanal(data = Pre_vars,
#                              x = ~Healthy_Rel_Before.n + Communicate_Before.n + 
#                              ConflictManagement_Before.n +
# 
#                   RightPartner_Before.n + LearnPartner_Before.n + 
#                   PaceRelationship_Before.n + WarningSigns_Before.n +
# 
#                   LearnedGrowingUp_Before.n + PastRelationships_Before.n + 
#                   GetAlongParents_Before.n + FriendshipsAreLike_Before.n +
# 
#                   Fights_Before.n + FeelingsHurt_Before.n + RightandWrong_Before.n,
#                              factors = 4,
#                              rotation = "promax")


```



#### Determining Number of Factors

##### Screeplot

```{r,echo=FALSE}
df.Pre.EFA <- data.frame(Pre.EFA.Results1$e.values) 
df.Pre.EFA <- tibble::rowid_to_column(df.Pre.EFA, "Factor")

df.Pre.EFA %>% 
    ggplot2::ggplot(aes(x = Factor, y = Pre.EFA.Results1.e.values)) + geom_line() + theme_bw() +
    scale_x_continuous(breaks=seq(0,15,1))
```

\newpage

##### Proportion of Variance

```{r,echo=FALSE}

rbind(round(100*Pre.EFA.Results1$Vaccounted[2,], digits = 2)  %>% 
    data.frame() %>% 
    tibble::rownames_to_column() %>% 
    `colnames<-`(c("Factor", "Variance Explained")) %>% 
    dplyr::mutate(Factor = "PA1") %>% 
    dplyr::mutate(`Number of Factors` = 1),


round(100*Pre.EFA.Results2$Vaccounted[2,], digits = 2) %>% 
    data.frame() %>% 
    tibble::rownames_to_column() %>% 
    `colnames<-`(c("Factor", "Variance Explained")) %>% 
    dplyr::mutate(`Number of Factors` = 2),

round(100*Pre.EFA.Results3$Vaccounted[2,], digits = 2) %>% 
    data.frame() %>% 
    tibble::rownames_to_column() %>% 
    `colnames<-`(c("Factor", "Variance Explained")) %>% 
    dplyr::mutate(`Number of Factors` = 3),

round(100*Pre.EFA.Results4$Vaccounted[2,], digits = 2) %>% 
    data.frame() %>% 
    tibble::rownames_to_column() %>% 
    `colnames<-`(c("Factor", "Variance Explained")) %>% 
    dplyr::mutate(`Number of Factors` = 4),

round(100*Pre.EFA.Results5$Vaccounted[2,], digits = 2) %>% 
    data.frame() %>% 
    tibble::rownames_to_column() %>% 
    `colnames<-`(c("Factor", "Variance Explained")) %>% 
    dplyr::mutate(`Number of Factors` = 5)) %>% 
    
    dplyr::mutate(`Number of Factors` = factor(`Number of Factors`)) %>% 
    dplyr::mutate(Factor = factor(Factor,
                                  levels = c("PA5", 
                                             "PA4",
                                             "PA3",
                                             "PA2",
                                             "PA1"))) %>% 
    
    dplyr::group_by(`Number of Factors`) %>% 
    dplyr::arrange(`Number of Factors`, desc(Factor)) %>% 
    dplyr::mutate(label_ypos=cumsum(`Variance Explained`)) %>% 
    dplyr::ungroup() %>% 
    dplyr::mutate(Combined.Variance = paste0(formatC(`Variance Explained`,
                                                     format = "f", 
                                                     digits = 1),
                                             "% (", 
                                             formatC(label_ypos,
                                                     format = "f",
                                                     digits = 1), 
                                             "%)")) %>% 
    ggplot2::ggplot(aes(x = `Number of Factors`, y = `Variance Explained`, fill = Factor)) +
    geom_bar(stat = "identity") +
    # ylim(0, 100) + 
    scale_y_continuous(name = "Variance Explained", 
                       breaks = c(10, 20, 30, 40, 50, 60, 70, 80, 90, 100),
                       limits = c(0, 100)) +
    geom_text(aes(y=label_ypos,label=Combined.Variance), 
              # vjust=1,
              # color="white",
              size=2.4) +
        ggtitle("EFA on Retrospective Pre-Program Assessment: Variance Explained") + 
    theme_bw()

```

\newpage

##### Parallel Analysis

```{r,echo=FALSE, results='asis'}
psych::fa.parallel(Pre_vars,
                   cor = "cor",
                   # SMC = TRUE,
                   fa = "fa",
                   fm = "pa")

```

\newpage

##### EFA Results

###### One Factor

```{r,echo=FALSE, results='asis', message = FALSE}
summary(Pre.EFA.Results1)

```

&nbsp;

###### Two Factors

```{r,echo=FALSE, results='asis', message = FALSE}
summary(Pre.EFA.Results2)

```

\newpage

###### Three Factors


```{r,echo=FALSE, results='asis', message = FALSE}
summary(Pre.EFA.Results3)

```


&nbsp;

###### Four Factors

```{r,echo=FALSE, results='asis', message = FALSE}
summary(Pre.EFA.Results4)

```

\newpage
###### Five Factors

```{r,echo=FALSE, results='asis', message = FALSE}
summary(Pre.EFA.Results5)

```


\newpage

##### Comparing Loadings

###### One Factor

```{r,echo=FALSE, results='asis', message = FALSE}
psych::fa2latex(Pre.EFA.Results1)

```


&nbsp;

###### Two Factors

```{r,echo=FALSE, results='asis', message = FALSE}
psych::fa2latex(Pre.EFA.Results2)

```


\newpage

###### Three Factors

```{r,echo=FALSE, results='asis', message = FALSE}
psych::fa2latex(Pre.EFA.Results3)

```



\newpage

###### Four Factors

```{r,echo=FALSE, results='asis', message = FALSE}
psych::fa2latex(Pre.EFA.Results4)

```

\newpage

###### Five Factors

```{r,echo=FALSE, results='asis', message = FALSE}
psych::fa2latex(Pre.EFA.Results5)

```

\newpage

## Post
```{r,echo=FALSE}

Post_vars <- Jail_clean %>% 
    dplyr::select(
                  Healthy_Rel.n, Communicate.n, ConflictManagement.n,
                  
                  RightPartner.n, LearnPartner.n, 
                  PaceRelationship.n, WarningSigns.n,
                  
                  LearnedGrowingUp.n, PastRelationships.n, 
                  GetAlongParents.n, FriendshipsAreLike.n,
                  
                  Fights.n, FeelingsHurt.n, RightandWrong.n)




Post.EFA.Results1 <- psych::fa(r =Post_vars,
                             nfactors = 1,
                             cor = "cor",
                             fm = "pa",
                             rotate = "Promax")

Post.EFA.Results2 <- psych::fa(r =Post_vars,
                             nfactors = 2,
                             cor = "cor",
                             fm = "pa",
                             rotate = "Promax")

Post.EFA.Results3 <- psych::fa(r =Post_vars,
                             nfactors = 3,
                             cor = "cor",
                             fm = "pa",
                             rotate = "Promax")

Post.EFA.Results4 <- psych::fa(r =Post_vars,
                             nfactors = 4,
                             cor = "cor",
                             fm = "pa",
                             rotate = "Promax")


Post.EFA.Results5 <- psych::fa(r =Post_vars,
                             nfactors = 5,
                             cor = "cor",
                             fm = "pa",
                             rotate = "Promax")







```


#### Determining Number of Factors

##### Screeplot

```{r,echo=FALSE}
df.Post.EFA <- data.frame(Post.EFA.Results1$e.values) 
df.Post.EFA <- tibble::rowid_to_column(df.Post.EFA, "Factor")

df.Post.EFA %>% 
    ggplot2::ggplot(aes(x = Factor, y = Post.EFA.Results1.e.values)) + geom_line() + theme_bw() +
    scale_x_continuous(breaks=seq(0,15,1))
```


\newpage

##### Proportion of Variance

```{r,echo=FALSE}
rbind(round(100*Post.EFA.Results1$Vaccounted[2,], digits = 2)  %>% 
    data.frame() %>% 
    tibble::rownames_to_column() %>% 
    `colnames<-`(c("Factor", "Variance Explained")) %>% 
    dplyr::mutate(Factor = "PA1") %>% 
    dplyr::mutate(`Number of Factors` = 1),


round(100*Post.EFA.Results2$Vaccounted[2,], digits = 2) %>% 
    data.frame() %>% 
    tibble::rownames_to_column() %>% 
    `colnames<-`(c("Factor", "Variance Explained")) %>% 
    dplyr::mutate(`Number of Factors` = 2),

round(100*Post.EFA.Results3$Vaccounted[2,], digits = 2) %>% 
    data.frame() %>% 
    tibble::rownames_to_column() %>% 
    `colnames<-`(c("Factor", "Variance Explained")) %>% 
    dplyr::mutate(`Number of Factors` = 3),

round(100*Post.EFA.Results4$Vaccounted[2,], digits = 2) %>% 
    data.frame() %>% 
    tibble::rownames_to_column() %>% 
    `colnames<-`(c("Factor", "Variance Explained")) %>% 
    dplyr::mutate(`Number of Factors` = 4),

round(100*Post.EFA.Results5$Vaccounted[2,], digits = 2) %>% 
    data.frame() %>% 
    tibble::rownames_to_column() %>% 
    `colnames<-`(c("Factor", "Variance Explained")) %>% 
    dplyr::mutate(`Number of Factors` = 5)) %>% 
    
    dplyr::mutate(`Number of Factors` = factor(`Number of Factors`)) %>% 
    dplyr::mutate(Factor = factor(Factor,
                                  levels = c("PA5", 
                                             "PA4",
                                             "PA3",
                                             "PA2",
                                             "PA1"))) %>% 
    
    dplyr::group_by(`Number of Factors`) %>% 
    dplyr::arrange(`Number of Factors`, desc(Factor)) %>% 
    dplyr::mutate(label_ypos=cumsum(`Variance Explained`)) %>% 
    dplyr::ungroup() %>% 
    dplyr::mutate(Combined.Variance = paste0(formatC(`Variance Explained`,
                                                     format = "f", 
                                                     digits = 1),
                                             "% (", 
                                             formatC(label_ypos,
                                                     format = "f",
                                                     digits = 1), 
                                             "%)")) %>% 
    ggplot2::ggplot(aes(x = `Number of Factors`, y = `Variance Explained`, fill = Factor)) +
    geom_bar(stat = "identity") +
    # ylim(0, 100) + 
    scale_y_continuous(name = "Variance Explained", 
                       breaks = c(10, 20, 30, 40, 50, 60, 70, 80, 90, 100),
                       limits = c(0, 100)) +
    geom_text(aes(y=label_ypos,label=Combined.Variance), 
              # vjust=1,
              # color="white",
              size=2.4) +
        ggtitle("EFA on Post-Program Assessment: Variance Explained") + 
    theme_bw()









```
\newpage

##### Parallel Analysis

```{r,echo=FALSE, results='asis'}
psych::fa.parallel(Post_vars,
                   cor = "cor",
                   # SMC = TRUE,
                   fa = "fa",
                   fm = "pa")


```

\newpage 

##### EFA Results

###### One Factor

```{r,echo=FALSE, results='asis', message = FALSE}
summary(Post.EFA.Results1)

```


&nbsp;

###### Two Factors

```{r,echo=FALSE, results='asis', message = FALSE}
summary(Post.EFA.Results2)

```

\newpage
###### Three Factors

```{r,echo=FALSE, results='asis', message = FALSE}
summary(Post.EFA.Results3)

```


&nbsp;

###### Four Factors

```{r,echo=FALSE, results='asis', message = FALSE}
summary(Post.EFA.Results4)

```

\newpage
###### Five Factors

```{r,echo=FALSE, results='asis', message = FALSE}
summary(Post.EFA.Results5)

```


\newpage

##### Comparing Loadings

###### One Factor

```{r,echo=FALSE, results='asis', message = FALSE}
psych::fa2latex(Post.EFA.Results1)

```

&nbsp;

###### Two Factors

```{r,echo=FALSE, results='asis', message = FALSE}
psych::fa2latex(Post.EFA.Results2)

```


\newpage

###### Three Factors

```{r,echo=FALSE, results='asis', message = FALSE}
psych::fa2latex(Post.EFA.Results3)

```

\newpage

###### Four Factors

```{r,echo=FALSE, results='asis', message = FALSE}
psych::fa2latex(Post.EFA.Results4)

```

\newpage

###### Five Factors

```{r,echo=FALSE, results='asis', message = FALSE}
psych::fa2latex(Post.EFA.Results5)

```

\newpage


## Change
```{r,echo=FALSE}

Change_vars <- Jail_clean %>% 
    dplyr::select(Healthy_Rel_Change, Communicate_Change, ConflictManagement_Change, 
                  RightPartner_Change, LearnPartner_Change, 
                  PaceRelationship_Change, WarningSigns_Change, 
                  LearnedGrowingUp_Change, PastRelationships_Change, 
                  GetAlongParents_Change, FriendshipsAreLike_Change, 
                  Fights_Change, FeelingsHurt_Change, RightandWrong_Change)

Change.EFA.Results1 <- psych::fa(r =Change_vars,
                             nfactors = 1,
                             cor = "cor",
                             fm = "pa",
                             rotate = "Promax")

Change.EFA.Results2 <- psych::fa(r =Change_vars,
                             nfactors = 2,
                             cor = "cor",
                             fm = "pa",
                             rotate = "Promax")

Change.EFA.Results3 <- psych::fa(r =Change_vars,
                             nfactors = 3,
                             cor = "cor",
                             fm = "pa",
                             rotate = "Promax")

Change.EFA.Results4 <- psych::fa(r =Change_vars,
                             nfactors = 4,
                             cor = "cor",
                             fm = "pa",
                             rotate = "Promax")


Change.EFA.Results5 <- psych::fa(r =Change_vars,
                             nfactors = 5,
                             cor = "cor",
                             fm = "pa",
                             rotate = "Promax")







```


#### Determining Number of Factors

##### Screeplot

```{r,echo=FALSE}
df.Change.EFA <- data.frame(Change.EFA.Results1$e.values) 
df.Change.EFA <- tibble::rowid_to_column(df.Change.EFA, "Factor")

df.Change.EFA %>% 
    ggplot2::ggplot(aes(x = Factor, y = Change.EFA.Results1.e.values)) + 
    geom_line() + 
    theme_bw() +
    scale_x_continuous(breaks=seq(0,15,1))
```

\newpage

##### Proportion of Variance

```{r,echo=FALSE}



rbind(round(100*Change.EFA.Results1$Vaccounted[2,], digits = 2)  %>% 
    data.frame() %>% 
    tibble::rownames_to_column() %>% 
    `colnames<-`(c("Factor", "Variance Explained")) %>% 
    dplyr::mutate(Factor = "PA1") %>% 
    dplyr::mutate(`Number of Factors` = 1),


round(100*Change.EFA.Results2$Vaccounted[2,], digits = 2) %>% 
    data.frame() %>% 
    tibble::rownames_to_column() %>% 
    `colnames<-`(c("Factor", "Variance Explained")) %>% 
    dplyr::mutate(`Number of Factors` = 2),

round(100*Change.EFA.Results3$Vaccounted[2,], digits = 2) %>% 
    data.frame() %>% 
    tibble::rownames_to_column() %>% 
    `colnames<-`(c("Factor", "Variance Explained")) %>% 
    dplyr::mutate(`Number of Factors` = 3),

round(100*Change.EFA.Results4$Vaccounted[2,], digits = 2) %>% 
    data.frame() %>% 
    tibble::rownames_to_column() %>% 
    `colnames<-`(c("Factor", "Variance Explained")) %>% 
    dplyr::mutate(`Number of Factors` = 4),

round(100*Change.EFA.Results5$Vaccounted[2,], digits = 2) %>% 
    data.frame() %>% 
    tibble::rownames_to_column() %>% 
    `colnames<-`(c("Factor", "Variance Explained")) %>% 
    dplyr::mutate(`Number of Factors` = 5)) %>% 
    
    dplyr::mutate(`Number of Factors` = factor(`Number of Factors`)) %>% 
    dplyr::mutate(Factor = factor(Factor,
                                  levels = c("PA5", 
                                             "PA4",
                                             "PA3",
                                             "PA2",
                                             "PA1"))) %>% 
    
    dplyr::group_by(`Number of Factors`) %>% 
    dplyr::arrange(`Number of Factors`, desc(Factor)) %>% 
    dplyr::mutate(label_ypos=cumsum(`Variance Explained`)) %>% 
    dplyr::ungroup() %>% 
    dplyr::mutate(Combined.Variance = paste0(formatC(`Variance Explained`,
                                                     format = "f", 
                                                     digits = 1),
                                             "% (", 
                                             formatC(label_ypos,
                                                     format = "f",
                                                     digits = 1), 
                                             "%)")) %>% 
    ggplot2::ggplot(aes(x = `Number of Factors`, y = `Variance Explained`, fill = Factor)) +
    geom_bar(stat = "identity") +
    # ylim(0, 100) + 
    scale_y_continuous(name = "Variance Explained", 
                       breaks = c(10, 20, 30, 40, 50, 60, 70, 80, 90, 100),
                       limits = c(0, 100)) +
    geom_text(aes(y=label_ypos,label=Combined.Variance), 
              # vjust=1,
              # color="white",
              size=2.4) +
        ggtitle("EFA on Change Retro-Pre to Post-Program Assessment: Variance Explained") + 
    theme_bw()

```

\newpage

##### Parallel Analysis

```{r,echo=FALSE}
psych::fa.parallel(Change_vars,
                   cor = "cor",
                   # SMC = TRUE,
                   fa = "fa",
                   fm = "pa")


```

\newpage 

##### EFA Results

###### One Factor

```{r,echo=FALSE, results='asis', message = FALSE}
summary(Change.EFA.Results1)

```


&nbsp;

###### Two Factors

```{r,echo=FALSE, results='asis', message = FALSE}
summary(Change.EFA.Results2)

```

\newpage
###### Three Factors

```{r,echo=FALSE, results='asis', message = FALSE}
summary(Change.EFA.Results3)

```


&nbsp;

###### Four Factors

```{r,echo=FALSE, results='asis', message = FALSE}
summary(Change.EFA.Results4)

```

\newpage
###### Five Factors

```{r,echo=FALSE, results='asis', message = FALSE}
summary(Change.EFA.Results5)

```


\newpage

##### Comparing Loadings

###### One Factor

```{r,echo=FALSE, results='asis', message = FALSE}
psych::fa2latex(Change.EFA.Results1)

```

&nbsp;

###### Two Factors

```{r,echo=FALSE, results='asis', message = FALSE}
psych::fa2latex(Change.EFA.Results2)

```


\newpage

###### Three Factors

```{r,echo=FALSE, results='asis', message = FALSE}
psych::fa2latex(Change.EFA.Results3)

```

\newpage

###### Four Factors

```{r,echo=FALSE, results='asis', message = FALSE}
psych::fa2latex(Change.EFA.Results4)

```

\newpage

###### Five Factors

```{r,echo=FALSE, results='asis', message = FALSE}
psych::fa2latex(Change.EFA.Results5)

```

\newpage

# Confirmatory Factor Analysis (On Analytic Sample)

## Retrospective Pre

### Model Fit

```{r, echo=FALSE}
# specify the model
RPRE.model <- ' Healthy_Rel_Skills_Before =~ Healthy_Rel_Before.n + Communicate_Before.n + ConflictManagement_Before.n
                Partner_Selection_Before  =~ RightPartner_Before.n + LearnPartner_Before.n + 
                                             PaceRelationship_Before.n +  WarningSigns_Before.n
                Past_Rel_Behav_Before     =~ LearnedGrowingUp_Before.n + PastRelationships_Before.n + 
                                             GetAlongParents_Before.n + FriendshipsAreLike_Before.n
                Rel_Behav_Attit_Before    =~ NA*Fights_Before.n + 1*FeelingsHurt_Before.n + RightandWrong_Before.n '

# fit the model
RPRE.model.fit <- lavaan::cfa(RPRE.model, 
                              data=(Jail_clean %>% 
                                        dplyr::filter(in.analysis.sample3 == TRUE)),
                              estimator = "MLR")

# display summary output
lavaan::summary(RPRE.model.fit, fit.measures=TRUE, standardized=TRUE )
```

### Modification Indices

```{r, echo = FALSE}
lavaan::modificationindices(RPRE.model.fit) %>% 
    data.frame() %>% 
    dplyr::filter(mi>10) %>% 
    dplyr::arrange(-mi)
    
```

\newpage

### Dropping Fights (to improve Post Model Fit)

```{r, echo=FALSE}
# specify the model
RPRE.model2 <- ' Healthy_Rel_Skills_Before =~ Healthy_Rel_Before.n + Communicate_Before.n + ConflictManagement_Before.n
                Partner_Selection_Before  =~ RightPartner_Before.n + LearnPartner_Before.n + 
                                             PaceRelationship_Before.n +  WarningSigns_Before.n
                Past_Rel_Behav_Before     =~ LearnedGrowingUp_Before.n + PastRelationships_Before.n + 
                                             GetAlongParents_Before.n + FriendshipsAreLike_Before.n
                Rel_Behav_Attit_Before    =~ FeelingsHurt_Before.n + RightandWrong_Before.n '

# fit the model
RPRE.model2.fit <- lavaan::cfa(RPRE.model2, 
                              data=(Jail_clean %>% 
                                        dplyr::filter(in.analysis.sample3 == TRUE)),
                              estimator = "MLR")

# display summary output
lavaan::summary(RPRE.model2.fit, fit.measures=TRUE, standardized=TRUE )
```

\newpage
### Modification Indices

```{r, echo = FALSE}
lavaan::modificationindices(RPRE.model2.fit) %>% 
    data.frame() %>% 
    dplyr::filter(mi>10) %>% 
    dplyr::arrange(-mi)
    
```


\newpage

## Post

### Model Fit

```{r, echo=FALSE}
# specify the model
POST.model <- ' Healthy_Rel_Skills =~ Healthy_Rel.n + Communicate.n + ConflictManagement.n
                Partner_Selection  =~ RightPartner.n + LearnPartner.n + 
                                      PaceRelationship.n +  WarningSigns.n
                Past_Rel_Behav     =~ PastRelationships.n + 
                                      GetAlongParents.n + FriendshipsAreLike.n
                Rel_Behav_Attit    =~ NA*Fights.n + LearnedGrowingUp.n +  1*FeelingsHurt.n + RightandWrong.n 
                

               '

# fit the model
POST.model.fit <- lavaan::cfa(POST.model, 
                              data=(Jail_clean %>% 
                                        dplyr::filter(in.analysis.sample3 == TRUE)),
                              estimator = "MLR")

# display summary output
lavaan::summary(POST.model.fit, fit.measures=TRUE, standardized = TRUE)

lavaan::inspect(POST.model.fit,"cor.lv") 
# lavaan::inspect(POST.model.fit,"cov.lv") %>% det()
```

\newpage

### Modification Indices

* No covariances to add that make sense theoretically.

```{r, echo = FALSE}
lavaan::modificationindices(POST.model.fit) %>% 
    data.frame() %>% 
    dplyr::filter(mi>10) %>% 
    dplyr::arrange(-mi)
    
```

\newpage




### Dropping Fights

```{r, echo=FALSE}
# specify the model
POST.model2 <- ' Healthy_Rel_Skills =~ Healthy_Rel.n + Communicate.n + ConflictManagement.n
                Partner_Selection  =~ RightPartner.n + LearnPartner.n + 
                                      PaceRelationship.n +  WarningSigns.n
                Past_Rel_Behav     =~ LearnedGrowingUp.n + PastRelationships.n + 
                                      GetAlongParents.n + FriendshipsAreLike.n
                Rel_Behav_Attit    =~  FeelingsHurt.n + RightandWrong.n 
                
               '

# fit the model
POST.model2.fit <- lavaan::cfa(POST.model2, 
                              data=(Jail_clean %>% 
                                        dplyr::filter(in.analysis.sample3 == TRUE)),
                              estimator = "MLR")

# display summary output
lavaan::summary(POST.model2.fit, fit.measures=TRUE, standardized = TRUE)

# lavaan::inspect(POST.model.fit,"cov.lv")
```

\newpage

### Modification Indices

```{r, echo = FALSE}
lavaan::modificationindices(POST.model2.fit) %>% 
    data.frame() %>% 
    dplyr::filter(mi>10) %>% 
    dplyr::arrange(-mi)
    
```

\newpage

### Adding Error covariance

```{r, echo=FALSE}
# specify the model
POST.model3 <- ' Healthy_Rel_Skills =~ Healthy_Rel.n + Communicate.n + ConflictManagement.n
                Partner_Selection  =~ RightPartner.n + LearnPartner.n + 
                                      PaceRelationship.n +  WarningSigns.n
                Past_Rel_Behav     =~ LearnedGrowingUp.n + PastRelationships.n + 
                                      GetAlongParents.n + FriendshipsAreLike.n
                Rel_Behav_Attit    =~  FeelingsHurt.n + RightandWrong.n 
PastRelationships.n	~~	FriendshipsAreLike.n        # Not positive Definite

PastRelationships.n	~~	GetAlongParents.n

                # Healthy_Rel.n ~~ Communicate.n + ConflictManagement.n + RightPartner.n + 
                #                  LearnPartner.n + PaceRelationship.n + WarningSigns.n
                # 
                # Communicate.n ~~ ConflictManagement.n + RightPartner.n + 
                #                  LearnPartner.n + PaceRelationship.n + WarningSigns.n
                # 
                # ConflictManagement.n ~~  RightPartner.n + 
                #                  LearnPartner.n + PaceRelationship.n + WarningSigns.n
                # 
                # RightPartner.n ~~ LearnPartner.n + PaceRelationship.n + WarningSigns.n
                # 
                # LearnPartner.n ~~ PaceRelationship.n + WarningSigns.n
                # 
                # PaceRelationship.n ~~ WarningSigns.n

               '

# fit the model
POST.model3.fit <- lavaan::cfa(POST.model3, 
                              data=(Jail_clean %>% 
                                        dplyr::filter(in.analysis.sample3 == TRUE)),
                              estimator = "MLR")

# display summary output
lavaan::summary(POST.model3.fit, fit.measures=TRUE, standardized = TRUE)

# lavaan::inspect(POST.model.fit,"cor.lv")
# lavaan::inspect(POST.model.fit,"cov.lv") %>% det()
```
\newpage

### Modification Indices

```{r, echo = FALSE}
lavaan::modificationindices(POST.model3.fit) %>% 
    data.frame() %>% 
    dplyr::filter(mi>10) %>% 
    dplyr::arrange(-mi)
    
```

\newpage

### Warning

* CFA at post yields good fit if we drop fights and add several covariances (these should be checked for theoretical justification), but the model is still non-positive definite due to a correlation greater than 1 between latent variables.

* The data suggest that there are really only two factors. It could be that there are more than two, but the division of the items into additional factors yields factors that are so similar to one another that only 2 of the 4 can be used.

* CFA could be done on one factor at a time, but with only 3 items on 2 of the factors it would not be informative for those factors. This is because CFA on a single latent variable with 3 factors is just identified and has perfect fit.

* It would be best to try for a two-factor solution or use the four-factor solution, but only use 2 of the factors in subsequent analyses. 

* As seen below, reliability is good for all factors. However, the factors are redundant. If continuing with the 4 factor solution, the "fights" item should probably be placed on a different factor or dropped. It is not loading in the hypothesized way (see EFAs) and, therefore, may be interpreted by participants differently than expected. This raises questions about the meaning of the latent construct it is included on.

* Finally, robust maximum likelihood (MLR) was used to estimate CFA models. This helps adjust for the non-normal nature of the items. Items with only 3 actual categories probably are too non-normal and have too few categories to be fully addressed using MLR. They are better treated as categorical which has the added benefit of not treating the difference in response category levels as interval (i.e., equal).

\newpage

## Change

### Model Fit

```{r, echo=FALSE}
# specify the model
Change.model <- ' Healthy_Rel_Skills =~ Healthy_Rel_Change + Communicate_Change + 
                                        ConflictManagement_Change
                  Partner_Selection  =~ RightPartner_Change + LearnPartner_Change + 
                                        PaceRelationship_Change +  WarningSigns_Change
                  Past_Rel_Behav     =~ LearnedGrowingUp_Change + PastRelationships_Change + 
                                        GetAlongParents_Change + FriendshipsAreLike_Change
                  Rel_Behav_Attit    =~ Fights_Change + FeelingsHurt_Change + RightandWrong_Change '

# fit the model
Change.model.fit <- lavaan::cfa(Change.model, 
                              data=(Jail_clean %>% 
                                        dplyr::filter(in.analysis.sample3 == TRUE)),
                              estimator = "MLR")

# display summary output
lavaan::summary(Change.model.fit, fit.measures=TRUE, standardized = TRUE)
```

### Modification Indices

```{r, echo = FALSE}
lavaan::modificationindices(POST.model.fit) %>% 
    data.frame() %>% 
    dplyr::filter(mi>10) %>% 
    dplyr::arrange(-mi)
    
```


\newpage 

# Reliability of Scales (Using Analytic Sample): Chronbach's Alpha (Assumes Factor Loadings are Equivalent)

## Retrospective-Pre 

### Perceived Knowledge About Relationship Skills 

#### Cronbach's alpha (Average split half reliability)

```{r, echo = FALSE}
RPRE.Skills.alpha <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>%
    dplyr::select(Healthy_Rel_Before.n, Communicate_Before.n, 
                  ConflictManagement_Before.n) %>% 
    psych::alpha()

RPRE.Skills.alpha
```

\newpage

#### Congeneric reliability (Jreskog, 1971; Cho, 2016)

* Also called "composite reliability," "unidimensional omega," "Raju (1977) coefficient," and "worst split half reliability"

```{r, echo = FALSE}

RPRE.Skills.beta <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>%
    dplyr::select(Healthy_Rel_Before.n, Communicate_Before.n, 
                  ConflictManagement_Before.n) %>% 
    psych::ICLUST() 

RPRE.Skills.beta

RPRE.Skills.beta %>% 
    psych::ICLUST.graph(out.file="iclust.dot")

```

#### Summary

Cronbach's $\alpha$ = `r round(RPRE.Skills.alpha$total$raw_alpha, 2)`
Congeneric reliability $\beta$ = `r round(RPRE.Skills.beta$beta, 2)`

\newpage

### Perceived Knowledge About Partner Selection

#### Cronbach's alpha (Average split half reliability) 
```{r, echo = FALSE}

RPRE.Partner.alpha <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>%
    dplyr::select(RightPartner_Before.n, LearnPartner_Before.n, 
                  PaceRelationship_Before.n, WarningSigns_Before.n) %>% 
    psych::alpha()

RPRE.Partner.alpha
```

\newpage

#### Congeneric reliability (Jreskog, 1971; Cho, 2016)

* Also called "composite reliability," "unidimensional omega," "Raju (1977) coefficient," and "worst split half reliability"

```{r, echo = FALSE}

RPRE.Partner.beta <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>%
    dplyr::select(RightPartner_Before.n, LearnPartner_Before.n, 
                  PaceRelationship_Before.n, WarningSigns_Before.n) %>% 
    psych::ICLUST() 

RPRE.Partner.beta

RPRE.Partner.beta %>% 
    psych::ICLUST.graph(out.file="iclust.dot")

```

#### Summary

Cronbach's $\alpha$ = `r round(RPRE.Partner.alpha$total$raw_alpha, 2)`
Congeneric reliability $\beta$ = `r round(RPRE.Partner.beta$beta, 2)`

\newpage

### Perceived Importance of Knowledge About a Potential Partner's Relationships Patterns

#### Cronbach's alpha (Average split half reliability)

```{r, echo = FALSE}
RPRE.Patterns.alpha <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>%
    dplyr::select(LearnedGrowingUp_Before.n, PastRelationships_Before.n, 
                  GetAlongParents_Before.n, FriendshipsAreLike_Before.n) %>% 
    psych::alpha()

RPRE.Patterns.alpha
```

\newpage

#### Congeneric reliability (Jreskog, 1971; Cho, 2016)

* Also called "composite reliability," "unidimensional omega," "Raju (1977) coefficient," and "worst split half reliability"

```{r, echo = FALSE}

RPRE.Patterns.beta <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>%
    dplyr::select(LearnedGrowingUp_Before.n, PastRelationships_Before.n, 
                  GetAlongParents_Before.n, FriendshipsAreLike_Before.n) %>% 
    psych::ICLUST() 

RPRE.Patterns.beta

RPRE.Patterns.beta %>% 
    psych::ICLUST.graph(out.file="iclust.dot")

```

#### Summary

Cronbach's $\alpha$ = `r round(RPRE.Patterns.alpha$total$raw_alpha, 2)`
Congeneric reliability $\beta$ = `r round(RPRE.Patterns.beta$beta, 2)`

\newpage

### Perceived Importance of Knowledge About a Potential Partner's Relationship Behavior and Attitudes

#### Cronbach's alpha (Average split half reliability)


```{r, echo = FALSE}

RPRE.Behaviors.alpha <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>%
    dplyr::select(Fights_Before.n, FeelingsHurt_Before.n, 
                  RightandWrong_Before.n) %>% 
    psych::alpha()

RPRE.Behaviors.alpha

```

\newpage

#### Congeneric reliability (Jreskog, 1971; Cho, 2016)

* Also called "composite reliability," "unidimensional omega," "Raju (1977) coefficient," and "worst split half reliability"

```{r, echo = FALSE}

RPRE.Behaviors.beta <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>%
    dplyr::select(Fights_Before.n, FeelingsHurt_Before.n, 
                  RightandWrong_Before.n) %>% 
    psych::ICLUST() 

RPRE.Behaviors.beta

RPRE.Behaviors.beta %>% 
    psych::ICLUST.graph(out.file="iclust.dot")

```

#### Summary

Cronbach's $\alpha$ = `r round(RPRE.Behaviors.alpha$total$raw_alpha, 2)`
Congeneric reliability $\beta$ = `r round(RPRE.Behaviors.beta$beta, 2)`

\newpage

## Post

### Perceived Knowledge About Relationship Skills 

#### Cronbach's alpha (Average split half reliability)


```{r, echo = FALSE}

Post.Skills.alpha <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>%
    dplyr::select(Healthy_Rel.n, Communicate.n, ConflictManagement.n) %>% 
    psych::alpha()

Post.Skills.alpha
```

\newpage

#### Congeneric reliability (Jreskog, 1971; Cho, 2016)

* Also called "composite reliability," "unidimensional omega," "Raju (1977) coefficient," and "worst split half reliability"

```{r, echo = FALSE}

Post.Skills.beta <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>%
    dplyr::select(Healthy_Rel.n, Communicate.n, ConflictManagement.n) %>% 
    psych::ICLUST() 

Post.Skills.beta

Post.Skills.beta %>% 
    psych::ICLUST.graph(out.file="iclust.dot")

```

#### Summary

Cronbach's $\alpha$ = `r round(Post.Skills.alpha$total$raw_alpha, 2)`
Congeneric reliability $\beta$ = `r round(Post.Skills.beta$beta, 2)`

\newpage

### Perceived Knowledge About Partner Selection

#### Cronbach's alpha (Average split half reliability)


```{r, echo = FALSE}

Post.Partner.alpha <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>%
    dplyr::select(RightPartner.n, LearnPartner.n, 
                  PaceRelationship.n, WarningSigns.n) %>% 
    psych::alpha()

Post.Partner.alpha
```

\newpage


#### Congeneric reliability (Jreskog, 1971; Cho, 2016)

* Also called "composite reliability," "unidimensional omega," "Raju (1977) coefficient," and "worst split half reliability"

```{r, echo = FALSE}

Post.Partner.beta <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>%
    dplyr::select(RightPartner.n, LearnPartner.n, 
                  PaceRelationship.n, WarningSigns.n) %>% 
    psych::ICLUST() 

Post.Partner.beta

Post.Partner.beta %>% 
    psych::ICLUST.graph(out.file="iclust.dot")

```

#### Summary

Cronbach's $\alpha$ = `r round(Post.Partner.alpha$total$raw_alpha, 2)`
Congeneric reliability $\beta$ = `r round(Post.Partner.beta$beta, 2)`

\newpage

### Perceived Importance of Knowledge About a Potential Partner's Relationships Patterns

#### Cronbach's alpha (Average split half reliability)


```{r, echo = FALSE}

Post.Patterns.alpha <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>%
    dplyr::select(LearnedGrowingUp.n, PastRelationships.n, 
                  GetAlongParents.n, FriendshipsAreLike.n) %>% 
    psych::alpha()

Post.Patterns.alpha
```


\newpage

#### Congeneric reliability (Jreskog, 1971; Cho, 2016)

* Also called "composite reliability," "unidimensional omega," "Raju (1977) coefficient," and "worst split half reliability"

```{r, echo = FALSE}

Post.Patterns.beta <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>%
    dplyr::select(LearnedGrowingUp.n, PastRelationships.n, 
                  GetAlongParents.n, FriendshipsAreLike.n) %>% 
    psych::ICLUST() 

Post.Patterns.beta

Post.Patterns.beta %>% 
    psych::ICLUST.graph(out.file="iclust.dot")

```

#### Summary

Cronbach's $\alpha$ = `r round(Post.Patterns.alpha$total$raw_alpha, 2)`
Congeneric reliability $\beta$ = `r round(Post.Patterns.beta$beta, 2)`

\newpage

### Perceived Importance of Knowledge About a Potential Partner's Relationship Behavior and Attitudes

#### Cronbach's alpha (Average split half reliability)

```{r, echo = FALSE}

Post.Behaviors.alpha <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>%
    dplyr::select(Fights.n, FeelingsHurt.n, RightandWrong.n) %>% 
    psych::alpha()

Post.Behaviors.alpha
```

\newpage

#### Congeneric reliability (Jreskog, 1971; Cho, 2016)

* Also called "composite reliability," "unidimensional omega," "Raju (1977) coefficient," and "worst split half reliability"

```{r, echo = FALSE}

Post.Beahviors.beta <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>%
    dplyr::select(Fights.n, FeelingsHurt.n, RightandWrong.n) %>% 
    psych::ICLUST() 

Post.Beahviors.beta

Post.Beahviors.beta %>% 
    psych::ICLUST.graph(out.file="iclust.dot")

```

#### Summary

Cronbach's $\alpha$ = `r round(Post.Behaviors.alpha$total$raw_alpha, 2)`
Congeneric reliability $\beta$ = `r round(Post.Beahviors.beta$beta, 2)`

\newpage

## Change

### Perceived Knowledge About Relationship Skills 

#### Cronbach's alpha (Average split half reliability)

```{r, echo = FALSE}

Change.Skills.alpha <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample == TRUE) %>%
    dplyr::select(Healthy_Rel_Change, Communicate_Change, 
                  ConflictManagement_Change) %>% 
    psych::alpha()

Change.Skills.alpha
```


\newpage

#### Congeneric reliability (Jreskog, 1971; Cho, 2016)

* Also called "composite reliability," "unidimensional omega," "Raju (1977) coefficient," and "worst split half reliability"

```{r, echo = FALSE}

Change.Skills.beta <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample == TRUE) %>%
    dplyr::select(Healthy_Rel_Change, Communicate_Change, 
                  ConflictManagement_Change) %>% 
    psych::ICLUST() 

Change.Skills.beta

Change.Skills.beta %>% 
    psych::ICLUST.graph(out.file="iclust.dot")

```

#### Summary

Cronbach's $\alpha$ = `r round(Change.Skills.alpha$total$raw_alpha, 2)`
Congeneric reliability $\beta$ = `r round(Change.Skills.beta$beta, 2)`


\newpage

### Perceived Knowledge About Partner Selection

#### Cronbach's alpha (Average split half reliability)


```{r, echo = FALSE}

Change.Parnter.alpha <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample == TRUE) %>%
    dplyr::select(RightPartner_Change, LearnPartner_Change, 
                  PaceRelationship_Change, WarningSigns_Change) %>% 
    psych::alpha()

Change.Parnter.alpha
```

\newpage

#### Congeneric reliability (Jreskog, 1971; Cho, 2016)

* Also called "composite reliability," "unidimensional omega," "Raju (1977) coefficient," and "worst split half reliability"

```{r, echo = FALSE}

Change.Partner.beta <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample == TRUE) %>%
    dplyr::select(RightPartner_Change, LearnPartner_Change, 
                  PaceRelationship_Change, WarningSigns_Change) %>% 
    psych::ICLUST() 

Change.Partner.beta

Change.Partner.beta %>% 
    psych::ICLUST.graph(out.file="iclust.dot")

```

#### Summary

Cronbach's $\alpha$ = `r round(Change.Parnter.alpha$total$raw_alpha, 2)`
Congeneric reliability $\beta$ = `r round(Change.Partner.beta$beta, 2)`


\newpage


### Perceived Importance of Knowledge About a Potential Partner's Relationships Patterns

#### Cronbach's alpha (Average split half reliability)

```{r, echo = FALSE}

Change.Patterns.alpha <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample == TRUE) %>%
    dplyr::select(LearnedGrowingUp_Change, PastRelationships_Change,
                  GetAlongParents_Change, FriendshipsAreLike_Change) %>% 
    psych::alpha()

Change.Patterns.alpha
```

\newpage

#### Congeneric reliability (Jreskog, 1971; Cho, 2016)

* Also called "composite reliability," "unidimensional omega," "Raju (1977) coefficient," and "worst split half reliability"

```{r, echo = FALSE}

Change.Patterns.beta <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample == TRUE) %>%
    dplyr::select(LearnedGrowingUp_Change, PastRelationships_Change,
                  GetAlongParents_Change, FriendshipsAreLike_Change) %>% 
    psych::ICLUST() 

RPRE.Partner.beta

RPRE.Partner.beta %>% 
    psych::ICLUST.graph(out.file="iclust.dot")

```

#### Summary

Cronbach's $\alpha$ = `r round(Change.Patterns.alpha$total$raw_alpha, 2)`
Congeneric reliability $\beta$ = `r round(Change.Patterns.beta$beta, 2)`


\newpage

### Perceived Importance of Knowledge About a Potential Partner's Relationship Behavior and Attitudes

#### Cronbach's alpha (Average split half reliability)


```{r, echo = FALSE}


Change.Behaviors.alpha <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample == TRUE) %>%
    dplyr::select(Fights_Change, FeelingsHurt_Change, RightandWrong_Change) %>% 
    psych::alpha()

Change.Behaviors.alpha
```

\newpage

#### Congeneric reliability (Jreskog, 1971; Cho, 2016)

* Also called "composite reliability," "unidimensional omega," "Raju (1977) coefficient," and "worst split half reliability"

```{r, echo = FALSE}

Change.Behaviors.beta <- Jail_clean %>% 
    dplyr::filter(in.analysis.sample == TRUE) %>%
    dplyr::select(Fights_Change, FeelingsHurt_Change, RightandWrong_Change) %>% 
    psych::ICLUST() 

Change.Behaviors.beta

Change.Behaviors.beta %>% 
    psych::ICLUST.graph(out.file="iclust.dot")

```

#### Summary

Cronbach's $\alpha$ = `r round(Change.Behaviors.alpha$total$raw_alpha, 2)`
Congeneric reliability $\beta$ = `r round(Change.Behaviors.beta$beta, 2)`
 
\newpage     
 
 
# Exploratory Factor Analysis Treating Data as Categorical (On Full Sample)

## Retrospective-Pre

```{r, echo = FALSE}

Pre_vars.c <- Jail_clean %>% 
    dplyr::select(Healthy_Rel_Before.3n, Communicate_Before.3n, 
                  ConflictManagement_Before.3n,

                  RightPartner_Before.3n, LearnPartner_Before.3n, 
                  PaceRelationship_Before.3n, WarningSigns_Before.3n,

                  LearnedGrowingUp_Before.3n, PastRelationships_Before.3n, 
                  GetAlongParents_Before.3n, FriendshipsAreLike_Before.3n,

                  Fights_Before.3n, FeelingsHurt_Before.3n, RightandWrong_Before.3n)


Pre.EFA.Results1c <- psych::fa(r = Pre_vars.c,
                             nfactors = 1,
                             cor = "poly",
                             fm = "wls",
                             rotate = "Promax")

Pre.EFA.Results2c <- psych::fa(r =Pre_vars.c,
                             nfactors = 2,
                             cor = "poly",
                             fm = "wls",
                             rotate = "Promax")


Pre.EFA.Results3c <- psych::fa(r =Pre_vars.c,
                             nfactors = 3,
                             cor = "poly",
                             fm = "wls",
                             rotate = "Promax")


Pre.EFA.Results4c <- psych::fa(r =Pre_vars.c,
                             nfactors = 4,
                             cor = "poly",
                             fm = "wls",
                             rotate = "Promax")



Pre.EFA.Results5c <- psych::fa(r =Pre_vars.c,
                             nfactors = 5,
                             cor = "poly",
                             fm = "wls",
                             rotate = "Promax")



```


\newpage

#### Determining Number of Factors

##### Screeplot

```{r,echo=FALSE}
df.Pre.EFA.c <- data.frame(Pre.EFA.Results1c$e.values) 
df.Pre.EFA.c <- tibble::rowid_to_column(df.Pre.EFA.c, "Factor")

df.Pre.EFA.c %>% 
    ggplot2::ggplot(aes(x = Factor, y = Pre.EFA.Results1c.e.values)) + geom_line() + theme_bw() +
    scale_x_continuous(breaks=seq(0,15,1))
```

\newpage

##### Proportion of Variance

```{r,echo=FALSE}

rbind(round(100*Pre.EFA.Results1c$Vaccounted[2,], digits = 2)  %>% 
    data.frame() %>% 
    tibble::rownames_to_column() %>% 
    `colnames<-`(c("Factor", "Variance Explained")) %>% 
    dplyr::mutate(Factor = "WLS1") %>% 
    dplyr::mutate(`Number of Factors` = 1),


round(100*Pre.EFA.Results2c$Vaccounted[2,], digits = 2) %>% 
    data.frame() %>% 
    tibble::rownames_to_column() %>% 
    `colnames<-`(c("Factor", "Variance Explained")) %>% 
    dplyr::mutate(`Number of Factors` = 2),

round(100*Pre.EFA.Results3c$Vaccounted[2,], digits = 2) %>% 
    data.frame() %>% 
    tibble::rownames_to_column() %>% 
    `colnames<-`(c("Factor", "Variance Explained")) %>% 
    dplyr::mutate(`Number of Factors` = 3),

round(100*Pre.EFA.Results4c$Vaccounted[2,], digits = 2) %>% 
    data.frame() %>% 
    tibble::rownames_to_column() %>% 
    `colnames<-`(c("Factor", "Variance Explained")) %>% 
    dplyr::mutate(`Number of Factors` = 4),

round(100*Pre.EFA.Results5c$Vaccounted[2,], digits = 2) %>% 
    data.frame() %>% 
    tibble::rownames_to_column() %>% 
    `colnames<-`(c("Factor", "Variance Explained")) %>% 
    dplyr::mutate(`Number of Factors` = 5)) %>% 
    
    dplyr::mutate(`Number of Factors` = factor(`Number of Factors`)) %>% 
    dplyr::mutate(Factor = factor(Factor,
                                  levels = c("WLS5", 
                                             "WLS4",
                                             "WLS3",
                                             "WLS2",
                                             "WLS1"))) %>% 
    
    dplyr::group_by(`Number of Factors`) %>% 
    dplyr::arrange(`Number of Factors`, desc(Factor)) %>% 
    dplyr::mutate(label_ypos=cumsum(`Variance Explained`)) %>% 
    dplyr::ungroup() %>% 
    dplyr::mutate(Combined.Variance = paste0(formatC(`Variance Explained`,
                                                     format = "f", 
                                                     digits = 1),
                                             "% (", 
                                             formatC(label_ypos,
                                                     format = "f",
                                                     digits = 1), 
                                             "%)")) %>% 
    ggplot2::ggplot(aes(x = `Number of Factors`, y = `Variance Explained`, fill = Factor)) +
    geom_bar(stat = "identity") +
    # ylim(0, 100) + 
    scale_y_continuous(name = "Variance Explained", 
                       breaks = c(10, 20, 30, 40, 50, 60, 70, 80, 90, 100),
                       limits = c(0, 100)) +
    geom_text(aes(y=label_ypos,label=Combined.Variance), 
              # vjust=1,
              # color="white",
              size=2.4) +
        ggtitle("EFA on Retrospective Categorical Pre-Program Assessment: Variance Explained") + 
    theme_bw()

```

\newpage

##### Parallel Analysis

```{r,echo=FALSE, results='asis'}
psych::fa.parallel(Pre_vars.c,
                   cor = "poly",
                   # SMC = TRUE,
                   fa = "fa",
                   fm = "wls")

```

\newpage


 
 
##### EFA Results

###### One Factor

```{r,echo=FALSE, results='asis', message = FALSE}
summary(Pre.EFA.Results1c)

```

&nbsp;

###### Two Factors

```{r,echo=FALSE, results='asis', message = FALSE}
summary(Pre.EFA.Results2c)

```

\newpage

###### Three Factors


```{r,echo=FALSE, results='asis', message = FALSE}
summary(Pre.EFA.Results3c)

```


&nbsp;

###### Four Factors

```{r,echo=FALSE, results='asis', message = FALSE}
summary(Pre.EFA.Results4c)

```

\newpage
###### Five Factors

```{r,echo=FALSE, results='asis', message = FALSE}
summary(Pre.EFA.Results5c)

```


\newpage

##### Comparing Loadings

###### One Factor

```{r,echo=FALSE, results='asis', message = FALSE}
psych::fa2latex(Pre.EFA.Results1c)

```


&nbsp;

###### Two Factors

```{r,echo=FALSE, results='asis', message = FALSE}
psych::fa2latex(Pre.EFA.Results2c)

```


\newpage

###### Three Factors

```{r,echo=FALSE, results='asis', message = FALSE}
psych::fa2latex(Pre.EFA.Results3c)

```



\newpage

###### Four Factors

```{r,echo=FALSE, results='asis', message = FALSE}
psych::fa2latex(Pre.EFA.Results4c)

```

\newpage

###### Five Factors

```{r,echo=FALSE, results='asis', message = FALSE}
psych::fa2latex(Pre.EFA.Results5c)

```

\newpage

## Post
```{r,echo=FALSE}

Post_vars.c <- Jail_clean %>% 
    dplyr::select(
                  Healthy_Rel.3n, Communicate.3n, ConflictManagement.3n,
                  
                  RightPartner.3n, LearnPartner.3n, 
                  PaceRelationship.3n, WarningSigns.3n,
                  
                  LearnedGrowingUp.3n, PastRelationships.3n, 
                  GetAlongParents.3n, FriendshipsAreLike.3n,
                  
                  Fights.3n, FeelingsHurt.3n, RightandWrong.3n)




Post.EFA.Results1c <- psych::fa(r =Post_vars.c,
                             nfactors = 1,
                             cor = "cor",
                             fm = "pa",
                             rotate = "Promax")

Post.EFA.Results2c <- psych::fa(r =Post_vars.c,
                             nfactors = 2,
                             cor = "cor",
                             fm = "pa",
                             rotate = "Promax")

Post.EFA.Results3c <- psych::fa(r =Post_vars.c,
                             nfactors = 3,
                             cor = "cor",
                             fm = "pa",
                             rotate = "Promax")

Post.EFA.Results4c <- psych::fa(r =Post_vars.c,
                             nfactors = 4,
                             cor = "cor",
                             fm = "pa",
                             rotate = "Promax")


Post.EFA.Results5c <- psych::fa(r =Post_vars.c,
                             nfactors = 5,
                             cor = "cor",
                             fm = "pa",
                             rotate = "Promax")







```


#### Determining Number of Factors

##### Screeplot

```{r,echo=FALSE}
df.Post.EFA.c <- data.frame(Post.EFA.Results1c$e.values) 
df.Post.EFA.c <- tibble::rowid_to_column(df.Post.EFA.c, "Factor")

df.Post.EFA.c %>% 
    ggplot2::ggplot(aes(x = Factor, y = Post.EFA.Results1c.e.values)) + geom_line() + theme_bw() +
    scale_x_continuous(breaks=seq(0,15,1))
```


\newpage

##### Proportion of Variance

```{r,echo=FALSE}
rbind(round(100*Post.EFA.Results1c$Vaccounted[2,], digits = 2)  %>% 
    data.frame() %>% 
    tibble::rownames_to_column() %>% 
    `colnames<-`(c("Factor", "Variance Explained")) %>% 
    dplyr::mutate(Factor = "PA1") %>% 
    dplyr::mutate(`Number of Factors` = 1),


round(100*Post.EFA.Results2c$Vaccounted[2,], digits = 2) %>% 
    data.frame() %>% 
    tibble::rownames_to_column() %>% 
    `colnames<-`(c("Factor", "Variance Explained")) %>% 
    dplyr::mutate(`Number of Factors` = 2),

round(100*Post.EFA.Results3c$Vaccounted[2,], digits = 2) %>% 
    data.frame() %>% 
    tibble::rownames_to_column() %>% 
    `colnames<-`(c("Factor", "Variance Explained")) %>% 
    dplyr::mutate(`Number of Factors` = 3),

round(100*Post.EFA.Results4c$Vaccounted[2,], digits = 2) %>% 
    data.frame() %>% 
    tibble::rownames_to_column() %>% 
    `colnames<-`(c("Factor", "Variance Explained")) %>% 
    dplyr::mutate(`Number of Factors` = 4),

round(100*Post.EFA.Results5c$Vaccounted[2,], digits = 2) %>% 
    data.frame() %>% 
    tibble::rownames_to_column() %>% 
    `colnames<-`(c("Factor", "Variance Explained")) %>% 
    dplyr::mutate(`Number of Factors` = 5)) %>% 
    
    dplyr::mutate(`Number of Factors` = factor(`Number of Factors`)) %>% 
    dplyr::mutate(Factor = factor(Factor,
                                  levels = c("PA5", 
                                             "PA4",
                                             "PA3",
                                             "PA2",
                                             "PA1"))) %>% 
    
    dplyr::group_by(`Number of Factors`) %>% 
    dplyr::arrange(`Number of Factors`, desc(Factor)) %>% 
    dplyr::mutate(label_ypos=cumsum(`Variance Explained`)) %>% 
    dplyr::ungroup() %>% 
    dplyr::mutate(Combined.Variance = paste0(formatC(`Variance Explained`,
                                                     format = "f", 
                                                     digits = 1),
                                             "% (", 
                                             formatC(label_ypos,
                                                     format = "f",
                                                     digits = 1), 
                                             "%)")) %>% 
    ggplot2::ggplot(aes(x = `Number of Factors`, y = `Variance Explained`, fill = Factor)) +
    geom_bar(stat = "identity") +
    # ylim(0, 100) + 
    scale_y_continuous(name = "Variance Explained", 
                       breaks = c(10, 20, 30, 40, 50, 60, 70, 80, 90, 100),
                       limits = c(0, 100)) +
    geom_text(aes(y=label_ypos,label=Combined.Variance), 
              # vjust=1,
              # color="white",
              size=2.4) +
        ggtitle("EFA on Categorical Post-Program Assessment: Variance Explained") + 
    theme_bw()









```
\newpage

##### Parallel Analysis

```{r,echo=FALSE, results='asis'}
psych::fa.parallel(Post_vars.c,
                   cor = "cor",
                   # SMC = TRUE,
                   fa = "fa",
                   fm = "pa")


```

\newpage 

##### EFA Results

###### One Factor

```{r,echo=FALSE, results='asis', message = FALSE}
summary(Post.EFA.Results1c)

```


&nbsp;

###### Two Factors

```{r,echo=FALSE, results='asis', message = FALSE}
summary(Post.EFA.Results2c)

```

\newpage
###### Three Factors

```{r,echo=FALSE, results='asis', message = FALSE}
summary(Post.EFA.Results3c)

```


&nbsp;

###### Four Factors

```{r,echo=FALSE, results='asis', message = FALSE}
summary(Post.EFA.Results4c)

```

\newpage
###### Five Factors

```{r,echo=FALSE, results='asis', message = FALSE}
summary(Post.EFA.Results5c)

```


\newpage

##### Comparing Loadings

###### One Factor

```{r,echo=FALSE, results='asis', message = FALSE}
psych::fa2latex(Post.EFA.Results1c)

```

&nbsp;

###### Two Factors

```{r,echo=FALSE, results='asis', message = FALSE}
psych::fa2latex(Post.EFA.Results2c)

```


\newpage

###### Three Factors

```{r,echo=FALSE, results='asis', message = FALSE}
psych::fa2latex(Post.EFA.Results3c)

```

\newpage

###### Four Factors

```{r,echo=FALSE, results='asis', message = FALSE}
psych::fa2latex(Post.EFA.Results4c)

```

\newpage

###### Five Factors

```{r,echo=FALSE, results='asis', message = FALSE}
psych::fa2latex(Post.EFA.Results5c)

```

\newpage
 
 
                  
# Confirmatory Factor Analysis (On Analytic Sample)

## Categorical Retrospective Pre

### Model Fit

```{r, echo=FALSE}
# specify the model
RPRE.model.c <- ' Healthy_Rel_Skills_Before =~ Healthy_Rel_Before.3n + Communicate_Before.3n + ConflictManagement_Before.3n
                Partner_Selection_Before  =~ RightPartner_Before.3n + LearnPartner_Before.3n + 
                                             PaceRelationship_Before.3n +  WarningSigns_Before.3n
                Past_Rel_Behav_Before     =~ LearnedGrowingUp_Before.3n + PastRelationships_Before.3n + 
                                             GetAlongParents_Before.3n + FriendshipsAreLike_Before.3n
                Rel_Behav_Attit_Before    =~ Fights_Before.3n + FeelingsHurt_Before.3n + RightandWrong_Before.3n '

# fit the model
RPRE.model.fit.c <- lavaan::cfa(RPRE.model.c, 
                              data=(Jail_clean %>% 
                                        dplyr::filter(in.analysis.sample3 == TRUE)),
                              estimator = "WLSMV",
                              ordered = c("Healthy_Rel_Before.3n" , "Communicate_Before.3n" ,
                                          "ConflictManagement_Before.3n",
                                          "RightPartner_Before.3n", "LearnPartner_Before.3n",
                                          "PaceRelationship_Before.3n",  "WarningSigns_Before.3n",
                                          "LearnedGrowingUp_Before.3n", "PastRelationships_Before.3n",
                                          "GetAlongParents_Before.3n", "FriendshipsAreLike_Before.3n",
                                          "Fights_Before.3n", "FeelingsHurt_Before.3n", 
                                          "RightandWrong_Before.3n"))

# display summary output
lavaan::summary(RPRE.model.fit.c, fit.measures=TRUE, standardized=TRUE )
```

### Modification Indices

```{r, echo = FALSE}
lavaan::modificationindices(RPRE.model.fit.c) %>% 
    data.frame() %>% 
    dplyr::filter(mi>10) %>% 
    dplyr::arrange(-mi)
    
```




\newpage

### Two Factor Solution

```{r, echo=FALSE}
# specify the model
RPRE.model.c2 <- ' Skills_and_Partner_Sel =~ Healthy_Rel_Before.3n + Communicate_Before.3n +                
                                             ConflictManagement_Before.3n + RightPartner_Before.3n +
                                             LearnPartner_Before.3n + PaceRelationship_Before.3n +  
                                             WarningSigns_Before.3n
                  Behav_Attit_Patterns    =~ LearnedGrowingUp_Before.3n + PastRelationships_Before.3n + 
                                             GetAlongParents_Before.3n + FriendshipsAreLike_Before.3n + 
                                             Fights_Before.3n + FeelingsHurt_Before.3n +
                                             RightandWrong_Before.3n '

# fit the model
RPRE.model.fit.c2 <- lavaan::cfa(RPRE.model.c2, 
                              data=(Jail_clean %>% 
                                        dplyr::filter(in.analysis.sample3 == TRUE)),
                              estimator = "WLSMV",
                              ordered = c("Healthy_Rel_Before.3n" , "Communicate_Before.3n" ,
                                          "ConflictManagement_Before.3n",
                                          "RightPartner_Before.3n", "LearnPartner_Before.3n",
                                          "PaceRelationship_Before.3n",  "WarningSigns_Before.3n",
                                          "LearnedGrowingUp_Before.3n", "PastRelationships_Before.3n",
                                          "GetAlongParents_Before.3n", "FriendshipsAreLike_Before.3n",
                                          "Fights_Before.3n", "FeelingsHurt_Before.3n",
                                          "RightandWrong_Before.3n"))

# display summary output
lavaan::summary(RPRE.model.fit.c2, fit.measures=TRUE, standardized=TRUE )
```

\newpage

### Modification Indices

```{r, echo = FALSE}
lavaan::modificationindices(RPRE.model.fit.c2) %>% 
    data.frame() %>% 
    dplyr::filter(mi>10) %>% 
    dplyr::arrange(-mi)
    
```




\newpage



## Categorical Retrospective Post

### Model Fit

```{r, echo=FALSE}
# specify the model
POST.model.c <- '


HRS.post =~ Healthy_Rel.3n + Communicate.3n +   
            ConflictManagement.3n
                 
PS.post  =~ RightPartner.3n + LearnPartner.3n + 
            PaceRelationship.3n +  WarningSigns.3n

PRB.post =~ LearnedGrowingUp.3n + PastRelationships.3n + 
            GetAlongParents.3n + FriendshipsAreLike.3n

RBA.post =~ Fights.3n + FeelingsHurt.3n + RightandWrong.3n 

            

               '

# fit the model
POST.model.fitc <- lavaan::cfa(POST.model.c,                 
                              data=(Jail_clean %>% 
                                        dplyr::filter(in.analysis.sample3 == TRUE)),
                              estimator = "WLSMV",
                              ordered = c("Healthy_Rel.3n" , "Communicate.3n" ,
                                          "ConflictManagement.3n",
                                          "RightPartner.3n", "LearnPartner.3n",
                                          "PaceRelationship.3n",  "WarningSigns.3n",
                                          "LearnedGrowingUp.3n", "PastRelationships.3n",
                                          "GetAlongParents.3n", "FriendshipsAreLike.3n",
                                          "Fights.3n", "FeelingsHurt.3n", "RightandWrong.3n"))
                              

# display summary output
lavaan::summary(POST.model.fitc, fit.measures=TRUE, standardized = TRUE)

# lavaan::inspect(POST.model.fitc,"cor.lv") 
# lavaan::inspect(POST.model.fit,"cov.lv") %>% det()
```

\newpage

### Modification Indices

```{r, echo = FALSE}
lavaan::modificationindices(POST.model.fitc) %>% 
    data.frame() %>% 
    dplyr::filter(mi>10) %>% 
    dplyr::arrange(-mi)
    
```
\newpage

### Two Factor Solution

```{r, echo=FALSE}
# specify the model
POST.model.c2 <- 'Skills_and_Partner_Sel =~ Healthy_Rel.3n + Communicate.3n +                
                                             ConflictManagement.3n + RightPartner.3n +
                                             LearnPartner.3n + PaceRelationship.3n +  
                                             WarningSigns.3n
                  Behav_Attit_Patterns    =~ LearnedGrowingUp.3n + PastRelationships.3n + 
                                             GetAlongParents.3n + FriendshipsAreLike.3n + 
                                             Fights.3n + FeelingsHurt.3n +
                                             RightandWrong.3n 

ConflictManagement.3n	~~	RightPartner.3n

'




# fit the model
POST.model.fitc2 <- lavaan::cfa(POST.model.c2,                 
                              data=(Jail_clean %>% 
                                        dplyr::filter(in.analysis.sample3 == TRUE)),
                              estimator = "WLSMV",
                              ordered = c("Healthy_Rel.3n" , "Communicate.3n" ,
                                          "ConflictManagement.3n",
                                          "RightPartner.3n", "LearnPartner.3n",
                                          "PaceRelationship.3n",  "WarningSigns.3n",
                                          "LearnedGrowingUp.3n", "PastRelationships.3n",
                                          "GetAlongParents.3n", "FriendshipsAreLike.3n",
                                          "Fights.3n", "FeelingsHurt.3n",
                                          "RightandWrong.3n"))
                              

# display summary output
lavaan::summary(POST.model.fitc2, fit.measures=TRUE, standardized = TRUE)

# lavaan::inspect(POST.model.fitc,"cor.lv") 
# lavaan::inspect(POST.model.fit,"cov.lv") %>% det()
```

\newpage

### Modification Indices

```{r, echo = FALSE}
lavaan::modificationindices(POST.model.fitc2) %>% 
    data.frame() %>% 
    dplyr::filter(mi>10) %>% 
    dplyr::arrange(-mi)
    
```


\newpage



## Categorical Retrospective Pre and Post

```{r, echo=FALSE}
# specify the model
Rcomb.model.c <- ' 

# Latent common factor definitions

HRS.rpre =~ Healthy_Rel_Before.3n + Communicate_Before.3n + 
            ConflictManagement_Before.3n
HRS.post =~ Healthy_Rel.3n + Communicate.3n +   
            ConflictManagement.3n
                 
PS.rpre  =~ RightPartner_Before.3n + LearnPartner_Before.3n + 
            PaceRelationship_Before.3n +  WarningSigns_Before.3n
PS.post  =~ RightPartner.3n + LearnPartner.3n + 
            PaceRelationship.3n +  WarningSigns.3n

PRB.rpre =~ LearnedGrowingUp_Before.3n + PastRelationships_Before.3n + 
            GetAlongParents_Before.3n + FriendshipsAreLike_Before.3n
PRB.post =~ LearnedGrowingUp.3n + PastRelationships.3n + 
            GetAlongParents.3n + FriendshipsAreLike.3n

RBA.rpre =~ Fights_Before.3n + FeelingsHurt_Before.3n + RightandWrong_Before.3n 
RBA.post =~ Fights.3n + FeelingsHurt.3n + RightandWrong.3n 

# Latent common factor variances and covariances

HRS.rpre ~~ HRS.rpre + HRS.post + PS.rpre + PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
HRS.post ~~ HRS.post + PS.rpre + PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
PS.rpre  ~~ PS.rpre + PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
PS.post  ~~ PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
PRB.rpre ~~ PRB.rpre + PRB.post + RBA.rpre + RBA.post
PRB.post ~~ PRB.post + RBA.rpre + RBA.post
RBA.rpre ~~ RBA.rpre + RBA.post
RBA.post ~~ RBA.post

# Latent common factor means
# Fix T1 common factor mean to zero

HRS.rpre ~ 0*1
# Freely estimate T2-T4 common factor means
HRS.post ~ 1 
PS.rpre ~ 0*1 
PS.post ~ 1 
PRB.rpre ~ 0*1 
PRB.post ~ 1 
RBA.rpre ~ 0*1 
RBA.post ~ 1 

# Thresholds
# t1 and t2 after * represent the first and second 
#    thresholds of an indicator, respectively
# Threshold parameters that are freely estimated have labels VaTbtc,
#   with a representing indicator number, b representing time,
#   c representing ordering of the threshold (first, second)
# Threshold parameters that are constrained to be equal over time
#   are given the labels Vatc, with a representing indicator number, 
#   c representing ordering of the threshold (first, second)

Healthy_Rel_Before.3n | V1t1*t1 + V1t2*t2 
Healthy_Rel.3n        | V1t1*t1 + V1t2*t2 

Communicate_Before.3n | V2t1*t1 + V2T1t2*t2 
Communicate.3n        | V2t1*t1 + V2T2t2*t2 

ConflictManagement_Before.3n | V3t1*t1 + V3T1t2*t2 
ConflictManagement.3n        | V3t1*t1 + V3T2t2*t2 



RightPartner_Before.3n | V4t1*t1 + V4t2*t2 
RightPartner.3n        | V4t1*t1 + V4t2*t2 

LearnPartner_Before.3n | V5t1*t1 + V5T1t2*t2 
LearnPartner.3n        | V5t1*t1 + V5T2t2*t2 

PaceRelationship_Before.3n | V6t1*t1 + V6T1t2*t2 
PaceRelationship.3n        | V6t1*t1 + V6T2t2*t2 

WarningSigns_Before.3n | V7t1*t1 + V7T1t2*t2 
WarningSigns.3n        | V7t1*t1 + V7T2t2*t2 



LearnedGrowingUp_Before.3n | V8t1*t1 + V8t2*t2 
LearnedGrowingUp.3n        | V8t1*t1 + V8t2*t2 

PastRelationships_Before.3n | V9t1*t1 + V9T1t2*t2 
PastRelationships.3n        | V9t1*t1 + V9T2t2*t2 

GetAlongParents_Before.3n | V10t1*t1 + V10T1t2*t2 
GetAlongParents.3n        | V10t1*t1 + V10T2t2*t2 

FriendshipsAreLike_Before.3n | V11t1*t1 + V11T1t2*t2 
FriendshipsAreLike.3n        | V11t1*t1 + V11T2t2*t2 

 

Fights_Before.3n | V12t1*t1 + V12t2*t2 
Fights.3n        | V12t1*t1 + V12t2*t2 

FeelingsHurt_Before.3n | V13t1*t1 + V13T1t2*t2 
FeelingsHurt.3n        | V13t1*t1 + V13T2t2*t2 

RightandWrong_Before.3n | V14t1*t1 + V14T1t2*t2 
RightandWrong.3n        | V14t1*t1 + V14T2t2*t2 

 
# Intercepts
# Fix all intercepts to zero

Healthy_Rel_Before.3n + Communicate_Before.3n + ConflictManagement_Before.3n ~ 0*1
Healthy_Rel.3n + Communicate.3n + ConflictManagement.3n ~ 0*1
                 
RightPartner_Before.3n + LearnPartner_Before.3n + PaceRelationship_Before.3n +  WarningSigns_Before.3n ~ 0*1
RightPartner.3n + LearnPartner.3n + PaceRelationship.3n +  WarningSigns.3n ~ 0*1

LearnedGrowingUp_Before.3n + PastRelationships_Before.3n + GetAlongParents_Before.3n + FriendshipsAreLike_Before.3n ~ 0*1
LearnedGrowingUp.3n + PastRelationships.3n + GetAlongParents.3n + FriendshipsAreLike.3n ~ 0*1

Fights_Before.3n + FeelingsHurt_Before.3n + RightandWrong_Before.3n  ~ 0*1
Fights.3n + FeelingsHurt.3n + RightandWrong.3n  ~ 0*1


# Unique variances
# Fix unique variances at T1 to 1.00

Healthy_Rel_Before.3n  ~~ 1*Healthy_Rel_Before.3n
Communicate_Before.3n  ~~ 1*Communicate_Before.3n
ConflictManagement_Before.3n ~~ 1*ConflictManagement_Before.3n

RightPartner_Before.3n ~~ 1*RightPartner_Before.3n
LearnPartner_Before.3n ~~ 1*LearnPartner_Before.3n
PaceRelationship_Before.3n ~~ 1*PaceRelationship_Before.3n
WarningSigns_Before.3n ~~ 1*WarningSigns_Before.3n

LearnedGrowingUp_Before.3n ~~ 1*LearnedGrowingUp_Before.3n
PastRelationships_Before.3n ~~ 1*PastRelationships_Before.3n
GetAlongParents_Before.3n ~~ 1*GetAlongParents_Before.3n
FriendshipsAreLike_Before.3n ~~ 1*FriendshipsAreLike_Before.3n

Fights_Before.3n ~~ 1*Fights_Before.3n
FeelingsHurt_Before.3n ~~ 1*FeelingsHurt_Before.3n
RightandWrong_Before.3n  ~~ 1*RightandWrong_Before.3n

# lavaan constrains all indicator unique variances to 1.00 by default
# Free this constraint at T2

Healthy_Rel.3n  ~~ NA*Healthy_Rel.3n
Communicate.3n  ~~ NA*Communicate.3n
ConflictManagement.3n ~~ NA*ConflictManagement.3n

RightPartner.3n ~~ NA*RightPartner.3n
LearnPartner.3n ~~ NA*LearnPartner.3n
PaceRelationship.3n ~~ NA*PaceRelationship.3n
WarningSigns.3n ~~ NA*WarningSigns.3n

LearnedGrowingUp.3n ~~ NA*LearnedGrowingUp.3n
PastRelationships.3n ~~ NA*PastRelationships.3n
GetAlongParents.3n ~~ NA*GetAlongParents.3n
FriendshipsAreLike.3n ~~ NA*FriendshipsAreLike.3n

Fights.3n ~~ NA*Fights.3n
FeelingsHurt.3n ~~ NA*FeelingsHurt.3n
RightandWrong.3n  ~~ NA*RightandWrong.3n


# Lagged unique factor covariances

Healthy_Rel_Before.3n  ~~ Healthy_Rel.3n
Communicate_Before.3n  ~~ Communicate.3n
ConflictManagement_Before.3n ~~ ConflictManagement.3n

RightPartner_Before.3n ~~ RightPartner.3n
LearnPartner_Before.3n ~~LearnPartner.3n
PaceRelationship_Before.3n ~~ PaceRelationship.3n
WarningSigns_Before.3n ~~ WarningSigns.3n

LearnedGrowingUp_Before.3n ~~ LearnedGrowingUp.3n
PastRelationships_Before.3n ~~ PastRelationships.3n
GetAlongParents_Before.3n ~~ GetAlongParents.3n
FriendshipsAreLike_Before.3n ~~ FriendshipsAreLike.3n

Fights_Before.3n ~~ Fights.3n
FeelingsHurt_Before.3n ~~ FeelingsHurt.3n
RightandWrong_Before.3n  ~~ RightandWrong.3n




'

# fit the model
Rcomb.model.c <- lavaan::cfa(Rcomb.model.c, 
                              data=(Jail_clean %>% 
                                        dplyr::filter(in.analysis.sample3 == TRUE)),
                              estimator = "WLSMV",
                              ordered = c("Healthy_Rel_Before.3n" , "Communicate_Before.3n" ,
                                          "ConflictManagement_Before.3n",
                                          "RightPartner_Before.3n", "LearnPartner_Before.3n",
                                          "PaceRelationship_Before.3n",  "WarningSigns_Before.3n",
                                          "LearnedGrowingUp_Before.3n", "PastRelationships_Before.3n",
                                          "GetAlongParents_Before.3n", "FriendshipsAreLike_Before.3n",
                                          "Fights_Before.3n", "FeelingsHurt_Before.3n",
                                          "RightandWrong_Before.3n",
                                          
                                          "Healthy_Rel.3n" , "Communicate.3n" ,
                                          "ConflictManagement.3n",
                                          "RightPartner.3n", "LearnPartner.3n",
                                          "PaceRelationship.3n",  "WarningSigns.3n",
                                          "LearnedGrowingUp.3n", "PastRelationships.3n",
                                          "GetAlongParents.3n", "FriendshipsAreLike.3n",
                                          "Fights.3n", "FeelingsHurt.3n", 
                                          "RightandWrong.3n"),
                              parameterization = "theta")

# display summary output
lavaan::summary(Rcomb.model.c, fit.measures=TRUE, standardized=TRUE )
```
\newpage

## Measurement Invariance

### Configural  Invariant

```{r, echo=FALSE}
# specify the model
Rcomb.model.c.con <- ' 

# Latent common factor definitions

HRS.rpre =~ Healthy_Rel_Before.3n + Communicate_Before.3n + 
            ConflictManagement_Before.3n
HRS.post =~ Healthy_Rel.3n + Communicate.3n +   
            ConflictManagement.3n
                 
PS.rpre  =~ RightPartner_Before.3n + LearnPartner_Before.3n + 
            PaceRelationship_Before.3n +  WarningSigns_Before.3n
PS.post  =~ RightPartner.3n + LearnPartner.3n + 
            PaceRelationship.3n +  WarningSigns.3n

PRB.rpre =~ LearnedGrowingUp_Before.3n + PastRelationships_Before.3n + 
            GetAlongParents_Before.3n + FriendshipsAreLike_Before.3n
PRB.post =~ LearnedGrowingUp.3n + PastRelationships.3n + 
            GetAlongParents.3n + FriendshipsAreLike.3n

RBA.rpre =~ Fights_Before.3n + FeelingsHurt_Before.3n + RightandWrong_Before.3n 
RBA.post =~ Fights.3n + FeelingsHurt.3n + RightandWrong.3n 

# Latent common factor variances and covariances

HRS.rpre ~~ HRS.rpre + HRS.post + PS.rpre + PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
HRS.post ~~ HRS.post + PS.rpre + PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
PS.rpre  ~~ PS.rpre + PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
PS.post  ~~ PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
PRB.rpre ~~ PRB.rpre + PRB.post + RBA.rpre + RBA.post
PRB.post ~~ PRB.post + RBA.rpre + RBA.post
RBA.rpre ~~ RBA.rpre + RBA.post
RBA.post ~~ RBA.post

# Latent common factor means
# Fix T1 common factor mean to zero

HRS.rpre ~ 0*1
# Freely estimate T2-T4 common factor means
HRS.post ~ 1 
PS.rpre ~ 1 
PS.post ~ 1 
PRB.rpre ~ 1 
PRB.post ~ 1 
RBA.rpre ~ 1 
RBA.post ~ 1 

# Thresholds
# t1 and t2 after * represent the first and second 
#    thresholds of an indicator, respectively
# Threshold parameters that are freely estimated have labels VaTbtc,
#   with a representing indicator number, b representing time,
#   c representing ordering of the threshold (first, second)
# Threshold parameters that are constrained to be equal over time
#   are given the labels Vatc, with a representing indicator number, 
#   c representing ordering of the threshold (first, second)

Healthy_Rel_Before.3n | V1t1*t1 + V1t2*t2 
Healthy_Rel.3n        | V1t1*t1 + V1t2*t2 

Communicate_Before.3n | V2t1*t1 + V2T1t2*t2 
Communicate.3n        | V2t1*t1 + V2T2t2*t2 

ConflictManagement_Before.3n | V3t1*t1 + V3T1t2*t2 
ConflictManagement.3n        | V3t1*t1 + V3T2t2*t2 



RightPartner_Before.3n | V4t1*t1 + V4t2*t2 
RightPartner.3n        | V4t1*t1 + V4t2*t2 

LearnPartner_Before.3n | V5t1*t1 + V5T1t2*t2 
LearnPartner.3n        | V5t1*t1 + V5T2t2*t2 

PaceRelationship_Before.3n | V6t1*t1 + V6T1t2*t2 
PaceRelationship.3n        | V6t1*t1 + V6T2t2*t2 

WarningSigns_Before.3n | V7t1*t1 + V7T1t2*t2 
WarningSigns.3n        | V7t1*t1 + V7T2t2*t2 



LearnedGrowingUp_Before.3n | V8t1*t1 + V8t2*t2 
LearnedGrowingUp.3n        | V8t1*t1 + V8t2*t2 

PastRelationships_Before.3n | V9t1*t1 + V9T1t2*t2 
PastRelationships.3n        | V9t1*t1 + V9T2t2*t2 

GetAlongParents_Before.3n | V10t1*t1 + V10T1t2*t2 
GetAlongParents.3n        | V10t1*t1 + V10T2t2*t2 

FriendshipsAreLike_Before.3n | V11t1*t1 + V11T1t2*t2 
FriendshipsAreLike.3n        | V11t1*t1 + V11T2t2*t2 

 

Fights_Before.3n | V12t1*t1 + V12t2*t2 
Fights.3n        | V12t1*t1 + V12t2*t2 

FeelingsHurt_Before.3n | V13t1*t1 + V13T1t2*t2 
FeelingsHurt.3n        | V13t1*t1 + V13T2t2*t2 

RightandWrong_Before.3n | V14t1*t1 + V14T1t2*t2 
RightandWrong.3n        | V14t1*t1 + V14T2t2*t2 

 
# Intercepts
# Fix all intercepts to zero

Healthy_Rel_Before.3n + Communicate_Before.3n + ConflictManagement_Before.3n ~ 0*1
Healthy_Rel.3n + Communicate.3n + ConflictManagement.3n ~ 0*1
                 
RightPartner_Before.3n + LearnPartner_Before.3n + PaceRelationship_Before.3n +  WarningSigns_Before.3n ~ 0*1
RightPartner.3n + LearnPartner.3n + PaceRelationship.3n +  WarningSigns.3n ~ 0*1

LearnedGrowingUp_Before.3n + PastRelationships_Before.3n + GetAlongParents_Before.3n + FriendshipsAreLike_Before.3n ~ 0*1
LearnedGrowingUp.3n + PastRelationships.3n + GetAlongParents.3n + FriendshipsAreLike.3n ~ 0*1

Fights_Before.3n + FeelingsHurt_Before.3n + RightandWrong_Before.3n  ~ 0*1
Fights.3n + FeelingsHurt.3n + RightandWrong.3n  ~ 0*1


# Unique variances
# Fix unique variances at T1 to 1.00

Healthy_Rel_Before.3n  ~~ 1*Healthy_Rel_Before.3n
Communicate_Before.3n  ~~ 1*Communicate_Before.3n
ConflictManagement_Before.3n ~~ 1*ConflictManagement_Before.3n

RightPartner_Before.3n ~~ NA*RightPartner_Before.3n
LearnPartner_Before.3n ~~ NA*LearnPartner_Before.3n
PaceRelationship_Before.3n ~~ NA*PaceRelationship_Before.3n
WarningSigns_Before.3n ~~ NA*WarningSigns_Before.3n

LearnedGrowingUp_Before.3n ~~ NA*LearnedGrowingUp_Before.3n
PastRelationships_Before.3n ~~ NA*PastRelationships_Before.3n
GetAlongParents_Before.3n ~~ NA*GetAlongParents_Before.3n
FriendshipsAreLike_Before.3n ~~ NA*FriendshipsAreLike_Before.3n

Fights_Before.3n ~~ NA*Fights_Before.3n
FeelingsHurt_Before.3n ~~ NA*FeelingsHurt_Before.3n
RightandWrong_Before.3n  ~~ NA*RightandWrong_Before.3n

# lavaan constrains all indicator unique variances to 1.00 by default
# Free this constraint at T2

Healthy_Rel.3n  ~~ NA*Healthy_Rel.3n
Communicate.3n  ~~ NA*Communicate.3n
ConflictManagement.3n ~~ NA*ConflictManagement.3n

RightPartner.3n ~~ NA*RightPartner.3n
LearnPartner.3n ~~ NA*LearnPartner.3n
PaceRelationship.3n ~~ NA*PaceRelationship.3n
WarningSigns.3n ~~ NA*WarningSigns.3n

LearnedGrowingUp.3n ~~ NA*LearnedGrowingUp.3n
PastRelationships.3n ~~ NA*PastRelationships.3n
GetAlongParents.3n ~~ NA*GetAlongParents.3n
FriendshipsAreLike.3n ~~ NA*FriendshipsAreLike.3n

Fights.3n ~~ NA*Fights.3n
FeelingsHurt.3n ~~ NA*FeelingsHurt.3n
RightandWrong.3n  ~~ NA*RightandWrong.3n


# Lagged unique factor covariances

Healthy_Rel_Before.3n  ~~ Healthy_Rel.3n
Communicate_Before.3n  ~~ Communicate.3n
ConflictManagement_Before.3n ~~ ConflictManagement.3n

RightPartner_Before.3n ~~ RightPartner.3n
LearnPartner_Before.3n ~~LearnPartner.3n
PaceRelationship_Before.3n ~~ PaceRelationship.3n
WarningSigns_Before.3n ~~ WarningSigns.3n

LearnedGrowingUp_Before.3n ~~ LearnedGrowingUp.3n
PastRelationships_Before.3n ~~ PastRelationships.3n
GetAlongParents_Before.3n ~~ GetAlongParents.3n
FriendshipsAreLike_Before.3n ~~ FriendshipsAreLike.3n

Fights_Before.3n ~~ Fights.3n
FeelingsHurt_Before.3n ~~ FeelingsHurt.3n
RightandWrong_Before.3n  ~~ RightandWrong.3n




'

# fit the model
Fit.Rcomb.model.c.con <- lavaan::cfa(Rcomb.model.c.con, 
                              data=(Jail_clean %>% 
                                        dplyr::filter(in.analysis.sample3 == TRUE)),
                              estimator = "WLSMV",
                              ordered = c("Healthy_Rel_Before.3n" , "Communicate_Before.3n" ,
                                          "ConflictManagement_Before.3n",
                                          "RightPartner_Before.3n", "LearnPartner_Before.3n",
                                          "PaceRelationship_Before.3n",  "WarningSigns_Before.3n",
                                          "LearnedGrowingUp_Before.3n", "PastRelationships_Before.3n",
                                          "GetAlongParents_Before.3n", "FriendshipsAreLike_Before.3n",
                                          "Fights_Before.3n", "FeelingsHurt_Before.3n",
                                          "RightandWrong_Before.3n",
                                          
                                          "Healthy_Rel.3n" , "Communicate.3n" ,
                                          "ConflictManagement.3n",
                                          "RightPartner.3n", "LearnPartner.3n",
                                          "PaceRelationship.3n",  "WarningSigns.3n",
                                          "LearnedGrowingUp.3n", "PastRelationships.3n",
                                          "GetAlongParents.3n", "FriendshipsAreLike.3n",
                                          "Fights.3n", "FeelingsHurt.3n",
                                          "RightandWrong.3n"),
                               parameterization = "theta")

# display summary output
lavaan::summary(Fit.Rcomb.model.c.con, fit.measures=TRUE, standardized=TRUE )
```
\newpage

### Modification Indices

```{r, echo = FALSE}
lavaan::modificationindices(Fit.Rcomb.model.c.con) %>% 
    data.frame() %>% 
    dplyr::filter(mi>10) %>% 
    dplyr::arrange(-mi)
    
```

\newpage

### Loading  Invariant

```{r, echo=FALSE}
# specify the model
Rcomb.model.c.load <- ' 

# Latent common factor definitions

HRS.rpre =~ Healthy_Rel_Before.3n + V2L*Communicate_Before.3n + 
            V3L*ConflictManagement_Before.3n
HRS.post =~ Healthy_Rel.3n + V2L*Communicate.3n +   
            V3L*ConflictManagement.3n
                 
PS.rpre  =~ V4L*RightPartner_Before.3n + V5L*LearnPartner_Before.3n + 
            V6L*PaceRelationship_Before.3n +  V7L*WarningSigns_Before.3n
PS.post  =~ V4L*RightPartner.3n + V5L*LearnPartner.3n + 
            V6L*PaceRelationship.3n +  V7L*WarningSigns.3n

PRB.rpre =~ V8L*LearnedGrowingUp_Before.3n + V9L*PastRelationships_Before.3n + 
            V10L*GetAlongParents_Before.3n + V11L*FriendshipsAreLike_Before.3n
PRB.post =~ V8L*LearnedGrowingUp.3n + V9L*PastRelationships.3n + 
            V10L*GetAlongParents.3n + V11L*FriendshipsAreLike.3n

RBA.rpre =~ V12L*Fights_Before.3n + V13L*FeelingsHurt_Before.3n + V14L*RightandWrong_Before.3n 
RBA.post =~ V12L*Fights.3n + V13L*FeelingsHurt.3n + V14L*RightandWrong.3n 

# Latent common factor variances and covariances

HRS.rpre ~~ HRS.rpre + HRS.post + PS.rpre + PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
HRS.post ~~ HRS.post + PS.rpre + PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
PS.rpre  ~~ PS.rpre + PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
PS.post  ~~ PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
PRB.rpre ~~ PRB.rpre + PRB.post + RBA.rpre + RBA.post
PRB.post ~~ PRB.post + RBA.rpre + RBA.post
RBA.rpre ~~ RBA.rpre + RBA.post
RBA.post ~~ RBA.post

# Latent common factor means
# Fix T1 common factor mean to zero

HRS.rpre ~ 0*1
# Freely estimate T2-T4 common factor means
HRS.post ~ 1 
PS.rpre ~ 1 
PS.post ~ 1 
PRB.rpre ~ 1 
PRB.post ~ 1 
RBA.rpre ~ 1 
RBA.post ~ 1 

# Thresholds
# t1 and t2 after * represent the first and second 
#    thresholds of an indicator, respectively
# Threshold parameters that are freely estimated have labels VaTbtc,
#   with a representing indicator number, b representing time,
#   c representing ordering of the threshold (first, second)
# Threshold parameters that are constrained to be equal over time
#   are given the labels Vatc, with a representing indicator number, 
#   c representing ordering of the threshold (first, second)

Healthy_Rel_Before.3n | V1t1*t1 + V1t2*t2 
Healthy_Rel.3n        | V1t1*t1 + V1t2*t2 

Communicate_Before.3n | V2t1*t1 + V2T1t2*t2 
Communicate.3n        | V2t1*t1 + V2T2t2*t2 

ConflictManagement_Before.3n | V3t1*t1 + V3T1t2*t2 
ConflictManagement.3n        | V3t1*t1 + V3T2t2*t2 



RightPartner_Before.3n | V4t1*t1 + V4t2*t2 
RightPartner.3n        | V4t1*t1 + V4t2*t2 

LearnPartner_Before.3n | V5t1*t1 + V5T1t2*t2 
LearnPartner.3n        | V5t1*t1 + V5T2t2*t2 

PaceRelationship_Before.3n | V6t1*t1 + V6T1t2*t2 
PaceRelationship.3n        | V6t1*t1 + V6T2t2*t2 

WarningSigns_Before.3n | V7t1*t1 + V7T1t2*t2 
WarningSigns.3n        | V7t1*t1 + V7T2t2*t2 



LearnedGrowingUp_Before.3n | V8t1*t1 + V8t2*t2 
LearnedGrowingUp.3n        | V8t1*t1 + V8t2*t2 

PastRelationships_Before.3n | V9t1*t1 + V9T1t2*t2 
PastRelationships.3n        | V9t1*t1 + V9T2t2*t2 

GetAlongParents_Before.3n | V10t1*t1 + V10T1t2*t2 
GetAlongParents.3n        | V10t1*t1 + V10T2t2*t2 

FriendshipsAreLike_Before.3n | V11t1*t1 + V11T1t2*t2 
FriendshipsAreLike.3n        | V11t1*t1 + V11T2t2*t2 

 

Fights_Before.3n | V12t1*t1 + V12t2*t2 
Fights.3n        | V12t1*t1 + V12t2*t2 

FeelingsHurt_Before.3n | V13t1*t1 + V13T1t2*t2 
FeelingsHurt.3n        | V13t1*t1 + V13T2t2*t2 

RightandWrong_Before.3n | V14t1*t1 + V14T1t2*t2 
RightandWrong.3n        | V14t1*t1 + V14T2t2*t2 

 
# Intercepts
# Fix all intercepts to zero

Healthy_Rel_Before.3n + Communicate_Before.3n + ConflictManagement_Before.3n ~ 0*1
Healthy_Rel.3n + Communicate.3n + ConflictManagement.3n ~ 0*1
                 
RightPartner_Before.3n + LearnPartner_Before.3n + PaceRelationship_Before.3n +  WarningSigns_Before.3n ~ 0*1
RightPartner.3n + LearnPartner.3n + PaceRelationship.3n +  WarningSigns.3n ~ 0*1

LearnedGrowingUp_Before.3n + PastRelationships_Before.3n + GetAlongParents_Before.3n + FriendshipsAreLike_Before.3n ~ 0*1
LearnedGrowingUp.3n + PastRelationships.3n + GetAlongParents.3n + FriendshipsAreLike.3n ~ 0*1

Fights_Before.3n + FeelingsHurt_Before.3n + RightandWrong_Before.3n  ~ 0*1
Fights.3n + FeelingsHurt.3n + RightandWrong.3n  ~ 0*1


# Unique variances
# Fix unique variances at T1 to 1.00

Healthy_Rel_Before.3n  ~~ 1*Healthy_Rel_Before.3n
Communicate_Before.3n  ~~ 1*Communicate_Before.3n
ConflictManagement_Before.3n ~~ 1*ConflictManagement_Before.3n

RightPartner_Before.3n ~~ NA*RightPartner_Before.3n
LearnPartner_Before.3n ~~ NA*LearnPartner_Before.3n
PaceRelationship_Before.3n ~~ NA*PaceRelationship_Before.3n
WarningSigns_Before.3n ~~ NA*WarningSigns_Before.3n

LearnedGrowingUp_Before.3n ~~ NA*LearnedGrowingUp_Before.3n
PastRelationships_Before.3n ~~ NA*PastRelationships_Before.3n
GetAlongParents_Before.3n ~~ NA*GetAlongParents_Before.3n
FriendshipsAreLike_Before.3n ~~ NA*FriendshipsAreLike_Before.3n

Fights_Before.3n ~~ NA*Fights_Before.3n
FeelingsHurt_Before.3n ~~ NA*FeelingsHurt_Before.3n
RightandWrong_Before.3n  ~~ NA*RightandWrong_Before.3n

# lavaan constrains all indicator unique variances to 1.00 by default
# Free this constraint at T2

Healthy_Rel.3n  ~~ NA*Healthy_Rel.3n
Communicate.3n  ~~ NA*Communicate.3n
ConflictManagement.3n ~~ NA*ConflictManagement.3n

RightPartner.3n ~~ NA*RightPartner.3n
LearnPartner.3n ~~ NA*LearnPartner.3n
PaceRelationship.3n ~~ NA*PaceRelationship.3n
WarningSigns.3n ~~ NA*WarningSigns.3n

LearnedGrowingUp.3n ~~ NA*LearnedGrowingUp.3n
PastRelationships.3n ~~ NA*PastRelationships.3n
GetAlongParents.3n ~~ NA*GetAlongParents.3n
FriendshipsAreLike.3n ~~ NA*FriendshipsAreLike.3n

Fights.3n ~~ NA*Fights.3n
FeelingsHurt.3n ~~ NA*FeelingsHurt.3n
RightandWrong.3n  ~~ NA*RightandWrong.3n


# Lagged unique factor covariances

Healthy_Rel_Before.3n  ~~ Healthy_Rel.3n
Communicate_Before.3n  ~~ Communicate.3n
ConflictManagement_Before.3n ~~ ConflictManagement.3n

RightPartner_Before.3n ~~ RightPartner.3n
LearnPartner_Before.3n ~~LearnPartner.3n
PaceRelationship_Before.3n ~~ PaceRelationship.3n
WarningSigns_Before.3n ~~ WarningSigns.3n

LearnedGrowingUp_Before.3n ~~ LearnedGrowingUp.3n
PastRelationships_Before.3n ~~ PastRelationships.3n
GetAlongParents_Before.3n ~~ GetAlongParents.3n
FriendshipsAreLike_Before.3n ~~ FriendshipsAreLike.3n

Fights_Before.3n ~~ Fights.3n
FeelingsHurt_Before.3n ~~ FeelingsHurt.3n
RightandWrong_Before.3n  ~~ RightandWrong.3n




'

# fit the model
Fit.Rcomb.model.c.load <- lavaan::cfa(Rcomb.model.c.load, 
                              data=(Jail_clean %>% 
                                        dplyr::filter(in.analysis.sample3 == TRUE)),
                              estimator = "WLSMV",
                              ordered = c("Healthy_Rel_Before.3n" , "Communicate_Before.3n" ,
                                          "ConflictManagement_Before.3n",
                                          "RightPartner_Before.3n", "LearnPartner_Before.3n",
                                          "PaceRelationship_Before.3n",  "WarningSigns_Before.3n",
                                          "LearnedGrowingUp_Before.3n", "PastRelationships_Before.3n",
                                          "GetAlongParents_Before.3n", "FriendshipsAreLike_Before.3n",
                                          "Fights_Before.3n", "FeelingsHurt_Before.3n",
                                          "RightandWrong_Before.3n",
                                          
                                          "Healthy_Rel.3n" , "Communicate.3n" ,
                                          "ConflictManagement.3n",
                                          "RightPartner.3n", "LearnPartner.3n",
                                          "PaceRelationship.3n",  "WarningSigns.3n",
                                          "LearnedGrowingUp.3n", "PastRelationships.3n",
                                          "GetAlongParents.3n", "FriendshipsAreLike.3n",
                                          "Fights.3n", "FeelingsHurt.3n",
                                          "RightandWrong.3n"),
                               parameterization = "theta")

# display summary output
lavaan::summary(Fit.Rcomb.model.c.load, fit.measures=TRUE, standardized=TRUE )
```

\newpage

### Modification Indices

```{r, echo = FALSE}
lavaan::modificationindices(Fit.Rcomb.model.c.load) %>% 
    data.frame() %>% 
    dplyr::filter(mi>10) %>% 
    dplyr::arrange(-mi)
    
```


### Model Comparison
```{r}
lavaan::anova(Fit.Rcomb.model.c.con, Fit.Rcomb.model.c.load)
```


\newpage

### Threshold  Invariant

```{r, echo=FALSE}
# specify the model
Rcomb.model.c.thresh <- ' 

# Latent common factor definitions

HRS.rpre =~ Healthy_Rel_Before.3n + V2L*Communicate_Before.3n + 
            V3L*ConflictManagement_Before.3n
HRS.post =~ Healthy_Rel.3n + V2L*Communicate.3n +   
            V3L*ConflictManagement.3n
                 
PS.rpre  =~ V4L*RightPartner_Before.3n + V5L*LearnPartner_Before.3n + 
            V6L*PaceRelationship_Before.3n +  V7L*WarningSigns_Before.3n
PS.post  =~ V4L*RightPartner.3n + V5L*LearnPartner.3n + 
            V6L*PaceRelationship.3n +  V7L*WarningSigns.3n

PRB.rpre =~ V8L*LearnedGrowingUp_Before.3n + V9L*PastRelationships_Before.3n + 
            V10L*GetAlongParents_Before.3n + V11L*FriendshipsAreLike_Before.3n
PRB.post =~ V8L*LearnedGrowingUp.3n + V9L*PastRelationships.3n + 
            V10L*GetAlongParents.3n + V11L*FriendshipsAreLike.3n

RBA.rpre =~ V12L*Fights_Before.3n + V13L*FeelingsHurt_Before.3n + V14L*RightandWrong_Before.3n 
RBA.post =~ V12L*Fights.3n + V13L*FeelingsHurt.3n + V14L*RightandWrong.3n 

# Latent common factor variances and covariances

HRS.rpre ~~ HRS.rpre + HRS.post + PS.rpre + PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
HRS.post ~~ HRS.post + PS.rpre + PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
PS.rpre  ~~ PS.rpre + PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
PS.post  ~~ PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
PRB.rpre ~~ PRB.rpre + PRB.post + RBA.rpre + RBA.post
PRB.post ~~ PRB.post + RBA.rpre + RBA.post
RBA.rpre ~~ RBA.rpre + RBA.post
RBA.post ~~ RBA.post

# Latent common factor means
# Fix T1 common factor mean to zero

HRS.rpre ~ 0*1
# Freely estimate T2-T4 common factor means
HRS.post ~ 1 
PS.rpre ~ 1 
PS.post ~ 1 
PRB.rpre ~ 1 
PRB.post ~ 1 
RBA.rpre ~ 1 
RBA.post ~ 1 

# Thresholds
# t1 and t2 after * represent the first and second 
#    thresholds of an indicator, respectively
# Threshold parameters that are freely estimated have labels VaTbtc,
#   with a representing indicator number, b representing time,
#   c representing ordering of the threshold (first, second)
# Threshold parameters that are constrained to be equal over time
#   are given the labels Vatc, with a representing indicator number, 
#   c representing ordering of the threshold (first, second)

Healthy_Rel_Before.3n | V1t1*t1 + V1t2*t2 
Healthy_Rel.3n        | V1t1*t1 + V1t2*t2 

Communicate_Before.3n | V2t1*t1 + V2t2*t2 
Communicate.3n        | V2t1*t1 + V2t2*t2 

ConflictManagement_Before.3n | V3t1*t1 + V3t2*t2 
ConflictManagement.3n        | V3t1*t1 + V3t2*t2 



RightPartner_Before.3n | V4t1*t1 + V4t2*t2 
RightPartner.3n        | V4t1*t1 + V4t2*t2 

LearnPartner_Before.3n | V5t1*t1 + V5t2*t2 
LearnPartner.3n        | V5t1*t1 + V5t2*t2 

PaceRelationship_Before.3n | V6t1*t1 + V6t2*t2 
PaceRelationship.3n        | V6t1*t1 + V6t2*t2 

WarningSigns_Before.3n | V7t1*t1 + V7t2*t2 
WarningSigns.3n        | V7t1*t1 + V7t2*t2 



LearnedGrowingUp_Before.3n | V8t1*t1 + V8t2*t2 
LearnedGrowingUp.3n        | V8t1*t1 + V8t2*t2 

PastRelationships_Before.3n | V9t1*t1 + V9t2*t2 
PastRelationships.3n        | V9t1*t1 + V9t2*t2 

GetAlongParents_Before.3n | V10t1*t1 + V10t2*t2 
GetAlongParents.3n        | V10t1*t1 + V10t2*t2 

FriendshipsAreLike_Before.3n | V11t1*t1 + V11t2*t2 
FriendshipsAreLike.3n        | V11t1*t1 + V11t2*t2 

 

Fights_Before.3n | V12t1*t1 + V12t2*t2 
Fights.3n        | V12t1*t1 + V12t2*t2 

FeelingsHurt_Before.3n | V13t1*t1 + V13t2*t2 
FeelingsHurt.3n        | V13t1*t1 + V13t2*t2 

RightandWrong_Before.3n | V14t1*t1 + V14t2*t2 
RightandWrong.3n        | V14t1*t1 + V14t2*t2 

 
# Intercepts
# Fix all intercepts to zero

Healthy_Rel_Before.3n + Communicate_Before.3n + ConflictManagement_Before.3n ~ 0*1
Healthy_Rel.3n + Communicate.3n + ConflictManagement.3n ~ 0*1
                 
RightPartner_Before.3n + LearnPartner_Before.3n + PaceRelationship_Before.3n +  WarningSigns_Before.3n ~ 0*1
RightPartner.3n + LearnPartner.3n + PaceRelationship.3n +  WarningSigns.3n ~ 0*1

LearnedGrowingUp_Before.3n + PastRelationships_Before.3n + GetAlongParents_Before.3n + FriendshipsAreLike_Before.3n ~ 0*1
LearnedGrowingUp.3n + PastRelationships.3n + GetAlongParents.3n + FriendshipsAreLike.3n ~ 0*1

Fights_Before.3n + FeelingsHurt_Before.3n + RightandWrong_Before.3n  ~ 0*1
Fights.3n + FeelingsHurt.3n + RightandWrong.3n  ~ 0*1


# Unique variances
# Fix unique variances at T1 to 1.00

Healthy_Rel_Before.3n  ~~ 1*Healthy_Rel_Before.3n
Communicate_Before.3n  ~~ 1*Communicate_Before.3n
ConflictManagement_Before.3n ~~ 1*ConflictManagement_Before.3n

RightPartner_Before.3n ~~ NA*RightPartner_Before.3n
LearnPartner_Before.3n ~~ NA*LearnPartner_Before.3n
PaceRelationship_Before.3n ~~ NA*PaceRelationship_Before.3n
WarningSigns_Before.3n ~~ NA*WarningSigns_Before.3n

LearnedGrowingUp_Before.3n ~~ NA*LearnedGrowingUp_Before.3n
PastRelationships_Before.3n ~~ NA*PastRelationships_Before.3n
GetAlongParents_Before.3n ~~ NA*GetAlongParents_Before.3n
FriendshipsAreLike_Before.3n ~~ NA*FriendshipsAreLike_Before.3n

Fights_Before.3n ~~ NA*Fights_Before.3n
FeelingsHurt_Before.3n ~~ NA*FeelingsHurt_Before.3n
RightandWrong_Before.3n  ~~ NA*RightandWrong_Before.3n

# lavaan constrains all indicator unique variances to 1.00 by default
# Free this constraint at T2

Healthy_Rel.3n  ~~ NA*Healthy_Rel.3n
Communicate.3n  ~~ NA*Communicate.3n
ConflictManagement.3n ~~ NA*ConflictManagement.3n

RightPartner.3n ~~ NA*RightPartner.3n
LearnPartner.3n ~~ NA*LearnPartner.3n
PaceRelationship.3n ~~ NA*PaceRelationship.3n
WarningSigns.3n ~~ NA*WarningSigns.3n

LearnedGrowingUp.3n ~~ NA*LearnedGrowingUp.3n
PastRelationships.3n ~~ NA*PastRelationships.3n
GetAlongParents.3n ~~ NA*GetAlongParents.3n
FriendshipsAreLike.3n ~~ NA*FriendshipsAreLike.3n

Fights.3n ~~ NA*Fights.3n
FeelingsHurt.3n ~~ NA*FeelingsHurt.3n
RightandWrong.3n  ~~ NA*RightandWrong.3n


# Lagged unique factor covariances

Healthy_Rel_Before.3n  ~~ Healthy_Rel.3n
Communicate_Before.3n  ~~ Communicate.3n
ConflictManagement_Before.3n ~~ ConflictManagement.3n

RightPartner_Before.3n ~~ RightPartner.3n
LearnPartner_Before.3n ~~LearnPartner.3n
PaceRelationship_Before.3n ~~ PaceRelationship.3n
WarningSigns_Before.3n ~~ WarningSigns.3n

LearnedGrowingUp_Before.3n ~~ LearnedGrowingUp.3n
PastRelationships_Before.3n ~~ PastRelationships.3n
GetAlongParents_Before.3n ~~ GetAlongParents.3n
FriendshipsAreLike_Before.3n ~~ FriendshipsAreLike.3n

Fights_Before.3n ~~ Fights.3n
FeelingsHurt_Before.3n ~~ FeelingsHurt.3n
RightandWrong_Before.3n  ~~ RightandWrong.3n




'

# fit the model
Fit.Rcomb.model.c.thresh <- lavaan::cfa(Rcomb.model.c.thresh, 
                              data=(Jail_clean %>% 
                                        dplyr::filter(in.analysis.sample3 == TRUE)),
                              estimator = "WLSMV",
                              ordered = c("Healthy_Rel_Before.3n" , "Communicate_Before.3n" ,
                                          "ConflictManagement_Before.3n",
                                          "RightPartner_Before.3n", "LearnPartner_Before.3n",
                                          "PaceRelationship_Before.3n",  "WarningSigns_Before.3n",
                                          "LearnedGrowingUp_Before.3n", "PastRelationships_Before.3n",
                                          "GetAlongParents_Before.3n", "FriendshipsAreLike_Before.3n",
                                          "Fights_Before.3n", "FeelingsHurt_Before.3n",
                                          "RightandWrong_Before.3n",
                                          
                                          "Healthy_Rel.3n" , "Communicate.3n" ,
                                          "ConflictManagement.3n",
                                          "RightPartner.3n", "LearnPartner.3n",
                                          "PaceRelationship.3n",  "WarningSigns.3n",
                                          "LearnedGrowingUp.3n", "PastRelationships.3n",
                                          "GetAlongParents.3n", "FriendshipsAreLike.3n",
                                          "Fights.3n", "FeelingsHurt.3n",
                                          "RightandWrong.3n"),
                               parameterization = "theta")

# display summary output
lavaan::summary(Fit.Rcomb.model.c.thresh, fit.measures=TRUE, standardized=TRUE )
```

\newpage

### Modification Indices

```{r, echo = FALSE}
lavaan::modificationindices(Fit.Rcomb.model.c.thresh) %>% 
    data.frame() %>% 
    dplyr::filter(mi>10) %>% 
    dplyr::arrange(-mi)
    
```

### Model Comparison
```{r}
lavaan::anova(Fit.Rcomb.model.c.load, Fit.Rcomb.model.c.thresh)
```

\newpage

### Unique Factor Invariant

```{r, echo=FALSE}
# specify the model
Rcomb.model.c.uniq <- ' 

# Latent common factor definitions

HRS.rpre =~ NA*Healthy_Rel_Before.3n + V1L*Healthy_Rel_Before.3n + 1*Communicate_Before.3n + 
            V3L*ConflictManagement_Before.3n
HRS.post =~ NA*Healthy_Rel.3n + V1L*Healthy_Rel.3n + 1*Communicate.3n +   
            V3L*ConflictManagement.3n
                 
PS.rpre  =~ V4L*RightPartner_Before.3n + V5L*LearnPartner_Before.3n + 
            V6L*PaceRelationship_Before.3n +  V7L*WarningSigns_Before.3n
PS.post  =~ V4L*RightPartner.3n + V5L*LearnPartner.3n + 
            V6L*PaceRelationship.3n +  V7L*WarningSigns.3n

PRB.rpre =~ V8L*LearnedGrowingUp_Before.3n + V9L*PastRelationships_Before.3n + 
            V10L*GetAlongParents_Before.3n + V11L*FriendshipsAreLike_Before.3n
PRB.post =~ V8L*LearnedGrowingUp.3n + V9L*PastRelationships.3n + 
            V10L*GetAlongParents.3n + V11L*FriendshipsAreLike.3n

RBA.rpre =~ V12L*Fights_Before.3n + V13L*FeelingsHurt_Before.3n + V14L*RightandWrong_Before.3n 
RBA.post =~ V12L*Fights.3n + V13L*FeelingsHurt.3n + V14L*RightandWrong.3n 

# Latent common factor variances and covariances

HRS.rpre ~~ HRS.rpre + HRS.post + PS.rpre + PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
HRS.post ~~ HRS.post + PS.rpre + PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
PS.rpre  ~~ PS.rpre + PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
PS.post  ~~ PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
PRB.rpre ~~ PRB.rpre + PRB.post + RBA.rpre + RBA.post
PRB.post ~~ PRB.post + RBA.rpre + RBA.post
RBA.rpre ~~ RBA.rpre + RBA.post
RBA.post ~~ RBA.post

# Latent common factor means
# Fix T1 common factor mean to zero

HRS.rpre ~ 0*1
# Freely estimate T2-T4 common factor means
HRS.post ~ 1 
PS.rpre ~ 1 
PS.post ~ 1 
PRB.rpre ~ 1 
PRB.post ~ 1 
RBA.rpre ~ 1 
RBA.post ~ 1 

# Thresholds
# t1 and t2 after * represent the first and second 
#    thresholds of an indicator, respectively
# Threshold parameters that are freely estimated have labels VaTbtc,
#   with a representing indicator number, b representing time,
#   c representing ordering of the threshold (first, second)
# Threshold parameters that are constrained to be equal over time
#   are given the labels Vatc, with a representing indicator number, 
#   c representing ordering of the threshold (first, second)

Healthy_Rel_Before.3n | V1t1*t1 + V1t2*t2 
Healthy_Rel.3n        | V1t1*t1 + V1t2*t2 

Communicate_Before.3n | V2t1*t1 + V2t2*t2 
Communicate.3n        | V2t1*t1 + V2t2*t2 

ConflictManagement_Before.3n | V3t1*t1 + V3t2*t2 
ConflictManagement.3n        | V3t1*t1 + V3t2*t2 



RightPartner_Before.3n | V4t1*t1 + V4t2*t2 
RightPartner.3n        | V4t1*t1 + V4t2*t2 

LearnPartner_Before.3n | V5t1*t1 + V5t2*t2 
LearnPartner.3n        | V5t1*t1 + V5t2*t2 

PaceRelationship_Before.3n | V6t1*t1 + V6t2*t2 
PaceRelationship.3n        | V6t1*t1 + V6t2*t2 

WarningSigns_Before.3n | V7t1*t1 + V7t2*t2 
WarningSigns.3n        | V7t1*t1 + V7t2*t2 



LearnedGrowingUp_Before.3n | V8t1*t1 + V8t2*t2 
LearnedGrowingUp.3n        | V8t1*t1 + V8t2*t2 

PastRelationships_Before.3n | V9t1*t1 + V9t2*t2 
PastRelationships.3n        | V9t1*t1 + V9t2*t2 

GetAlongParents_Before.3n | V10t1*t1 + V10t2*t2 
GetAlongParents.3n        | V10t1*t1 + V10t2*t2 

FriendshipsAreLike_Before.3n | V11t1*t1 + V11t2*t2 
FriendshipsAreLike.3n        | V11t1*t1 + V11t2*t2 

 

Fights_Before.3n | V12t1*t1 + V12t2*t2 
Fights.3n        | V12t1*t1 + V12t2*t2 

FeelingsHurt_Before.3n | V13t1*t1 + V13t2*t2 
FeelingsHurt.3n        | V13t1*t1 + V13t2*t2 

RightandWrong_Before.3n | V14t1*t1 + V14t2*t2 
RightandWrong.3n        | V14t1*t1 + V14t2*t2 

 
# Intercepts
# Fix all intercepts to zero

Healthy_Rel_Before.3n + Communicate_Before.3n + ConflictManagement_Before.3n ~ 0*1
Healthy_Rel.3n + Communicate.3n + ConflictManagement.3n ~ 0*1
                 
RightPartner_Before.3n + LearnPartner_Before.3n + PaceRelationship_Before.3n +  WarningSigns_Before.3n ~ 0*1
RightPartner.3n + LearnPartner.3n + PaceRelationship.3n +  WarningSigns.3n ~ 0*1

LearnedGrowingUp_Before.3n + PastRelationships_Before.3n + GetAlongParents_Before.3n + FriendshipsAreLike_Before.3n ~ 0*1
LearnedGrowingUp.3n + PastRelationships.3n + GetAlongParents.3n + FriendshipsAreLike.3n ~ 0*1

Fights_Before.3n + FeelingsHurt_Before.3n + RightandWrong_Before.3n  ~ 0*1
Fights.3n + FeelingsHurt.3n + RightandWrong.3n  ~ 0*1


# Unique variances
# Fix unique variances at T1 to 1.00

Healthy_Rel_Before.3n  ~~ 1*Healthy_Rel_Before.3n
Communicate_Before.3n  ~~ 1*Communicate_Before.3n
ConflictManagement_Before.3n ~~ 1*ConflictManagement_Before.3n

RightPartner_Before.3n ~~ 1*RightPartner_Before.3n
LearnPartner_Before.3n ~~ 1*LearnPartner_Before.3n
PaceRelationship_Before.3n ~~ 1*PaceRelationship_Before.3n
WarningSigns_Before.3n ~~ 1*WarningSigns_Before.3n

LearnedGrowingUp_Before.3n ~~ 1*LearnedGrowingUp_Before.3n
PastRelationships_Before.3n ~~ 1*PastRelationships_Before.3n
GetAlongParents_Before.3n ~~ 1*GetAlongParents_Before.3n
FriendshipsAreLike_Before.3n ~~ 1*FriendshipsAreLike_Before.3n

Fights_Before.3n ~~ 1*Fights_Before.3n
FeelingsHurt_Before.3n ~~ 1*FeelingsHurt_Before.3n
RightandWrong_Before.3n  ~~ 1*RightandWrong_Before.3n

# lavaan constrains all indicator unique variances to 1.00 by default
# Free this constraint at T2

Healthy_Rel.3n  ~~ 1*Healthy_Rel.3n
Communicate.3n  ~~ 1*Communicate.3n
ConflictManagement.3n ~~ 1*ConflictManagement.3n

RightPartner.3n ~~ 1*RightPartner.3n
LearnPartner.3n ~~ 1*LearnPartner.3n
PaceRelationship.3n ~~ 1*PaceRelationship.3n
WarningSigns.3n ~~ NA*WarningSigns.3n

LearnedGrowingUp.3n ~~ 1*LearnedGrowingUp.3n
PastRelationships.3n ~~ 1*PastRelationships.3n
GetAlongParents.3n ~~ 1*GetAlongParents.3n
FriendshipsAreLike.3n ~~ 1*FriendshipsAreLike.3n

Fights.3n ~~ 1*Fights.3n
FeelingsHurt.3n ~~ 1*FeelingsHurt.3n
RightandWrong.3n  ~~ 1*RightandWrong.3n


# Lagged unique factor covariances

Healthy_Rel_Before.3n  ~~ Healthy_Rel.3n
Communicate_Before.3n  ~~ Communicate.3n
ConflictManagement_Before.3n ~~ ConflictManagement.3n

RightPartner_Before.3n ~~ RightPartner.3n
LearnPartner_Before.3n ~~LearnPartner.3n
PaceRelationship_Before.3n ~~ PaceRelationship.3n
WarningSigns_Before.3n ~~ WarningSigns.3n

LearnedGrowingUp_Before.3n ~~ LearnedGrowingUp.3n
PastRelationships_Before.3n ~~ PastRelationships.3n
GetAlongParents_Before.3n ~~ GetAlongParents.3n
FriendshipsAreLike_Before.3n ~~ FriendshipsAreLike.3n

Fights_Before.3n ~~ Fights.3n
FeelingsHurt_Before.3n ~~ FeelingsHurt.3n
RightandWrong_Before.3n  ~~ RightandWrong.3n




'

# fit the model
Fit.Rcomb.model.c.uniq <- lavaan::cfa(Rcomb.model.c.uniq, 
                              data=(Jail_clean %>% 
                                        dplyr::filter(in.analysis.sample3 == TRUE)),
                              estimator = "WLSMV",
                              ordered = c("Healthy_Rel_Before.3n" , "Communicate_Before.3n" ,
                                          "ConflictManagement_Before.3n",
                                          "RightPartner_Before.3n", "LearnPartner_Before.3n",
                                          "PaceRelationship_Before.3n",  "WarningSigns_Before.3n",
                                          "LearnedGrowingUp_Before.3n", "PastRelationships_Before.3n",
                                          "GetAlongParents_Before.3n", "FriendshipsAreLike_Before.3n",
                                          "Fights_Before.3n", "FeelingsHurt_Before.3n",
                                          "RightandWrong_Before.3n",
                                          
                                          "Healthy_Rel.3n" , "Communicate.3n" ,
                                          "ConflictManagement.3n",
                                          "RightPartner.3n", "LearnPartner.3n",
                                          "PaceRelationship.3n",  "WarningSigns.3n",
                                          "LearnedGrowingUp.3n", "PastRelationships.3n",
                                          "GetAlongParents.3n", "FriendshipsAreLike.3n",
                                          "Fights.3n", "FeelingsHurt.3n",
                                          "RightandWrong.3n"),
                               parameterization = "theta")

# display summary output
lavaan::summary(Fit.Rcomb.model.c.uniq, fit.measures=TRUE, standardized=TRUE )
```

\newpage

### Model Comparison
```{r}
lavaan::anova(Fit.Rcomb.model.c.thresh, Fit.Rcomb.model.c.uniq)
```


### Modification Indices

```{r, echo = FALSE}
lavaan::modificationindices(Fit.Rcomb.model.c.uniq) %>% 
    data.frame() %>% 
    dplyr::filter(mi>10) %>% 
    dplyr::arrange(-mi)
    
```

\newpage

### Unique Factor Invariant 2 

```{r, echo=FALSE}
# specify the model
Rcomb.model.c.uniq.2 <- ' 

# Latent common factor definitions

HRS.rpre =~ Healthy_Rel_Before.3n + V2L*Communicate_Before.3n + 
            V3L*ConflictManagement_Before.3n
HRS.post =~ Healthy_Rel.3n + V2L*Communicate.3n +   
            V3L*ConflictManagement.3n
                 
PS.rpre  =~ V4L*RightPartner_Before.3n + V5L*LearnPartner_Before.3n + 
            V6L*PaceRelationship_Before.3n +  V7L*WarningSigns_Before.3n
PS.post  =~ V4L*RightPartner.3n + V5L*LearnPartner.3n + 
            V6L*PaceRelationship.3n +  V7L*WarningSigns.3n

PRB.rpre =~ V8L*LearnedGrowingUp_Before.3n + V9L*PastRelationships_Before.3n + 
            V10L*GetAlongParents_Before.3n + V11L*FriendshipsAreLike_Before.3n
PRB.post =~ V8L*LearnedGrowingUp.3n + V9L*PastRelationships.3n + 
            V10L*GetAlongParents.3n + V11L*FriendshipsAreLike.3n

RBA.rpre =~ V12L*Fights_Before.3n + V13L*FeelingsHurt_Before.3n + V14L*RightandWrong_Before.3n 
RBA.post =~ V12L*Fights.3n + V13L*FeelingsHurt.3n + V14L*RightandWrong.3n 

# Latent common factor variances and covariances

HRS.rpre ~~ HRS.rpre + HRS.post + PS.rpre + PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
HRS.post ~~ HRS.post + PS.rpre + PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
PS.rpre  ~~ PS.rpre + PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
PS.post  ~~ PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
PRB.rpre ~~ PRB.rpre + PRB.post + RBA.rpre + RBA.post
PRB.post ~~ PRB.post + RBA.rpre + RBA.post
RBA.rpre ~~ RBA.rpre + RBA.post
RBA.post ~~ RBA.post

# Latent common factor means
# Fix T1 common factor mean to zero

HRS.rpre ~ 0*1
# Freely estimate T2-T4 common factor means
HRS.post ~ 1 
PS.rpre ~ 1 
PS.post ~ 1 
PRB.rpre ~ 1 
PRB.post ~ 1 
RBA.rpre ~ 1 
RBA.post ~ 1 

# Thresholds
# t1 and t2 after * represent the first and second 
#    thresholds of an indicator, respectively
# Threshold parameters that are freely estimated have labels VaTbtc,
#   with a representing indicator number, b representing time,
#   c representing ordering of the threshold (first, second)
# Threshold parameters that are constrained to be equal over time
#   are given the labels Vatc, with a representing indicator number, 
#   c representing ordering of the threshold (first, second)

Healthy_Rel_Before.3n | V1t1*t1 + V1t2*t2 
Healthy_Rel.3n        | V1t1*t1 + V1t2*t2 

Communicate_Before.3n | V2t1*t1 + V2t2*t2 
Communicate.3n        | V2t1*t1 + V2t2*t2 

ConflictManagement_Before.3n | V3t1*t1 + V3t2*t2 
ConflictManagement.3n        | V3t1*t1 + V3t2*t2 



RightPartner_Before.3n | V4t1*t1 + V4t2*t2 
RightPartner.3n        | V4t1*t1 + V4t2*t2 

LearnPartner_Before.3n | V5t1*t1 + V5t2*t2 
LearnPartner.3n        | V5t1*t1 + V5t2*t2 

PaceRelationship_Before.3n | V6t1*t1 + V6t2*t2 
PaceRelationship.3n        | V6t1*t1 + V6t2*t2 

WarningSigns_Before.3n | V7t1*t1 + V7t2*t2 
WarningSigns.3n        | V7t1*t1 + V7t2*t2 



LearnedGrowingUp_Before.3n | V8t1*t1 + V8t2*t2 
LearnedGrowingUp.3n        | V8t1*t1 + V8t2*t2 

PastRelationships_Before.3n | V9t1*t1 + V9t2*t2 
PastRelationships.3n        | V9t1*t1 + V9t2*t2 

GetAlongParents_Before.3n | V10t1*t1 + V10t2*t2 
GetAlongParents.3n        | V10t1*t1 + V10t2*t2 

FriendshipsAreLike_Before.3n | V11t1*t1 + V11t2*t2 
FriendshipsAreLike.3n        | V11t1*t1 + V11t2*t2 

 

Fights_Before.3n | V12t1*t1 + V12t2*t2 
Fights.3n        | V12t1*t1 + V12t2*t2 

FeelingsHurt_Before.3n | V13t1*t1 + V13t2*t2 
FeelingsHurt.3n        | V13t1*t1 + V13t2*t2 

RightandWrong_Before.3n | V14t1*t1 + V14t2*t2 
RightandWrong.3n        | V14t1*t1 + V14t2*t2 

 
# Intercepts
# Fix all intercepts to zero

Healthy_Rel_Before.3n + Communicate_Before.3n + ConflictManagement_Before.3n ~ 0*1
Healthy_Rel.3n + Communicate.3n + ConflictManagement.3n ~ 0*1
                 
RightPartner_Before.3n + LearnPartner_Before.3n + PaceRelationship_Before.3n +  WarningSigns_Before.3n ~ 0*1
RightPartner.3n + LearnPartner.3n + PaceRelationship.3n +  WarningSigns.3n ~ 0*1

LearnedGrowingUp_Before.3n + PastRelationships_Before.3n + GetAlongParents_Before.3n + FriendshipsAreLike_Before.3n ~ 0*1
LearnedGrowingUp.3n + PastRelationships.3n + GetAlongParents.3n + FriendshipsAreLike.3n ~ 0*1

Fights_Before.3n + FeelingsHurt_Before.3n + RightandWrong_Before.3n  ~ 0*1
Fights.3n + FeelingsHurt.3n + RightandWrong.3n  ~ 0*1


# Unique variances
# Fix unique variances at T1 to 1.00

Healthy_Rel_Before.3n  ~~ 1*Healthy_Rel_Before.3n
Communicate_Before.3n  ~~ 1*Communicate_Before.3n
ConflictManagement_Before.3n ~~ 1*ConflictManagement_Before.3n

RightPartner_Before.3n ~~ 1*RightPartner_Before.3n
LearnPartner_Before.3n ~~ 1*LearnPartner_Before.3n
PaceRelationship_Before.3n ~~ 1*PaceRelationship_Before.3n
WarningSigns_Before.3n ~~ 1*WarningSigns_Before.3n

LearnedGrowingUp_Before.3n ~~ 1*LearnedGrowingUp_Before.3n
PastRelationships_Before.3n ~~ 1*PastRelationships_Before.3n
GetAlongParents_Before.3n ~~ 1*GetAlongParents_Before.3n
FriendshipsAreLike_Before.3n ~~ 1*FriendshipsAreLike_Before.3n

Fights_Before.3n ~~ 1*Fights_Before.3n
FeelingsHurt_Before.3n ~~ 1*FeelingsHurt_Before.3n
RightandWrong_Before.3n  ~~ 1*RightandWrong_Before.3n

# lavaan constrains all indicator unique variances to 1.00 by default
# Free this constraint at T2

Healthy_Rel.3n  ~~ NA*Healthy_Rel.3n
Communicate.3n  ~~ 1*Communicate.3n
ConflictManagement.3n ~~ 1*ConflictManagement.3n

RightPartner.3n ~~ 1*RightPartner.3n
LearnPartner.3n ~~ 1*LearnPartner.3n
PaceRelationship.3n ~~ 1*PaceRelationship.3n
WarningSigns.3n ~~ 1*WarningSigns.3n

LearnedGrowingUp.3n ~~ 1*LearnedGrowingUp.3n
PastRelationships.3n ~~ 1*PastRelationships.3n
GetAlongParents.3n ~~ 1*GetAlongParents.3n
FriendshipsAreLike.3n ~~ 1*FriendshipsAreLike.3n

Fights.3n ~~ 1*Fights.3n
FeelingsHurt.3n ~~ 1*FeelingsHurt.3n
RightandWrong.3n  ~~ 1*RightandWrong.3n


# Lagged unique factor covariances

Healthy_Rel_Before.3n  ~~ Healthy_Rel.3n
Communicate_Before.3n  ~~ Communicate.3n
ConflictManagement_Before.3n ~~ ConflictManagement.3n

RightPartner_Before.3n ~~ RightPartner.3n
LearnPartner_Before.3n ~~LearnPartner.3n
PaceRelationship_Before.3n ~~ PaceRelationship.3n
WarningSigns_Before.3n ~~ WarningSigns.3n

LearnedGrowingUp_Before.3n ~~ LearnedGrowingUp.3n
PastRelationships_Before.3n ~~ PastRelationships.3n
GetAlongParents_Before.3n ~~ GetAlongParents.3n
FriendshipsAreLike_Before.3n ~~ FriendshipsAreLike.3n

Fights_Before.3n ~~ Fights.3n
FeelingsHurt_Before.3n ~~ FeelingsHurt.3n
RightandWrong_Before.3n  ~~ RightandWrong.3n




'

# fit the model
Fit.Rcomb.model.c.uniq.2 <- lavaan::cfa(Rcomb.model.c.uniq.2, 
                              data=(Jail_clean %>% 
                                        dplyr::filter(in.analysis.sample3 == TRUE)),
                              estimator = "WLSMV",
                              ordered = c("Healthy_Rel_Before.3n" , "Communicate_Before.3n" ,
                                          "ConflictManagement_Before.3n",
                                          "RightPartner_Before.3n", "LearnPartner_Before.3n",
                                          "PaceRelationship_Before.3n",  "WarningSigns_Before.3n",
                                          "LearnedGrowingUp_Before.3n", "PastRelationships_Before.3n",
                                          "GetAlongParents_Before.3n", "FriendshipsAreLike_Before.3n",
                                          "Fights_Before.3n", "FeelingsHurt_Before.3n",
                                          "RightandWrong_Before.3n",
                                          
                                          "Healthy_Rel.3n" , "Communicate.3n" ,
                                          "ConflictManagement.3n",
                                          "RightPartner.3n", "LearnPartner.3n",
                                          "PaceRelationship.3n",  "WarningSigns.3n",
                                          "LearnedGrowingUp.3n", "PastRelationships.3n",
                                          "GetAlongParents.3n", "FriendshipsAreLike.3n",
                                          "Fights.3n", "FeelingsHurt.3n",
                                          "RightandWrong.3n"),
                               parameterization = "theta")

# display summary output
lavaan::summary(Fit.Rcomb.model.c.uniq.2, fit.measures=TRUE, standardized=TRUE )
```

\newpage

### Model Comparison
```{r}
lavaan::anova(Fit.Rcomb.model.c.thresh, Fit.Rcomb.model.c.uniq.2)
```




### Modification Indices

```{r, echo = FALSE}
lavaan::modificationindices(Fit.Rcomb.model.c.uniq.2) %>% 
    data.frame() %>% 
    dplyr::filter(mi>10) %>% 
    dplyr::arrange(-mi)
    
```


\newpage

### Unique Factor Invariant 3

```{r, echo=FALSE}
# specify the model
Rcomb.model.c.uniq.3 <- ' 

# Latent common factor definitions

HRS.rpre =~ Healthy_Rel_Before.3n + V2L*Communicate_Before.3n + 
            V3L*ConflictManagement_Before.3n
HRS.post =~ Healthy_Rel.3n + V2L*Communicate.3n +   
            V3L*ConflictManagement.3n
                 
PS.rpre  =~ V4L*RightPartner_Before.3n + V5L*LearnPartner_Before.3n + 
            V6L*PaceRelationship_Before.3n +  V7L*WarningSigns_Before.3n
PS.post  =~ V4L*RightPartner.3n + V5L*LearnPartner.3n + 
            V6L*PaceRelationship.3n +  V7L*WarningSigns.3n

PRB.rpre =~ V8L*LearnedGrowingUp_Before.3n + V9L*PastRelationships_Before.3n + 
            V10L*GetAlongParents_Before.3n + V11L*FriendshipsAreLike_Before.3n
PRB.post =~ V8L*LearnedGrowingUp.3n + V9L*PastRelationships.3n + 
            V10L*GetAlongParents.3n + V11L*FriendshipsAreLike.3n

RBA.rpre =~ V12L*Fights_Before.3n + V13L*FeelingsHurt_Before.3n + V14L*RightandWrong_Before.3n 
RBA.post =~ V12L*Fights.3n + V13L*FeelingsHurt.3n + V14L*RightandWrong.3n 

# Latent common factor variances and covariances

HRS.rpre ~~ HRS.rpre + HRS.post + PS.rpre + PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
HRS.post ~~ HRS.post + PS.rpre + PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
PS.rpre  ~~ PS.rpre + PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
PS.post  ~~ PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
PRB.rpre ~~ PRB.rpre + PRB.post + RBA.rpre + RBA.post
PRB.post ~~ PRB.post + RBA.rpre + RBA.post
RBA.rpre ~~ RBA.rpre + RBA.post
RBA.post ~~ RBA.post

# Latent common factor means
# Fix T1 common factor mean to zero

HRS.rpre ~ 0*1
# Freely estimate T2-T4 common factor means
HRS.post ~ 1 
PS.rpre ~ 1 
PS.post ~ 1 
PRB.rpre ~ 1 
PRB.post ~ 1 
RBA.rpre ~ 1 
RBA.post ~ 1 

# Thresholds
# t1 and t2 after * represent the first and second 
#    thresholds of an indicator, respectively
# Threshold parameters that are freely estimated have labels VaTbtc,
#   with a representing indicator number, b representing time,
#   c representing ordering of the threshold (first, second)
# Threshold parameters that are constrained to be equal over time
#   are given the labels Vatc, with a representing indicator number, 
#   c representing ordering of the threshold (first, second)

Healthy_Rel_Before.3n | V1t1*t1 + V1t2*t2 
Healthy_Rel.3n        | V1t1*t1 + V1t2*t2 

Communicate_Before.3n | V2t1*t1 + V2t2*t2 
Communicate.3n        | V2t1*t1 + V2t2*t2 

ConflictManagement_Before.3n | V3t1*t1 + V3t2*t2 
ConflictManagement.3n        | V3t1*t1 + V3t2*t2 



RightPartner_Before.3n | V4t1*t1 + V4t2*t2 
RightPartner.3n        | V4t1*t1 + V4t2*t2 

LearnPartner_Before.3n | V5t1*t1 + V5t2*t2 
LearnPartner.3n        | V5t1*t1 + V5t2*t2 

PaceRelationship_Before.3n | V6t1*t1 + V6t2*t2 
PaceRelationship.3n        | V6t1*t1 + V6t2*t2 

WarningSigns_Before.3n | V7t1*t1 + V7t2*t2 
WarningSigns.3n        | V7t1*t1 + V7t2*t2 



LearnedGrowingUp_Before.3n | V8t1*t1 + V8t2*t2 
LearnedGrowingUp.3n        | V8t1*t1 + V8t2*t2 

PastRelationships_Before.3n | V9t1*t1 + V9t2*t2 
PastRelationships.3n        | V9t1*t1 + V9t2*t2 

GetAlongParents_Before.3n | V10t1*t1 + V10t2*t2 
GetAlongParents.3n        | V10t1*t1 + V10t2*t2 

FriendshipsAreLike_Before.3n | V11t1*t1 + V11t2*t2 
FriendshipsAreLike.3n        | V11t1*t1 + V11t2*t2 

 

Fights_Before.3n | V12t1*t1 + V12t2*t2 
Fights.3n        | V12t1*t1 + V12t2*t2 

FeelingsHurt_Before.3n | V13t1*t1 + V13t2*t2 
FeelingsHurt.3n        | V13t1*t1 + V13t2*t2 

RightandWrong_Before.3n | V14t1*t1 + V14t2*t2 
RightandWrong.3n        | V14t1*t1 + V14t2*t2 

 
# Intercepts
# Fix all intercepts to zero

Healthy_Rel_Before.3n + Communicate_Before.3n + ConflictManagement_Before.3n ~ 0*1
Healthy_Rel.3n + Communicate.3n + ConflictManagement.3n ~ 0*1
                 
RightPartner_Before.3n + LearnPartner_Before.3n + PaceRelationship_Before.3n +  WarningSigns_Before.3n ~ 0*1
RightPartner.3n + LearnPartner.3n + PaceRelationship.3n +  WarningSigns.3n ~ 0*1

LearnedGrowingUp_Before.3n + PastRelationships_Before.3n + GetAlongParents_Before.3n + FriendshipsAreLike_Before.3n ~ 0*1
LearnedGrowingUp.3n + PastRelationships.3n + GetAlongParents.3n + FriendshipsAreLike.3n ~ 0*1

Fights_Before.3n + FeelingsHurt_Before.3n + RightandWrong_Before.3n  ~ 0*1
Fights.3n + FeelingsHurt.3n + RightandWrong.3n  ~ 0*1


# Unique variances
# Fix unique variances at T1 to 1.00

Healthy_Rel_Before.3n  ~~ 1*Healthy_Rel_Before.3n
Communicate_Before.3n  ~~ 1*Communicate_Before.3n
ConflictManagement_Before.3n ~~ 1*ConflictManagement_Before.3n

RightPartner_Before.3n ~~ 1*RightPartner_Before.3n
LearnPartner_Before.3n ~~ 1*LearnPartner_Before.3n
PaceRelationship_Before.3n ~~ 1*PaceRelationship_Before.3n
WarningSigns_Before.3n ~~ 1*WarningSigns_Before.3n

LearnedGrowingUp_Before.3n ~~ 1*LearnedGrowingUp_Before.3n
PastRelationships_Before.3n ~~ 1*PastRelationships_Before.3n
GetAlongParents_Before.3n ~~ 1*GetAlongParents_Before.3n
FriendshipsAreLike_Before.3n ~~ 1*FriendshipsAreLike_Before.3n

Fights_Before.3n ~~ 1*Fights_Before.3n
FeelingsHurt_Before.3n ~~ 1*FeelingsHurt_Before.3n
RightandWrong_Before.3n  ~~ 1*RightandWrong_Before.3n

# lavaan constrains all indicator unique variances to 1.00 by default
# Free this constraint at T2

Healthy_Rel.3n  ~~ NA*Healthy_Rel.3n
Communicate.3n  ~~ 1*Communicate.3n
ConflictManagement.3n ~~ 1*ConflictManagement.3n

RightPartner.3n ~~ 1*RightPartner.3n
LearnPartner.3n ~~ 1*LearnPartner.3n
PaceRelationship.3n ~~ 1*PaceRelationship.3n
WarningSigns.3n ~~ 1*WarningSigns.3n

LearnedGrowingUp.3n ~~ 1*LearnedGrowingUp.3n
PastRelationships.3n ~~ NA*PastRelationships.3n
GetAlongParents.3n ~~ 1*GetAlongParents.3n
FriendshipsAreLike.3n ~~ 1*FriendshipsAreLike.3n

Fights.3n ~~ 1*Fights.3n
FeelingsHurt.3n ~~ 1*FeelingsHurt.3n
RightandWrong.3n  ~~ 1*RightandWrong.3n


# Lagged unique factor covariances

Healthy_Rel_Before.3n  ~~ Healthy_Rel.3n
Communicate_Before.3n  ~~ Communicate.3n
ConflictManagement_Before.3n ~~ ConflictManagement.3n

RightPartner_Before.3n ~~ RightPartner.3n
LearnPartner_Before.3n ~~LearnPartner.3n
PaceRelationship_Before.3n ~~ PaceRelationship.3n
WarningSigns_Before.3n ~~ WarningSigns.3n

LearnedGrowingUp_Before.3n ~~ LearnedGrowingUp.3n
PastRelationships_Before.3n ~~ PastRelationships.3n
GetAlongParents_Before.3n ~~ GetAlongParents.3n
FriendshipsAreLike_Before.3n ~~ FriendshipsAreLike.3n

Fights_Before.3n ~~ Fights.3n
FeelingsHurt_Before.3n ~~ FeelingsHurt.3n
RightandWrong_Before.3n  ~~ RightandWrong.3n




'

# fit the model
Fit.Rcomb.model.c.uniq.3 <- lavaan::cfa(Rcomb.model.c.uniq.3, 
                              data=(Jail_clean %>% 
                                        dplyr::filter(in.analysis.sample3 == TRUE)),
                              estimator = "WLSMV",
                              ordered = c("Healthy_Rel_Before.3n" , "Communicate_Before.3n" ,
                                          "ConflictManagement_Before.3n",
                                          "RightPartner_Before.3n", "LearnPartner_Before.3n",
                                          "PaceRelationship_Before.3n",  "WarningSigns_Before.3n",
                                          "LearnedGrowingUp_Before.3n", "PastRelationships_Before.3n",
                                          "GetAlongParents_Before.3n", "FriendshipsAreLike_Before.3n",
                                          "Fights_Before.3n", "FeelingsHurt_Before.3n",
                                          "RightandWrong_Before.3n",
                                          
                                          "Healthy_Rel.3n" , "Communicate.3n" ,
                                          "ConflictManagement.3n",
                                          "RightPartner.3n", "LearnPartner.3n",
                                          "PaceRelationship.3n",  "WarningSigns.3n",
                                          "LearnedGrowingUp.3n", "PastRelationships.3n",
                                          "GetAlongParents.3n", "FriendshipsAreLike.3n",
                                          "Fights.3n", "FeelingsHurt.3n",
                                          "RightandWrong.3n"),
                               parameterization = "theta")

# display summary output
lavaan::summary(Fit.Rcomb.model.c.uniq.3, fit.measures=TRUE, standardized=TRUE )
```

\newpage

### Model Comparison
```{r}
lavaan::anova(Fit.Rcomb.model.c.thresh, Fit.Rcomb.model.c.uniq.3)
```




### Modification Indices

```{r, echo = FALSE}
lavaan::modificationindices(Fit.Rcomb.model.c.uniq.3) %>% 
    data.frame() %>% 
    dplyr::filter(mi>10) %>% 
    dplyr::arrange(-mi)
    
```


\newpage

### Unique Factor Invariant 4

```{r, echo=FALSE}
# specify the model
Rcomb.model.c.uniq.4 <- ' 

# Latent common factor definitions

HRS.rpre =~ Healthy_Rel_Before.3n + V2L*Communicate_Before.3n + 
            V3L*ConflictManagement_Before.3n
HRS.post =~ Healthy_Rel.3n + V2L*Communicate.3n +   
            V3L*ConflictManagement.3n
                 
PS.rpre  =~ V4L*RightPartner_Before.3n + V5L*LearnPartner_Before.3n + 
            V6L*PaceRelationship_Before.3n +  V7L*WarningSigns_Before.3n
PS.post  =~ V4L*RightPartner.3n + V5L*LearnPartner.3n + 
            V6L*PaceRelationship.3n +  V7L*WarningSigns.3n

PRB.rpre =~ V8L*LearnedGrowingUp_Before.3n + V9L*PastRelationships_Before.3n + 
            V10L*GetAlongParents_Before.3n + V11L*FriendshipsAreLike_Before.3n
PRB.post =~ V8L*LearnedGrowingUp.3n + V9L*PastRelationships.3n + 
            V10L*GetAlongParents.3n + V11L*FriendshipsAreLike.3n

RBA.rpre =~ V12L*Fights_Before.3n + V13L*FeelingsHurt_Before.3n + V14L*RightandWrong_Before.3n 
RBA.post =~ V12L*Fights.3n + V13L*FeelingsHurt.3n + V14L*RightandWrong.3n 

# Latent common factor variances and covariances

HRS.rpre ~~ HRS.rpre + HRS.post + PS.rpre + PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
HRS.post ~~ HRS.post + PS.rpre + PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
PS.rpre  ~~ PS.rpre + PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
PS.post  ~~ PS.post + PRB.rpre + PRB.post + RBA.rpre + RBA.post
PRB.rpre ~~ PRB.rpre + PRB.post + RBA.rpre + RBA.post
PRB.post ~~ PRB.post + RBA.rpre + RBA.post
RBA.rpre ~~ RBA.rpre + RBA.post
RBA.post ~~ RBA.post

# Latent common factor means
# Fix T1 common factor mean to zero

HRS.rpre ~ 0*1
# Freely estimate T2-T4 common factor means
HRS.post ~ 1 
PS.rpre ~ 1 
PS.post ~ 1 
PRB.rpre ~ 1 
PRB.post ~ 1 
RBA.rpre ~ 1 
RBA.post ~ 1 

# Thresholds
# t1 and t2 after * represent the first and second 
#    thresholds of an indicator, respectively
# Threshold parameters that are freely estimated have labels VaTbtc,
#   with a representing indicator number, b representing time,
#   c representing ordering of the threshold (first, second)
# Threshold parameters that are constrained to be equal over time
#   are given the labels Vatc, with a representing indicator number, 
#   c representing ordering of the threshold (first, second)

Healthy_Rel_Before.3n | V1t1*t1 + V1t2*t2 
Healthy_Rel.3n        | V1t1*t1 + V1t2*t2 

Communicate_Before.3n | V2t1*t1 + V2t2*t2 
Communicate.3n        | V2t1*t1 + V2t2*t2 

ConflictManagement_Before.3n | V3t1*t1 + V3t2*t2 
ConflictManagement.3n        | V3t1*t1 + V3t2*t2 



RightPartner_Before.3n | V4t1*t1 + V4t2*t2 
RightPartner.3n        | V4t1*t1 + V4t2*t2 

LearnPartner_Before.3n | V5t1*t1 + V5t2*t2 
LearnPartner.3n        | V5t1*t1 + V5t2*t2 

PaceRelationship_Before.3n | V6t1*t1 + V6t2*t2 
PaceRelationship.3n        | V6t1*t1 + V6t2*t2 

WarningSigns_Before.3n | V7t1*t1 + V7t2*t2 
WarningSigns.3n        | V7t1*t1 + V7t2*t2 



LearnedGrowingUp_Before.3n | V8t1*t1 + V8t2*t2 
LearnedGrowingUp.3n        | V8t1*t1 + V8t2*t2 

PastRelationships_Before.3n | V9t1*t1 + V9t2*t2 
PastRelationships.3n        | V9t1*t1 + V9t2*t2 

GetAlongParents_Before.3n | V10t1*t1 + V10t2*t2 
GetAlongParents.3n        | V10t1*t1 + V10t2*t2 

FriendshipsAreLike_Before.3n | V11t1*t1 + V11t2*t2 
FriendshipsAreLike.3n        | V11t1*t1 + V11t2*t2 

 

Fights_Before.3n | V12t1*t1 + V12t2*t2 
Fights.3n        | V12t1*t1 + V12t2*t2 

FeelingsHurt_Before.3n | V13t1*t1 + V13t2*t2 
FeelingsHurt.3n        | V13t1*t1 + V13t2*t2 

RightandWrong_Before.3n | V14t1*t1 + V14t2*t2 
RightandWrong.3n        | V14t1*t1 + V14t2*t2 

 
# Intercepts
# Fix all intercepts to zero

Healthy_Rel_Before.3n + Communicate_Before.3n + ConflictManagement_Before.3n ~ 0*1
Healthy_Rel.3n + Communicate.3n + ConflictManagement.3n ~ 0*1
                 
RightPartner_Before.3n + LearnPartner_Before.3n + PaceRelationship_Before.3n +  WarningSigns_Before.3n ~ 0*1
RightPartner.3n + LearnPartner.3n + PaceRelationship.3n +  WarningSigns.3n ~ 0*1

LearnedGrowingUp_Before.3n + PastRelationships_Before.3n + GetAlongParents_Before.3n + FriendshipsAreLike_Before.3n ~ 0*1
LearnedGrowingUp.3n + PastRelationships.3n + GetAlongParents.3n + FriendshipsAreLike.3n ~ 0*1

Fights_Before.3n + FeelingsHurt_Before.3n + RightandWrong_Before.3n  ~ 0*1
Fights.3n + FeelingsHurt.3n + RightandWrong.3n  ~ 0*1


# Unique variances
# Fix unique variances at T1 to 1.00

Healthy_Rel_Before.3n  ~~ 1*Healthy_Rel_Before.3n
Communicate_Before.3n  ~~ 1*Communicate_Before.3n
ConflictManagement_Before.3n ~~ 1*ConflictManagement_Before.3n

RightPartner_Before.3n ~~ 1*RightPartner_Before.3n
LearnPartner_Before.3n ~~ 1*LearnPartner_Before.3n
PaceRelationship_Before.3n ~~ 1*PaceRelationship_Before.3n
WarningSigns_Before.3n ~~ 1*WarningSigns_Before.3n

LearnedGrowingUp_Before.3n ~~ 1*LearnedGrowingUp_Before.3n
PastRelationships_Before.3n ~~ 1*PastRelationships_Before.3n
GetAlongParents_Before.3n ~~ 1*GetAlongParents_Before.3n
FriendshipsAreLike_Before.3n ~~ 1*FriendshipsAreLike_Before.3n

Fights_Before.3n ~~ 1*Fights_Before.3n
FeelingsHurt_Before.3n ~~ 1*FeelingsHurt_Before.3n
RightandWrong_Before.3n  ~~ 1*RightandWrong_Before.3n

# lavaan constrains all indicator unique variances to 1.00 by default
# Free this constraint at T2

Healthy_Rel.3n  ~~ NA*Healthy_Rel.3n
Communicate.3n  ~~ NA*Communicate.3n
ConflictManagement.3n ~~ 1*ConflictManagement.3n

RightPartner.3n ~~ 1*RightPartner.3n
LearnPartner.3n ~~ 1*LearnPartner.3n
PaceRelationship.3n ~~ 1*PaceRelationship.3n
WarningSigns.3n ~~ 1*WarningSigns.3n

LearnedGrowingUp.3n ~~ 1*LearnedGrowingUp.3n
PastRelationships.3n ~~ NA*PastRelationships.3n
GetAlongParents.3n ~~ 1*GetAlongParents.3n
FriendshipsAreLike.3n ~~ 1*FriendshipsAreLike.3n

Fights.3n ~~ 1*Fights.3n
FeelingsHurt.3n ~~ 1*FeelingsHurt.3n
RightandWrong.3n  ~~ 1*RightandWrong.3n


# Lagged unique factor covariances

Healthy_Rel_Before.3n  ~~ Healthy_Rel.3n
Communicate_Before.3n  ~~ Communicate.3n
ConflictManagement_Before.3n ~~ ConflictManagement.3n

RightPartner_Before.3n ~~ RightPartner.3n
LearnPartner_Before.3n ~~LearnPartner.3n
PaceRelationship_Before.3n ~~ PaceRelationship.3n
WarningSigns_Before.3n ~~ WarningSigns.3n

LearnedGrowingUp_Before.3n ~~ LearnedGrowingUp.3n
PastRelationships_Before.3n ~~ PastRelationships.3n
GetAlongParents_Before.3n ~~ GetAlongParents.3n
FriendshipsAreLike_Before.3n ~~ FriendshipsAreLike.3n

Fights_Before.3n ~~ Fights.3n
FeelingsHurt_Before.3n ~~ FeelingsHurt.3n
RightandWrong_Before.3n  ~~ RightandWrong.3n




'

# fit the model
Fit.Rcomb.model.c.uniq.4 <- lavaan::cfa(Rcomb.model.c.uniq.4, 
                              data=(Jail_clean %>% 
                                        dplyr::filter(in.analysis.sample3 == TRUE)),
                              estimator = "WLSMV",
                              ordered = c("Healthy_Rel_Before.3n" , "Communicate_Before.3n" ,
                                          "ConflictManagement_Before.3n",
                                          "RightPartner_Before.3n", "LearnPartner_Before.3n",
                                          "PaceRelationship_Before.3n",  "WarningSigns_Before.3n",
                                          "LearnedGrowingUp_Before.3n", "PastRelationships_Before.3n",
                                          "GetAlongParents_Before.3n", "FriendshipsAreLike_Before.3n",
                                          "Fights_Before.3n", "FeelingsHurt_Before.3n",
                                          "RightandWrong_Before.3n",
                                          
                                          "Healthy_Rel.3n" , "Communicate.3n" ,
                                          "ConflictManagement.3n",
                                          "RightPartner.3n", "LearnPartner.3n",
                                          "PaceRelationship.3n",  "WarningSigns.3n",
                                          "LearnedGrowingUp.3n", "PastRelationships.3n",
                                          "GetAlongParents.3n", "FriendshipsAreLike.3n",
                                          "Fights.3n", "FeelingsHurt.3n",
                                          "RightandWrong.3n"),
                               parameterization = "theta")

# display summary output
lavaan::summary(Fit.Rcomb.model.c.uniq.4, fit.measures=TRUE, standardized=TRUE )
```

\newpage

### Model Comparison
```{r}
lavaan::anova(Fit.Rcomb.model.c.thresh, Fit.Rcomb.model.c.uniq.4)
```




### Modification Indices

```{r, echo = FALSE}
lavaan::modificationindices(Fit.Rcomb.model.c.uniq.4) %>% 
    data.frame() %>% 
    dplyr::filter(mi>10) %>% 
    dplyr::arrange(-mi)
    
```


\newpage

## 2-factor Measurement Invariance

### Configural  Invariant

```{r, echo=FALSE}
# specify the model
Rcomb.model.c2.con <- ' 

# Latent common factor definitions

HSP.rpre =~ Healthy_Rel_Before.3n + Communicate_Before.3n + 
            ConflictManagement_Before.3n +
            RightPartner_Before.3n + LearnPartner_Before.3n + 
            PaceRelationship_Before.3n +  WarningSigns_Before.3n
HSP.post =~ Healthy_Rel.3n + Communicate.3n +   
            ConflictManagement.3n +
            RightPartner.3n + LearnPartner.3n + 
            PaceRelationship.3n +  WarningSigns.3n

PBA.rpre =~ LearnedGrowingUp_Before.3n + PastRelationships_Before.3n + 
            GetAlongParents_Before.3n + FriendshipsAreLike_Before.3n +
            Fights_Before.3n + FeelingsHurt_Before.3n + RightandWrong_Before.3n 
PBA.post =~ LearnedGrowingUp.3n + PastRelationships.3n + 
            GetAlongParents.3n + FriendshipsAreLike.3n +
            Fights.3n + FeelingsHurt.3n + RightandWrong.3n 

# Communicate_Before.3n ~~ ConflictManagement_Before.3n
# Communicate.3n ~~ ConflictManagement.3n
# 
# PastRelationships_Before.3n ~~ GetAlongParents_Before.3n + FriendshipsAreLike_Before.3n
# GetAlongParents_Before.3n ~~ FriendshipsAreLike_Before.3n
# PastRelationships.3n ~~ GetAlongParents.3n + FriendshipsAreLike.3n
# GetAlongParents.3n ~~ FriendshipsAreLike.3n

# Latent common factor variances and covariances

HSP.rpre ~~ HSP.rpre + HSP.post + PBA.rpre + PBA.post
HSP.post ~~ HSP.post + PBA.rpre + PBA.post
PBA.rpre ~~ PBA.rpre + PBA.post
PBA.post ~~ PBA.post

# Latent common factor means
# Fix factor means to zero

HSP.rpre ~ 0*1
# Freely estimate T2-T4 common factor means
HSP.post ~ 1 
PBA.rpre ~ 1 
PBA.post ~ 1 


# Thresholds
# t1 and t2 after * represent the first and second 
#    thresholds of an indicator, respectively
# Threshold parameters that are freely estimated have labels VaTbtc,
#   with a representing indicator number, b representing time,
#   c representing ordering of the threshold (first, second)
# Threshold parameters that are constrained to be equal over time
#   are given the labels Vatc, with a representing indicator number, 
#   c representing ordering of the threshold (first, second)

Healthy_Rel_Before.3n | V1t1*t1 + V1t2*t2 
Healthy_Rel.3n        | V1t1*t1 + V1t2*t2 

Communicate_Before.3n | V2t1*t1 + V2T1t2*t2 
Communicate.3n        | V2t1*t1 + V2T2t2*t2 

ConflictManagement_Before.3n | V3t1*t1 + V3T1t2*t2 
ConflictManagement.3n        | V3t1*t1 + V3T2t2*t2 


RightPartner_Before.3n | V4t1*t1 + V4T1t2*t2 
RightPartner.3n        | V4t1*t1 + V4T2t2*t2 

LearnPartner_Before.3n | V5t1*t1 + V5T1t2*t2 
LearnPartner.3n        | V5t1*t1 + V5T2t2*t2 

PaceRelationship_Before.3n | V6t1*t1 + V6T1t2*t2 
PaceRelationship.3n        | V6t1*t1 + V6T2t2*t2 

WarningSigns_Before.3n | V7t1*t1 + V7T1t2*t2 
WarningSigns.3n        | V7t1*t1 + V7T2t2*t2 



LearnedGrowingUp_Before.3n | V8t1*t1 + V8T1t2*t2 
LearnedGrowingUp.3n        | V8t1*t1 + V8T2t2*t2 

PastRelationships_Before.3n | V9t1*t1 + V9T1t2*t2 
PastRelationships.3n        | V9t1*t1 + V9T2t2*t2 

GetAlongParents_Before.3n | V10t1*t1 + V10T1t2*t2 
GetAlongParents.3n        | V10t1*t1 + V10T2t2*t2 

FriendshipsAreLike_Before.3n | V11t1*t1 + V11T1t2*t2 
FriendshipsAreLike.3n        | V11t1*t1 + V11T2t2*t2 

 

Fights_Before.3n | V12t1*t1 + V12T1t2*t2 
Fights.3n        | V12t1*t1 + V12T2t2*t2 

FeelingsHurt_Before.3n | V13t1*t1 + V13T1t2*t2 
FeelingsHurt.3n        | V13t1*t1 + V13T2t2*t2 

RightandWrong_Before.3n | V14t1*t1 + V14T1t2*t2 
RightandWrong.3n        | V14t1*t1 + V14T2t2*t2 

 
# Intercepts
# Fix all intercepts to zero

Healthy_Rel_Before.3n + Communicate_Before.3n + ConflictManagement_Before.3n ~ 0*1
Healthy_Rel.3n + Communicate.3n + ConflictManagement.3n ~ 0*1
                 
RightPartner_Before.3n + LearnPartner_Before.3n + PaceRelationship_Before.3n +  WarningSigns_Before.3n ~ 0*1
RightPartner.3n + LearnPartner.3n + PaceRelationship.3n +  WarningSigns.3n ~ 0*1

LearnedGrowingUp_Before.3n + PastRelationships_Before.3n + GetAlongParents_Before.3n + FriendshipsAreLike_Before.3n ~ 0*1
LearnedGrowingUp.3n + PastRelationships.3n + GetAlongParents.3n + FriendshipsAreLike.3n ~ 0*1

Fights_Before.3n + FeelingsHurt_Before.3n + RightandWrong_Before.3n  ~ 0*1
Fights.3n + FeelingsHurt.3n + RightandWrong.3n  ~ 0*1


# Unique variances
# Fix unique variances at T1 to 1.00

Healthy_Rel_Before.3n  ~~ 1*Healthy_Rel_Before.3n
Communicate_Before.3n  ~~ 1*Communicate_Before.3n
ConflictManagement_Before.3n ~~ 1*ConflictManagement_Before.3n

RightPartner_Before.3n ~~ 1*RightPartner_Before.3n
LearnPartner_Before.3n ~~ 1*LearnPartner_Before.3n
PaceRelationship_Before.3n ~~ 1*PaceRelationship_Before.3n
WarningSigns_Before.3n ~~ 1*WarningSigns_Before.3n

LearnedGrowingUp_Before.3n ~~ NA*LearnedGrowingUp_Before.3n
PastRelationships_Before.3n ~~ NA*PastRelationships_Before.3n
GetAlongParents_Before.3n ~~ NA*GetAlongParents_Before.3n
FriendshipsAreLike_Before.3n ~~ NA*FriendshipsAreLike_Before.3n

Fights_Before.3n ~~ NA*Fights_Before.3n
FeelingsHurt_Before.3n ~~ NA*FeelingsHurt_Before.3n
RightandWrong_Before.3n  ~~ NA*RightandWrong_Before.3n

# lavaan constrains all indicator unique variances to 1.00 by default
# Free this constraint at T2

Healthy_Rel.3n  ~~ NA*Healthy_Rel.3n
Communicate.3n  ~~ NA*Communicate.3n
ConflictManagement.3n ~~ NA*ConflictManagement.3n

RightPartner.3n ~~ NA*RightPartner.3n
LearnPartner.3n ~~ NA*LearnPartner.3n
PaceRelationship.3n ~~ NA*PaceRelationship.3n
WarningSigns.3n ~~ NA*WarningSigns.3n

LearnedGrowingUp.3n ~~ NA*LearnedGrowingUp.3n
PastRelationships.3n ~~ NA*PastRelationships.3n
GetAlongParents.3n ~~ NA*GetAlongParents.3n
FriendshipsAreLike.3n ~~ NA*FriendshipsAreLike.3n

Fights.3n ~~ NA*Fights.3n
FeelingsHurt.3n ~~ NA*FeelingsHurt.3n
RightandWrong.3n  ~~ NA*RightandWrong.3n


# Lagged unique factor covariances

Healthy_Rel_Before.3n  ~~ Healthy_Rel.3n
Communicate_Before.3n  ~~ Communicate.3n
ConflictManagement_Before.3n ~~ ConflictManagement.3n

RightPartner_Before.3n ~~ RightPartner.3n
LearnPartner_Before.3n ~~LearnPartner.3n
PaceRelationship_Before.3n ~~ PaceRelationship.3n
WarningSigns_Before.3n ~~ WarningSigns.3n

LearnedGrowingUp_Before.3n ~~ LearnedGrowingUp.3n
PastRelationships_Before.3n ~~ PastRelationships.3n
GetAlongParents_Before.3n ~~ GetAlongParents.3n
FriendshipsAreLike_Before.3n ~~ FriendshipsAreLike.3n

Fights_Before.3n ~~ Fights.3n
FeelingsHurt_Before.3n ~~ FeelingsHurt.3n
RightandWrong_Before.3n  ~~ RightandWrong.3n

ConflictManagement.3n	~~	RightPartner.3n


'

# fit the model
Fit.Rcomb.model.c2.con <- lavaan::cfa(Rcomb.model.c2.con, 
                              data=(Jail_clean %>% 
                                        dplyr::filter(in.analysis.sample3 == TRUE)),
                              estimator = "WLSMV",
                              ordered = c("Healthy_Rel_Before.3n" , "Communicate_Before.3n" ,
                                          "ConflictManagement_Before.3n",
                                          "RightPartner_Before.3n", "LearnPartner_Before.3n",
                                          "PaceRelationship_Before.3n",  "WarningSigns_Before.3n",
                                          "LearnedGrowingUp_Before.3n", "PastRelationships_Before.3n",
                                          "GetAlongParents_Before.3n", "FriendshipsAreLike_Before.3n",
                                          "Fights_Before.3n", "FeelingsHurt_Before.3n",
                                          "RightandWrong_Before.3n",
                                          
                                          "Healthy_Rel.3n" , "Communicate.3n" ,
                                          "ConflictManagement.3n",
                                          "RightPartner.3n", "LearnPartner.3n",
                                          "PaceRelationship.3n",  "WarningSigns.3n",
                                          "LearnedGrowingUp.3n", "PastRelationships.3n",
                                          "GetAlongParents.3n", "FriendshipsAreLike.3n",
                                          "Fights.3n", "FeelingsHurt.3n",
                                          "RightandWrong.3n"),
                               parameterization = "theta")

# display summary output
lavaan::summary(Fit.Rcomb.model.c2.con, fit.measures=TRUE, standardized=TRUE )
```

\newpage

### Modification Indices

```{r, echo = FALSE}
lavaan::modificationindices(Fit.Rcomb.model.c2.con) %>% 
    data.frame() %>% 
    dplyr::filter(mi>10) %>% 
    dplyr::arrange(-mi)
    
```

\newpage

### Loading  Invariant

```{r, echo=FALSE}
# specify the model
Rcomb.model.c2.load <- ' 

# Latent common factor definitions

HSP.rpre =~ Healthy_Rel_Before.3n + HSPL2*Communicate_Before.3n + 
            HSPL3*ConflictManagement_Before.3n +
            HSPL4*RightPartner_Before.3n + HSPL5*LearnPartner_Before.3n + 
            HSPL6*PaceRelationship_Before.3n +  HSPL7*WarningSigns_Before.3n
HSP.post =~ Healthy_Rel.3n + HSPL2*Communicate.3n +   
            HSPL3*ConflictManagement.3n +
            HSPL4*RightPartner.3n + HSPL5*LearnPartner.3n + 
            HSPL6*PaceRelationship.3n + HSPL7*WarningSigns.3n

PBA.rpre =~ LearnedGrowingUp_Before.3n + PBAL2*PastRelationships_Before.3n + 
            PBAL3*GetAlongParents_Before.3n + PBAL4*FriendshipsAreLike_Before.3n +
            PBAL5*Fights_Before.3n + PBAL6*FeelingsHurt_Before.3n + PBAL7*RightandWrong_Before.3n 
PBA.post =~ LearnedGrowingUp.3n + PBAL2*PastRelationships.3n + 
            PBAL3*GetAlongParents.3n + PBAL4*FriendshipsAreLike.3n +
            PBAL5*Fights.3n + PBAL6*FeelingsHurt.3n + PBAL7*RightandWrong.3n 

# Communicate_Before.3n ~~ ConflictManagement_Before.3n
# Communicate.3n ~~ ConflictManagement.3n
# 
# PastRelationships_Before.3n ~~ GetAlongParents_Before.3n + FriendshipsAreLike_Before.3n
# GetAlongParents_Before.3n ~~ FriendshipsAreLike_Before.3n
# PastRelationships.3n ~~ GetAlongParents.3n + FriendshipsAreLike.3n
# GetAlongParents.3n ~~ FriendshipsAreLike.3n

# Latent common factor variances and covariances

HSP.rpre ~~ HSP.rpre + HSP.post + PBA.rpre + PBA.post
HSP.post ~~ HSP.post + PBA.rpre + PBA.post
PBA.rpre ~~ PBA.rpre + PBA.post
PBA.post ~~ PBA.post

# Latent common factor means
# Fix factor means to zero

HSP.rpre ~ 0*1
# Freely estimate T2-T4 common factor means
HSP.post ~ 1 
PBA.rpre ~ 1 
PBA.post ~ 1 


# Thresholds
# t1 and t2 after * represent the first and second 
#    thresholds of an indicator, respectively
# Threshold parameters that are freely estimated have labels VaTbtc,
#   with a representing indicator number, b representing time,
#   c representing ordering of the threshold (first, second)
# Threshold parameters that are constrained to be equal over time
#   are given the labels Vatc, with a representing indicator number, 
#   c representing ordering of the threshold (first, second)

Healthy_Rel_Before.3n | V1t1*t1 + V1t2*t2 
Healthy_Rel.3n        | V1t1*t1 + V1t2*t2 

Communicate_Before.3n | V2t1*t1 + V2T1t2*t2 
Communicate.3n        | V2t1*t1 + V2T2t2*t2 

ConflictManagement_Before.3n | V3t1*t1 + V3T1t2*t2 
ConflictManagement.3n        | V3t1*t1 + V3T2t2*t2 


RightPartner_Before.3n | V4t1*t1 + V4T1t2*t2 
RightPartner.3n        | V4t1*t1 + V4T2t2*t2 

LearnPartner_Before.3n | V5t1*t1 + V5T1t2*t2 
LearnPartner.3n        | V5t1*t1 + V5T2t2*t2 

PaceRelationship_Before.3n | V6t1*t1 + V6T1t2*t2 
PaceRelationship.3n        | V6t1*t1 + V6T2t2*t2 

WarningSigns_Before.3n | V7t1*t1 + V7T1t2*t2 
WarningSigns.3n        | V7t1*t1 + V7T2t2*t2 



LearnedGrowingUp_Before.3n | V8t1*t1 + V8T1t2*t2 
LearnedGrowingUp.3n        | V8t1*t1 + V8T2t2*t2 

PastRelationships_Before.3n | V9t1*t1 + V9T1t2*t2 
PastRelationships.3n        | V9t1*t1 + V9T2t2*t2 

GetAlongParents_Before.3n | V10t1*t1 + V10T1t2*t2 
GetAlongParents.3n        | V10t1*t1 + V10T2t2*t2 

FriendshipsAreLike_Before.3n | V11t1*t1 + V11T1t2*t2 
FriendshipsAreLike.3n        | V11t1*t1 + V11T2t2*t2 

 

Fights_Before.3n | V12t1*t1 + V12T1t2*t2 
Fights.3n        | V12t1*t1 + V12T2t2*t2 

FeelingsHurt_Before.3n | V13t1*t1 + V13T1t2*t2 
FeelingsHurt.3n        | V13t1*t1 + V13T2t2*t2 

RightandWrong_Before.3n | V14t1*t1 + V14T1t2*t2 
RightandWrong.3n        | V14t1*t1 + V14T2t2*t2 

 
# Intercepts
# Fix all intercepts to zero

Healthy_Rel_Before.3n + Communicate_Before.3n + ConflictManagement_Before.3n ~ 0*1
Healthy_Rel.3n + Communicate.3n + ConflictManagement.3n ~ 0*1
                 
RightPartner_Before.3n + LearnPartner_Before.3n + PaceRelationship_Before.3n +  WarningSigns_Before.3n ~ 0*1
RightPartner.3n + LearnPartner.3n + PaceRelationship.3n +  WarningSigns.3n ~ 0*1

LearnedGrowingUp_Before.3n + PastRelationships_Before.3n + GetAlongParents_Before.3n + FriendshipsAreLike_Before.3n ~ 0*1
LearnedGrowingUp.3n + PastRelationships.3n + GetAlongParents.3n + FriendshipsAreLike.3n ~ 0*1

Fights_Before.3n + FeelingsHurt_Before.3n + RightandWrong_Before.3n  ~ 0*1
Fights.3n + FeelingsHurt.3n + RightandWrong.3n  ~ 0*1


# Unique variances
# Fix unique variances at T1 to 1.00

Healthy_Rel_Before.3n  ~~ 1*Healthy_Rel_Before.3n
Communicate_Before.3n  ~~ 1*Communicate_Before.3n
ConflictManagement_Before.3n ~~ 1*ConflictManagement_Before.3n

RightPartner_Before.3n ~~ 1*RightPartner_Before.3n
LearnPartner_Before.3n ~~ 1*LearnPartner_Before.3n
PaceRelationship_Before.3n ~~ 1*PaceRelationship_Before.3n
WarningSigns_Before.3n ~~ 1*WarningSigns_Before.3n

LearnedGrowingUp_Before.3n ~~ NA*LearnedGrowingUp_Before.3n
PastRelationships_Before.3n ~~ NA*PastRelationships_Before.3n
GetAlongParents_Before.3n ~~ NA*GetAlongParents_Before.3n
FriendshipsAreLike_Before.3n ~~ NA*FriendshipsAreLike_Before.3n

Fights_Before.3n ~~ NA*Fights_Before.3n
FeelingsHurt_Before.3n ~~ NA*FeelingsHurt_Before.3n
RightandWrong_Before.3n  ~~ NA*RightandWrong_Before.3n

# lavaan constrains all indicator unique variances to 1.00 by default
# Free this constraint at T2

Healthy_Rel.3n  ~~ NA*Healthy_Rel.3n
Communicate.3n  ~~ NA*Communicate.3n
ConflictManagement.3n ~~ NA*ConflictManagement.3n

RightPartner.3n ~~ NA*RightPartner.3n
LearnPartner.3n ~~ NA*LearnPartner.3n
PaceRelationship.3n ~~ NA*PaceRelationship.3n
WarningSigns.3n ~~ NA*WarningSigns.3n

LearnedGrowingUp.3n ~~ NA*LearnedGrowingUp.3n
PastRelationships.3n ~~ NA*PastRelationships.3n
GetAlongParents.3n ~~ NA*GetAlongParents.3n
FriendshipsAreLike.3n ~~ NA*FriendshipsAreLike.3n

Fights.3n ~~ NA*Fights.3n
FeelingsHurt.3n ~~ NA*FeelingsHurt.3n
RightandWrong.3n  ~~ NA*RightandWrong.3n


# Lagged unique factor covariances

Healthy_Rel_Before.3n  ~~ Healthy_Rel.3n
Communicate_Before.3n  ~~ Communicate.3n
ConflictManagement_Before.3n ~~ ConflictManagement.3n

RightPartner_Before.3n ~~ RightPartner.3n
LearnPartner_Before.3n ~~LearnPartner.3n
PaceRelationship_Before.3n ~~ PaceRelationship.3n
WarningSigns_Before.3n ~~ WarningSigns.3n

LearnedGrowingUp_Before.3n ~~ LearnedGrowingUp.3n
PastRelationships_Before.3n ~~ PastRelationships.3n
GetAlongParents_Before.3n ~~ GetAlongParents.3n
FriendshipsAreLike_Before.3n ~~ FriendshipsAreLike.3n

Fights_Before.3n ~~ Fights.3n
FeelingsHurt_Before.3n ~~ FeelingsHurt.3n
RightandWrong_Before.3n  ~~ RightandWrong.3n

ConflictManagement.3n	~~	RightPartner.3n


'

# fit the model
Fit.Rcomb.model.c2.load <- lavaan::cfa(Rcomb.model.c2.load, 
                              data=(Jail_clean %>% 
                                        dplyr::filter(in.analysis.sample3 == TRUE)),
                              estimator = "WLSMV",
                              ordered = c("Healthy_Rel_Before.3n" , "Communicate_Before.3n" ,
                                          "ConflictManagement_Before.3n",
                                          "RightPartner_Before.3n", "LearnPartner_Before.3n",
                                          "PaceRelationship_Before.3n",  "WarningSigns_Before.3n",
                                          "LearnedGrowingUp_Before.3n", "PastRelationships_Before.3n",
                                          "GetAlongParents_Before.3n", "FriendshipsAreLike_Before.3n",
                                          "Fights_Before.3n", "FeelingsHurt_Before.3n",
                                          "RightandWrong_Before.3n",
                                          
                                          "Healthy_Rel.3n" , "Communicate.3n" ,
                                          "ConflictManagement.3n",
                                          "RightPartner.3n", "LearnPartner.3n",
                                          "PaceRelationship.3n",  "WarningSigns.3n",
                                          "LearnedGrowingUp.3n", "PastRelationships.3n",
                                          "GetAlongParents.3n", "FriendshipsAreLike.3n",
                                          "Fights.3n", "FeelingsHurt.3n",
                                          "RightandWrong.3n"),
                               parameterization = "theta")

# display summary output
lavaan::summary(Fit.Rcomb.model.c2.load, fit.measures=TRUE, standardized=TRUE )
```

\newpage

### Modification Indices

```{r, echo = FALSE}
lavaan::modificationindices(Fit.Rcomb.model.c2.load) %>% 
    data.frame() %>% 
    dplyr::filter(mi>10) %>% 
    dplyr::arrange(-mi)
    
```

### Model Comparison
```{r}
lavaan::anova(Fit.Rcomb.model.c2.con, Fit.Rcomb.model.c2.load)
```

\newpage

### Threshold  Invariant

```{r, echo=FALSE}
# specify the model
Rcomb.model.c2.thresh <- ' 

# Latent common factor definitions

HSP.rpre =~ Healthy_Rel_Before.3n + HSPL2*Communicate_Before.3n + 
            HSPL3*ConflictManagement_Before.3n +
            HSPL4*RightPartner_Before.3n + HSPL5*LearnPartner_Before.3n + 
            HSPL6*PaceRelationship_Before.3n +  HSPL7*WarningSigns_Before.3n
HSP.post =~ Healthy_Rel.3n + HSPL2*Communicate.3n +   
            HSPL3*ConflictManagement.3n +
            HSPL4*RightPartner.3n + HSPL5*LearnPartner.3n + 
            HSPL6*PaceRelationship.3n + HSPL7*WarningSigns.3n

PBA.rpre =~ LearnedGrowingUp_Before.3n + PBAL2*PastRelationships_Before.3n + 
            PBAL3*GetAlongParents_Before.3n + PBAL4*FriendshipsAreLike_Before.3n +
            PBAL5*Fights_Before.3n + PBAL6*FeelingsHurt_Before.3n + PBAL7*RightandWrong_Before.3n 
PBA.post =~ LearnedGrowingUp.3n + PBAL2*PastRelationships.3n + 
            PBAL3*GetAlongParents.3n + PBAL4*FriendshipsAreLike.3n +
            PBAL5*Fights.3n + PBAL6*FeelingsHurt.3n + PBAL7*RightandWrong.3n 

# Communicate_Before.3n ~~ ConflictManagement_Before.3n
# Communicate.3n ~~ ConflictManagement.3n
# 
# PastRelationships_Before.3n ~~ GetAlongParents_Before.3n + FriendshipsAreLike_Before.3n
# GetAlongParents_Before.3n ~~ FriendshipsAreLike_Before.3n
# PastRelationships.3n ~~ GetAlongParents.3n + FriendshipsAreLike.3n
# GetAlongParents.3n ~~ FriendshipsAreLike.3n

# Latent common factor variances and covariances

HSP.rpre ~~ HSP.rpre + HSP.post + PBA.rpre + PBA.post
HSP.post ~~ HSP.post + PBA.rpre + PBA.post
PBA.rpre ~~ PBA.rpre + PBA.post
PBA.post ~~ PBA.post

# Latent common factor means
# Fix factor means to zero

HSP.rpre ~ 0*1
# Freely estimate T2-T4 common factor means
HSP.post ~ 1 
PBA.rpre ~ 1 
PBA.post ~ 1 


# Thresholds
# t1 and t2 after * represent the first and second 
#    thresholds of an indicator, respectively
# Threshold parameters that are freely estimated have labels VaTbtc,
#   with a representing indicator number, b representing time,
#   c representing ordering of the threshold (first, second)
# Threshold parameters that are constrained to be equal over time
#   are given the labels Vatc, with a representing indicator number, 
#   c representing ordering of the threshold (first, second)

Healthy_Rel_Before.3n | V1t1*t1 + V1t2*t2 
Healthy_Rel.3n        | V1t1*t1 + V1t2*t2 

Communicate_Before.3n | V2t1*t1 + V2t2*t2 
Communicate.3n        | V2t1*t1 + V2t2*t2 

ConflictManagement_Before.3n | V3t1*t1 + V3t2*t2 
ConflictManagement.3n        | V3t1*t1 + V3t2*t2 


RightPartner_Before.3n | V4t1*t1 + V4t2*t2 
RightPartner.3n        | V4t1*t1 + V4t2*t2 

LearnPartner_Before.3n | V5t1*t1 + V5t2*t2 
LearnPartner.3n        | V5t1*t1 + V5t2*t2 

PaceRelationship_Before.3n | V6t1*t1 + V6t2*t2 
PaceRelationship.3n        | V6t1*t1 + V6t2*t2 

WarningSigns_Before.3n | V7t1*t1 + V7t2*t2 
WarningSigns.3n        | V7t1*t1 + V7t2*t2 



LearnedGrowingUp_Before.3n | V8t1*t1 + V8t2*t2 
LearnedGrowingUp.3n        | V8t1*t1 + V8t2*t2 

PastRelationships_Before.3n | V9t1*t1 + V9t2*t2 
PastRelationships.3n        | V9t1*t1 + V9t2*t2 

GetAlongParents_Before.3n | V10t1*t1 + V10t2*t2 
GetAlongParents.3n        | V10t1*t1 + V10t2*t2 

FriendshipsAreLike_Before.3n | V11t1*t1 + V11t2*t2 
FriendshipsAreLike.3n        | V11t1*t1 + V11t2*t2 

 

Fights_Before.3n | V12t1*t1 + V12t2*t2 
Fights.3n        | V12t1*t1 + V12t2*t2 

FeelingsHurt_Before.3n | V13t1*t1 + V13t2*t2 
FeelingsHurt.3n        | V13t1*t1 + V13t2*t2 

RightandWrong_Before.3n | V14t1*t1 + V14t2*t2 
RightandWrong.3n        | V14t1*t1 + V14t2*t2 

 
# Intercepts
# Fix all intercepts to zero

Healthy_Rel_Before.3n + Communicate_Before.3n + ConflictManagement_Before.3n ~ 0*1
Healthy_Rel.3n + Communicate.3n + ConflictManagement.3n ~ 0*1
                 
RightPartner_Before.3n + LearnPartner_Before.3n + PaceRelationship_Before.3n +  WarningSigns_Before.3n ~ 0*1
RightPartner.3n + LearnPartner.3n + PaceRelationship.3n +  WarningSigns.3n ~ 0*1

LearnedGrowingUp_Before.3n + PastRelationships_Before.3n + GetAlongParents_Before.3n + FriendshipsAreLike_Before.3n ~ 0*1
LearnedGrowingUp.3n + PastRelationships.3n + GetAlongParents.3n + FriendshipsAreLike.3n ~ 0*1

Fights_Before.3n + FeelingsHurt_Before.3n + RightandWrong_Before.3n  ~ 0*1
Fights.3n + FeelingsHurt.3n + RightandWrong.3n  ~ 0*1


# Unique variances
# Fix unique variances at T1 to 1.00

Healthy_Rel_Before.3n  ~~ 1*Healthy_Rel_Before.3n
Communicate_Before.3n  ~~ 1*Communicate_Before.3n
ConflictManagement_Before.3n ~~ 1*ConflictManagement_Before.3n

RightPartner_Before.3n ~~ 1*RightPartner_Before.3n
LearnPartner_Before.3n ~~ 1*LearnPartner_Before.3n
PaceRelationship_Before.3n ~~ 1*PaceRelationship_Before.3n
WarningSigns_Before.3n ~~ 1*WarningSigns_Before.3n

LearnedGrowingUp_Before.3n ~~ NA*LearnedGrowingUp_Before.3n
PastRelationships_Before.3n ~~ NA*PastRelationships_Before.3n
GetAlongParents_Before.3n ~~ NA*GetAlongParents_Before.3n
FriendshipsAreLike_Before.3n ~~ NA*FriendshipsAreLike_Before.3n

Fights_Before.3n ~~ NA*Fights_Before.3n
FeelingsHurt_Before.3n ~~ NA*FeelingsHurt_Before.3n
RightandWrong_Before.3n  ~~ NA*RightandWrong_Before.3n

# lavaan constrains all indicator unique variances to 1.00 by default
# Free this constraint at T2

Healthy_Rel.3n  ~~ NA*Healthy_Rel.3n
Communicate.3n  ~~ NA*Communicate.3n
ConflictManagement.3n ~~ NA*ConflictManagement.3n

RightPartner.3n ~~ NA*RightPartner.3n
LearnPartner.3n ~~ NA*LearnPartner.3n
PaceRelationship.3n ~~ NA*PaceRelationship.3n
WarningSigns.3n ~~ NA*WarningSigns.3n

LearnedGrowingUp.3n ~~ NA*LearnedGrowingUp.3n
PastRelationships.3n ~~ NA*PastRelationships.3n
GetAlongParents.3n ~~ NA*GetAlongParents.3n
FriendshipsAreLike.3n ~~ NA*FriendshipsAreLike.3n

Fights.3n ~~ NA*Fights.3n
FeelingsHurt.3n ~~ NA*FeelingsHurt.3n
RightandWrong.3n  ~~ NA*RightandWrong.3n


# Lagged unique factor covariances

Healthy_Rel_Before.3n  ~~ Healthy_Rel.3n
Communicate_Before.3n  ~~ Communicate.3n
ConflictManagement_Before.3n ~~ ConflictManagement.3n

RightPartner_Before.3n ~~ RightPartner.3n
LearnPartner_Before.3n ~~LearnPartner.3n
PaceRelationship_Before.3n ~~ PaceRelationship.3n
WarningSigns_Before.3n ~~ WarningSigns.3n

LearnedGrowingUp_Before.3n ~~ LearnedGrowingUp.3n
PastRelationships_Before.3n ~~ PastRelationships.3n
GetAlongParents_Before.3n ~~ GetAlongParents.3n
FriendshipsAreLike_Before.3n ~~ FriendshipsAreLike.3n

Fights_Before.3n ~~ Fights.3n
FeelingsHurt_Before.3n ~~ FeelingsHurt.3n
RightandWrong_Before.3n  ~~ RightandWrong.3n

ConflictManagement.3n	~~	RightPartner.3n


'

# fit the model
Fit.Rcomb.model.c2.thresh <- lavaan::cfa(Rcomb.model.c2.thresh, 
                              data=(Jail_clean %>% 
                                        dplyr::filter(in.analysis.sample3 == TRUE)),
                              estimator = "WLSMV",
                              ordered = c("Healthy_Rel_Before.3n" , "Communicate_Before.3n" ,
                                          "ConflictManagement_Before.3n",
                                          "RightPartner_Before.3n", "LearnPartner_Before.3n",
                                          "PaceRelationship_Before.3n",  "WarningSigns_Before.3n",
                                          "LearnedGrowingUp_Before.3n", "PastRelationships_Before.3n",
                                          "GetAlongParents_Before.3n", "FriendshipsAreLike_Before.3n",
                                          "Fights_Before.3n", "FeelingsHurt_Before.3n",
                                          "RightandWrong_Before.3n",
                                          
                                          "Healthy_Rel.3n" , "Communicate.3n" ,
                                          "ConflictManagement.3n",
                                          "RightPartner.3n", "LearnPartner.3n",
                                          "PaceRelationship.3n",  "WarningSigns.3n",
                                          "LearnedGrowingUp.3n", "PastRelationships.3n",
                                          "GetAlongParents.3n", "FriendshipsAreLike.3n",
                                          "Fights.3n", "FeelingsHurt.3n",
                                          "RightandWrong.3n"),
                               parameterization = "theta")

# display summary output
lavaan::summary(Fit.Rcomb.model.c2.thresh, fit.measures=TRUE, standardized=TRUE )
```

\newpage

### Modification Indices

```{r, echo = FALSE}
lavaan::modificationindices(Fit.Rcomb.model.c2.thresh) %>% 
    data.frame() %>% 
    dplyr::filter(mi>10) %>% 
    dplyr::arrange(-mi)
    
```

### Model Comparison
```{r}
lavaan::anova(Fit.Rcomb.model.c2.load, Fit.Rcomb.model.c2.thresh)
```

\newpage

### Threshold Invariant 2

```{r, echo=FALSE}
# specify the model
Rcomb.model.c2.thresh2 <- ' 

# Latent common factor definitions

HSP.rpre =~ Healthy_Rel_Before.3n + HSPL2*Communicate_Before.3n + 
            HSPL3*ConflictManagement_Before.3n +
            HSPL4*RightPartner_Before.3n + HSPL5*LearnPartner_Before.3n + 
            HSPL6*PaceRelationship_Before.3n +  HSPL7*WarningSigns_Before.3n
HSP.post =~ Healthy_Rel.3n + HSPL2*Communicate.3n +   
            HSPL3*ConflictManagement.3n +
            HSPL4*RightPartner.3n + HSPL5*LearnPartner.3n + 
            HSPL6*PaceRelationship.3n + HSPL7*WarningSigns.3n

PBA.rpre =~ LearnedGrowingUp_Before.3n + PBAL2*PastRelationships_Before.3n + 
            PBAL3*GetAlongParents_Before.3n + PBAL4*FriendshipsAreLike_Before.3n +
            PBAL5*Fights_Before.3n + PBAL6*FeelingsHurt_Before.3n + PBAL7*RightandWrong_Before.3n 
PBA.post =~ LearnedGrowingUp.3n + PBAL2*PastRelationships.3n + 
            PBAL3*GetAlongParents.3n + PBAL4*FriendshipsAreLike.3n +
            PBAL5*Fights.3n + PBAL6*FeelingsHurt.3n + PBAL7*RightandWrong.3n 

# Communicate_Before.3n ~~ ConflictManagement_Before.3n
# Communicate.3n ~~ ConflictManagement.3n
# 
# PastRelationships_Before.3n ~~ GetAlongParents_Before.3n + FriendshipsAreLike_Before.3n
# GetAlongParents_Before.3n ~~ FriendshipsAreLike_Before.3n
# PastRelationships.3n ~~ GetAlongParents.3n + FriendshipsAreLike.3n
# GetAlongParents.3n ~~ FriendshipsAreLike.3n

# Latent common factor variances and covariances

HSP.rpre ~~ HSP.rpre + HSP.post + PBA.rpre + PBA.post
HSP.post ~~ HSP.post + PBA.rpre + PBA.post
PBA.rpre ~~ PBA.rpre + PBA.post
PBA.post ~~ PBA.post

# Latent common factor means
# Fix factor means to zero

HSP.rpre ~ 0*1
# Freely estimate T2-T4 common factor means
HSP.post ~ 1 
PBA.rpre ~ 1 
PBA.post ~ 1 


# Thresholds
# t1 and t2 after * represent the first and second 
#    thresholds of an indicator, respectively
# Threshold parameters that are freely estimated have labels VaTbtc,
#   with a representing indicator number, b representing time,
#   c representing ordering of the threshold (first, second)
# Threshold parameters that are constrained to be equal over time
#   are given the labels Vatc, with a representing indicator number, 
#   c representing ordering of the threshold (first, second)

Healthy_Rel_Before.3n | V1t1*t1 + V1t2*t2 
Healthy_Rel.3n        | V1t1*t1 + V1t2*t2 

Communicate_Before.3n | V2t1*t1 + V2t2*t2 
Communicate.3n        | V2t1*t1 + V2t2*t2 

ConflictManagement_Before.3n | V3t1*t1 + V3t2*t2 
ConflictManagement.3n        | V3t1*t1 + V3t2*t2 


RightPartner_Before.3n | V4t1*t1 + V4t2*t2 
RightPartner.3n        | V4t1*t1 + V4t2*t2 

LearnPartner_Before.3n | V5t1*t1 + V5t2*t2 
LearnPartner.3n        | V5t1*t1 + V5t2*t2 

PaceRelationship_Before.3n | V6t1*t1 + V6t2*t2 
PaceRelationship.3n        | V6t1*t1 + V6t2*t2 

WarningSigns_Before.3n | V7t1*t1 + V7t2*t2 
WarningSigns.3n        | V7t1*t1 + V7t2*t2 



LearnedGrowingUp_Before.3n | V8t1*t1 + V8t2*t2 
LearnedGrowingUp.3n        | V8t1*t1 + V8t2*t2 

PastRelationships_Before.3n | V9t1*t1 + V9t2*t2 
PastRelationships.3n        | V9t1*t1 + V9t2*t2 

GetAlongParents_Before.3n | V10t1*t1 + V10T1t2*t2 
GetAlongParents.3n        | V10t1*t1 + V10t2*t2 

FriendshipsAreLike_Before.3n | V11t1*t1 + V11t2*t2 
FriendshipsAreLike.3n        | V11t1*t1 + V11t2*t2 

 

Fights_Before.3n | V12t1*t1 + V12t2*t2 
Fights.3n        | V12t1*t1 + V12t2*t2 

FeelingsHurt_Before.3n | V13t1*t1 + V13t2*t2 
FeelingsHurt.3n        | V13t1*t1 + V13t2*t2 

RightandWrong_Before.3n | V14t1*t1 + V14t2*t2 
RightandWrong.3n        | V14t1*t1 + V14t2*t2 

 
# Intercepts
# Fix all intercepts to zero

Healthy_Rel_Before.3n + Communicate_Before.3n + ConflictManagement_Before.3n ~ 0*1
Healthy_Rel.3n + Communicate.3n + ConflictManagement.3n ~ 0*1
                 
RightPartner_Before.3n + LearnPartner_Before.3n + PaceRelationship_Before.3n +  WarningSigns_Before.3n ~ 0*1
RightPartner.3n + LearnPartner.3n + PaceRelationship.3n +  WarningSigns.3n ~ 0*1

LearnedGrowingUp_Before.3n + PastRelationships_Before.3n + GetAlongParents_Before.3n + FriendshipsAreLike_Before.3n ~ 0*1
LearnedGrowingUp.3n + PastRelationships.3n + GetAlongParents.3n + FriendshipsAreLike.3n ~ 0*1

Fights_Before.3n + FeelingsHurt_Before.3n + RightandWrong_Before.3n  ~ 0*1
Fights.3n + FeelingsHurt.3n + RightandWrong.3n  ~ 0*1


# Unique variances
# Fix unique variances at T1 to 1.00

Healthy_Rel_Before.3n  ~~ 1*Healthy_Rel_Before.3n
Communicate_Before.3n  ~~ 1*Communicate_Before.3n
ConflictManagement_Before.3n ~~ 1*ConflictManagement_Before.3n

RightPartner_Before.3n ~~ 1*RightPartner_Before.3n
LearnPartner_Before.3n ~~ 1*LearnPartner_Before.3n
PaceRelationship_Before.3n ~~ 1*PaceRelationship_Before.3n
WarningSigns_Before.3n ~~ 1*WarningSigns_Before.3n

LearnedGrowingUp_Before.3n ~~ NA*LearnedGrowingUp_Before.3n
PastRelationships_Before.3n ~~ NA*PastRelationships_Before.3n
GetAlongParents_Before.3n ~~ NA*GetAlongParents_Before.3n
FriendshipsAreLike_Before.3n ~~ NA*FriendshipsAreLike_Before.3n

Fights_Before.3n ~~ NA*Fights_Before.3n
FeelingsHurt_Before.3n ~~ NA*FeelingsHurt_Before.3n
RightandWrong_Before.3n  ~~ NA*RightandWrong_Before.3n

# lavaan constrains all indicator unique variances to 1.00 by default
# Free this constraint at T2

Healthy_Rel.3n  ~~ NA*Healthy_Rel.3n
Communicate.3n  ~~ NA*Communicate.3n
ConflictManagement.3n ~~ NA*ConflictManagement.3n

RightPartner.3n ~~ NA*RightPartner.3n
LearnPartner.3n ~~ NA*LearnPartner.3n
PaceRelationship.3n ~~ NA*PaceRelationship.3n
WarningSigns.3n ~~ NA*WarningSigns.3n

LearnedGrowingUp.3n ~~ NA*LearnedGrowingUp.3n
PastRelationships.3n ~~ NA*PastRelationships.3n
GetAlongParents.3n ~~ NA*GetAlongParents.3n
FriendshipsAreLike.3n ~~ NA*FriendshipsAreLike.3n

Fights.3n ~~ NA*Fights.3n
FeelingsHurt.3n ~~ NA*FeelingsHurt.3n
RightandWrong.3n  ~~ NA*RightandWrong.3n


# Lagged unique factor covariances

Healthy_Rel_Before.3n  ~~ Healthy_Rel.3n
Communicate_Before.3n  ~~ Communicate.3n
ConflictManagement_Before.3n ~~ ConflictManagement.3n

RightPartner_Before.3n ~~ RightPartner.3n
LearnPartner_Before.3n ~~LearnPartner.3n
PaceRelationship_Before.3n ~~ PaceRelationship.3n
WarningSigns_Before.3n ~~ WarningSigns.3n

LearnedGrowingUp_Before.3n ~~ LearnedGrowingUp.3n
PastRelationships_Before.3n ~~ PastRelationships.3n
GetAlongParents_Before.3n ~~ GetAlongParents.3n
FriendshipsAreLike_Before.3n ~~ FriendshipsAreLike.3n

Fights_Before.3n ~~ Fights.3n
FeelingsHurt_Before.3n ~~ FeelingsHurt.3n
RightandWrong_Before.3n  ~~ RightandWrong.3n

ConflictManagement.3n	~~	RightPartner.3n


'

# fit the model
Fit.Rcomb.model.c2.thresh2 <- lavaan::cfa(Rcomb.model.c2.thresh2, 
                              data=(Jail_clean %>% 
                                        dplyr::filter(in.analysis.sample3 == TRUE)),
                              estimator = "WLSMV",
                              ordered = c("Healthy_Rel_Before.3n" , "Communicate_Before.3n" ,
                                          "ConflictManagement_Before.3n",
                                          "RightPartner_Before.3n", "LearnPartner_Before.3n",
                                          "PaceRelationship_Before.3n",  "WarningSigns_Before.3n",
                                          "LearnedGrowingUp_Before.3n", "PastRelationships_Before.3n",
                                          "GetAlongParents_Before.3n", "FriendshipsAreLike_Before.3n",
                                          "Fights_Before.3n", "FeelingsHurt_Before.3n",
                                          "RightandWrong_Before.3n",
                                          
                                          "Healthy_Rel.3n" , "Communicate.3n" ,
                                          "ConflictManagement.3n",
                                          "RightPartner.3n", "LearnPartner.3n",
                                          "PaceRelationship.3n",  "WarningSigns.3n",
                                          "LearnedGrowingUp.3n", "PastRelationships.3n",
                                          "GetAlongParents.3n", "FriendshipsAreLike.3n",
                                          "Fights.3n", "FeelingsHurt.3n",
                                          "RightandWrong.3n"),
                               parameterization = "theta")

# display summary output
lavaan::summary(Fit.Rcomb.model.c2.thresh2, fit.measures=TRUE, standardized=TRUE )
```

\newpage

### Modification Indices

```{r, echo = FALSE}
lavaan::modificationindices(Fit.Rcomb.model.c2.thresh2) %>% 
    data.frame() %>% 
    dplyr::filter(mi>10) %>% 
    dplyr::arrange(-mi)
    
```

### Model Comparison
```{r}
lavaan::anova(Fit.Rcomb.model.c2.load, Fit.Rcomb.model.c2.thresh2)
```






\newpage

### Unique  Invariant

```{r, echo=FALSE}
# specify the model
Rcomb.model.c2.unique <- ' 

# Latent common factor definitions

HSP.rpre =~ Healthy_Rel_Before.3n + HSPL2*Communicate_Before.3n + 
            HSPL3*ConflictManagement_Before.3n +
            HSPL4*RightPartner_Before.3n + HSPL5*LearnPartner_Before.3n + 
            HSPL6*PaceRelationship_Before.3n +  HSPL7*WarningSigns_Before.3n
HSP.post =~ Healthy_Rel.3n + HSPL2*Communicate.3n +   
            HSPL3*ConflictManagement.3n +
            HSPL4*RightPartner.3n + HSPL5*LearnPartner.3n + 
            HSPL6*PaceRelationship.3n + HSPL7*WarningSigns.3n

PBA.rpre =~ LearnedGrowingUp_Before.3n + PBAL2*PastRelationships_Before.3n + 
            PBAL3*GetAlongParents_Before.3n + PBAL4*FriendshipsAreLike_Before.3n +
            PBAL5*Fights_Before.3n + PBAL6*FeelingsHurt_Before.3n + PBAL7*RightandWrong_Before.3n 
PBA.post =~ LearnedGrowingUp.3n + PBAL2*PastRelationships.3n + 
            PBAL3*GetAlongParents.3n + PBAL4*FriendshipsAreLike.3n +
            PBAL5*Fights.3n + PBAL6*FeelingsHurt.3n + PBAL7*RightandWrong.3n 

# Communicate_Before.3n ~~ ConflictManagement_Before.3n
# Communicate.3n ~~ ConflictManagement.3n
# 
# PastRelationships_Before.3n ~~ GetAlongParents_Before.3n + FriendshipsAreLike_Before.3n
# GetAlongParents_Before.3n ~~ FriendshipsAreLike_Before.3n
# PastRelationships.3n ~~ GetAlongParents.3n + FriendshipsAreLike.3n
# GetAlongParents.3n ~~ FriendshipsAreLike.3n

# Latent common factor variances and covariances

HSP.rpre ~~ HSP.rpre + HSP.post + PBA.rpre + PBA.post
HSP.post ~~ HSP.post + PBA.rpre + PBA.post
PBA.rpre ~~ PBA.rpre + PBA.post
PBA.post ~~ PBA.post

# Latent common factor means
# Fix factor means to zero

HSP.rpre ~ 0*1
# Freely estimate T2-T4 common factor means
HSP.post ~ 1 
PBA.rpre ~ 1 
PBA.post ~ 1 


# Thresholds
# t1 and t2 after * represent the first and second 
#    thresholds of an indicator, respectively
# Threshold parameters that are freely estimated have labels VaTbtc,
#   with a representing indicator number, b representing time,
#   c representing ordering of the threshold (first, second)
# Threshold parameters that are constrained to be equal over time
#   are given the labels Vatc, with a representing indicator number, 
#   c representing ordering of the threshold (first, second)

Healthy_Rel_Before.3n | V1t1*t1 + V1t2*t2 
Healthy_Rel.3n        | V1t1*t1 + V1t2*t2 

Communicate_Before.3n | V2t1*t1 + V2t2*t2 
Communicate.3n        | V2t1*t1 + V2t2*t2 

ConflictManagement_Before.3n | V3t1*t1 + V3t2*t2 
ConflictManagement.3n        | V3t1*t1 + V3t2*t2 


RightPartner_Before.3n | V4t1*t1 + V4t2*t2 
RightPartner.3n        | V4t1*t1 + V4t2*t2 

LearnPartner_Before.3n | V5t1*t1 + V5t2*t2 
LearnPartner.3n        | V5t1*t1 + V5t2*t2 

PaceRelationship_Before.3n | V6t1*t1 + V6t2*t2 
PaceRelationship.3n        | V6t1*t1 + V6t2*t2 

WarningSigns_Before.3n | V7t1*t1 + V7t2*t2 
WarningSigns.3n        | V7t1*t1 + V7t2*t2 



LearnedGrowingUp_Before.3n | V8t1*t1 + V8t2*t2 
LearnedGrowingUp.3n        | V8t1*t1 + V8t2*t2 

PastRelationships_Before.3n | V9t1*t1 + V9t2*t2 
PastRelationships.3n        | V9t1*t1 + V9t2*t2 

GetAlongParents_Before.3n | V10t1*t1 + V10T1t2*t2 
GetAlongParents.3n        | V10t1*t1 + V10t2*t2 

FriendshipsAreLike_Before.3n | V11t1*t1 + V11t2*t2 
FriendshipsAreLike.3n        | V11t1*t1 + V11t2*t2 

 

Fights_Before.3n | V12t1*t1 + V12t2*t2 
Fights.3n        | V12t1*t1 + V12t2*t2 

FeelingsHurt_Before.3n | V13t1*t1 + V13t2*t2 
FeelingsHurt.3n        | V13t1*t1 + V13t2*t2 

RightandWrong_Before.3n | V14t1*t1 + V14t2*t2 
RightandWrong.3n        | V14t1*t1 + V14t2*t2 

 
# Intercepts
# Fix all intercepts to zero

Healthy_Rel_Before.3n + Communicate_Before.3n + ConflictManagement_Before.3n ~ 0*1
Healthy_Rel.3n + Communicate.3n + ConflictManagement.3n ~ 0*1
                 
RightPartner_Before.3n + LearnPartner_Before.3n + PaceRelationship_Before.3n +  WarningSigns_Before.3n ~ 0*1
RightPartner.3n + LearnPartner.3n + PaceRelationship.3n +  WarningSigns.3n ~ 0*1

LearnedGrowingUp_Before.3n + PastRelationships_Before.3n + GetAlongParents_Before.3n + FriendshipsAreLike_Before.3n ~ 0*1
LearnedGrowingUp.3n + PastRelationships.3n + GetAlongParents.3n + FriendshipsAreLike.3n ~ 0*1

Fights_Before.3n + FeelingsHurt_Before.3n + RightandWrong_Before.3n  ~ 0*1
Fights.3n + FeelingsHurt.3n + RightandWrong.3n  ~ 0*1


# Unique variances
# Fix unique variances at T1 to 1.00

Healthy_Rel_Before.3n  ~~ 1*Healthy_Rel_Before.3n
Communicate_Before.3n  ~~ 1*Communicate_Before.3n
ConflictManagement_Before.3n ~~ 1*ConflictManagement_Before.3n

RightPartner_Before.3n ~~ 1*RightPartner_Before.3n
LearnPartner_Before.3n ~~ 1*LearnPartner_Before.3n
PaceRelationship_Before.3n ~~ 1*PaceRelationship_Before.3n
WarningSigns_Before.3n ~~ 1*WarningSigns_Before.3n

LearnedGrowingUp_Before.3n ~~ 1*LearnedGrowingUp_Before.3n
PastRelationships_Before.3n ~~ 1*PastRelationships_Before.3n
GetAlongParents_Before.3n ~~ 1*GetAlongParents_Before.3n
FriendshipsAreLike_Before.3n ~~ 1*FriendshipsAreLike_Before.3n

Fights_Before.3n ~~ 1*Fights_Before.3n
FeelingsHurt_Before.3n ~~ 1*FeelingsHurt_Before.3n
RightandWrong_Before.3n  ~~ 1*RightandWrong_Before.3n

# lavaan constrains all indicator unique variances to 1.00 by default
# Free this constraint at T2

Healthy_Rel.3n  ~~ 1*Healthy_Rel.3n
Communicate.3n  ~~ 1*Communicate.3n
ConflictManagement.3n ~~ 1*ConflictManagement.3n

RightPartner.3n ~~ 1*RightPartner.3n
LearnPartner.3n ~~ 1*LearnPartner.3n
PaceRelationship.3n ~~ 1*PaceRelationship.3n
WarningSigns.3n ~~ 1*WarningSigns.3n

LearnedGrowingUp.3n ~~ 1*LearnedGrowingUp.3n
PastRelationships.3n ~~ 1*PastRelationships.3n
GetAlongParents.3n ~~ NA*GetAlongParents.3n
FriendshipsAreLike.3n ~~ 1*FriendshipsAreLike.3n

Fights.3n ~~ 1*Fights.3n
FeelingsHurt.3n ~~ 1*FeelingsHurt.3n
RightandWrong.3n  ~~ 1*RightandWrong.3n


# Lagged unique factor covariances

Healthy_Rel_Before.3n  ~~ Healthy_Rel.3n
Communicate_Before.3n  ~~ Communicate.3n
ConflictManagement_Before.3n ~~ ConflictManagement.3n

RightPartner_Before.3n ~~ RightPartner.3n
LearnPartner_Before.3n ~~LearnPartner.3n
PaceRelationship_Before.3n ~~ PaceRelationship.3n
WarningSigns_Before.3n ~~ WarningSigns.3n

LearnedGrowingUp_Before.3n ~~ LearnedGrowingUp.3n
PastRelationships_Before.3n ~~ PastRelationships.3n
GetAlongParents_Before.3n ~~ GetAlongParents.3n
FriendshipsAreLike_Before.3n ~~ FriendshipsAreLike.3n

Fights_Before.3n ~~ Fights.3n
FeelingsHurt_Before.3n ~~ FeelingsHurt.3n
RightandWrong_Before.3n  ~~ RightandWrong.3n

ConflictManagement.3n	~~	RightPartner.3n


'

# fit the model
Fit.Rcomb.model.c2.unique <- lavaan::cfa(Rcomb.model.c2.unique, 
                              data=(Jail_clean %>% 
                                        dplyr::filter(in.analysis.sample3 == TRUE)),
                              estimator = "WLSMV",
                              ordered = c("Healthy_Rel_Before.3n" , "Communicate_Before.3n" ,
                                          "ConflictManagement_Before.3n",
                                          "RightPartner_Before.3n", "LearnPartner_Before.3n",
                                          "PaceRelationship_Before.3n",  "WarningSigns_Before.3n",
                                          "LearnedGrowingUp_Before.3n", "PastRelationships_Before.3n",
                                          "GetAlongParents_Before.3n", "FriendshipsAreLike_Before.3n",
                                          "Fights_Before.3n", "FeelingsHurt_Before.3n",
                                          "RightandWrong_Before.3n",
                                          
                                          "Healthy_Rel.3n" , "Communicate.3n" ,
                                          "ConflictManagement.3n",
                                          "RightPartner.3n", "LearnPartner.3n",
                                          "PaceRelationship.3n",  "WarningSigns.3n",
                                          "LearnedGrowingUp.3n", "PastRelationships.3n",
                                          "GetAlongParents.3n", "FriendshipsAreLike.3n",
                                          "Fights.3n", "FeelingsHurt.3n",
                                          "RightandWrong.3n"),
                               parameterization = "theta")

# display summary output
lavaan::summary(Fit.Rcomb.model.c2.unique, fit.measures=TRUE, standardized=TRUE )
```

\newpage

### Modification Indices

```{r, echo = FALSE}
lavaan::modificationindices(Fit.Rcomb.model.c2.unique) %>% 
    data.frame() %>% 
    dplyr::filter(mi>10) %>% 
    dplyr::arrange(-mi)
    
```

### Model Comparison
```{r}
lavaan::anova(Fit.Rcomb.model.c2.thresh2, Fit.Rcomb.model.c2.unique)
```

\newpage

### Unique  Invariant 2

```{r, echo=FALSE}
# specify the model
Rcomb.model.c2.unique2 <- ' 

# Latent common factor definitions

HSP.rpre =~ Healthy_Rel_Before.3n + HSPL2*Communicate_Before.3n + 
            HSPL3*ConflictManagement_Before.3n +
            HSPL4*RightPartner_Before.3n + HSPL5*LearnPartner_Before.3n + 
            HSPL6*PaceRelationship_Before.3n +  HSPL7*WarningSigns_Before.3n
HSP.post =~ Healthy_Rel.3n + HSPL2*Communicate.3n +   
            HSPL3*ConflictManagement.3n +
            HSPL4*RightPartner.3n + HSPL5*LearnPartner.3n + 
            HSPL6*PaceRelationship.3n + HSPL7*WarningSigns.3n

PBA.rpre =~ LearnedGrowingUp_Before.3n + PBAL2*PastRelationships_Before.3n + 
            PBAL3*GetAlongParents_Before.3n + PBAL4*FriendshipsAreLike_Before.3n +
            PBAL5*Fights_Before.3n + PBAL6*FeelingsHurt_Before.3n + PBAL7*RightandWrong_Before.3n 
PBA.post =~ LearnedGrowingUp.3n + PBAL2*PastRelationships.3n + 
            PBAL3*GetAlongParents.3n + PBAL4*FriendshipsAreLike.3n +
            PBAL5*Fights.3n + PBAL6*FeelingsHurt.3n + PBAL7*RightandWrong.3n 

# Communicate_Before.3n ~~ ConflictManagement_Before.3n
# Communicate.3n ~~ ConflictManagement.3n
# 
# PastRelationships_Before.3n ~~ GetAlongParents_Before.3n + FriendshipsAreLike_Before.3n
# GetAlongParents_Before.3n ~~ FriendshipsAreLike_Before.3n
# PastRelationships.3n ~~ GetAlongParents.3n + FriendshipsAreLike.3n
# GetAlongParents.3n ~~ FriendshipsAreLike.3n

# Latent common factor variances and covariances

HSP.rpre ~~ HSP.rpre + HSP.post + PBA.rpre + PBA.post
HSP.post ~~ HSP.post + PBA.rpre + PBA.post
PBA.rpre ~~ PBA.rpre + PBA.post
PBA.post ~~ PBA.post

# Latent common factor means
# Fix factor means to zero

HSP.rpre ~ 0*1
# Freely estimate T2-T4 common factor means
HSP.post ~ 1 
PBA.rpre ~ 1 
PBA.post ~ 1 


# Thresholds
# t1 and t2 after * represent the first and second 
#    thresholds of an indicator, respectively
# Threshold parameters that are freely estimated have labels VaTbtc,
#   with a representing indicator number, b representing time,
#   c representing ordering of the threshold (first, second)
# Threshold parameters that are constrained to be equal over time
#   are given the labels Vatc, with a representing indicator number, 
#   c representing ordering of the threshold (first, second)

Healthy_Rel_Before.3n | V1t1*t1 + V1t2*t2 
Healthy_Rel.3n        | V1t1*t1 + V1t2*t2 

Communicate_Before.3n | V2t1*t1 + V2t2*t2 
Communicate.3n        | V2t1*t1 + V2t2*t2 

ConflictManagement_Before.3n | V3t1*t1 + V3t2*t2 
ConflictManagement.3n        | V3t1*t1 + V3t2*t2 


RightPartner_Before.3n | V4t1*t1 + V4t2*t2 
RightPartner.3n        | V4t1*t1 + V4t2*t2 

LearnPartner_Before.3n | V5t1*t1 + V5t2*t2 
LearnPartner.3n        | V5t1*t1 + V5t2*t2 

PaceRelationship_Before.3n | V6t1*t1 + V6t2*t2 
PaceRelationship.3n        | V6t1*t1 + V6t2*t2 

WarningSigns_Before.3n | V7t1*t1 + V7t2*t2 
WarningSigns.3n        | V7t1*t1 + V7t2*t2 



LearnedGrowingUp_Before.3n | V8t1*t1 + V8t2*t2 
LearnedGrowingUp.3n        | V8t1*t1 + V8t2*t2 

PastRelationships_Before.3n | V9t1*t1 + V9t2*t2 
PastRelationships.3n        | V9t1*t1 + V9t2*t2 

GetAlongParents_Before.3n | V10t1*t1 + V10T1t2*t2 
GetAlongParents.3n        | V10t1*t1 + V10t2*t2 

FriendshipsAreLike_Before.3n | V11t1*t1 + V11t2*t2 
FriendshipsAreLike.3n        | V11t1*t1 + V11t2*t2 

 

Fights_Before.3n | V12t1*t1 + V12t2*t2 
Fights.3n        | V12t1*t1 + V12t2*t2 

FeelingsHurt_Before.3n | V13t1*t1 + V13t2*t2 
FeelingsHurt.3n        | V13t1*t1 + V13t2*t2 

RightandWrong_Before.3n | V14t1*t1 + V14t2*t2 
RightandWrong.3n        | V14t1*t1 + V14t2*t2 

 
# Intercepts
# Fix all intercepts to zero

Healthy_Rel_Before.3n + Communicate_Before.3n + ConflictManagement_Before.3n ~ 0*1
Healthy_Rel.3n + Communicate.3n + ConflictManagement.3n ~ 0*1
                 
RightPartner_Before.3n + LearnPartner_Before.3n + PaceRelationship_Before.3n +  WarningSigns_Before.3n ~ 0*1
RightPartner.3n + LearnPartner.3n + PaceRelationship.3n +  WarningSigns.3n ~ 0*1

LearnedGrowingUp_Before.3n + PastRelationships_Before.3n + GetAlongParents_Before.3n + FriendshipsAreLike_Before.3n ~ 0*1
LearnedGrowingUp.3n + PastRelationships.3n + GetAlongParents.3n + FriendshipsAreLike.3n ~ 0*1

Fights_Before.3n + FeelingsHurt_Before.3n + RightandWrong_Before.3n  ~ 0*1
Fights.3n + FeelingsHurt.3n + RightandWrong.3n  ~ 0*1


# Unique variances
# Fix unique variances at T1 to 1.00

Healthy_Rel_Before.3n  ~~ 1*Healthy_Rel_Before.3n
Communicate_Before.3n  ~~ 1*Communicate_Before.3n
ConflictManagement_Before.3n ~~ 1*ConflictManagement_Before.3n

RightPartner_Before.3n ~~ 1*RightPartner_Before.3n
LearnPartner_Before.3n ~~ 1*LearnPartner_Before.3n
PaceRelationship_Before.3n ~~ 1*PaceRelationship_Before.3n
WarningSigns_Before.3n ~~ 1*WarningSigns_Before.3n

LearnedGrowingUp_Before.3n ~~ 1*LearnedGrowingUp_Before.3n
PastRelationships_Before.3n ~~ 1*PastRelationships_Before.3n
GetAlongParents_Before.3n ~~ 1*GetAlongParents_Before.3n
FriendshipsAreLike_Before.3n ~~ 1*FriendshipsAreLike_Before.3n

Fights_Before.3n ~~ 1*Fights_Before.3n
FeelingsHurt_Before.3n ~~ 1*FeelingsHurt_Before.3n
RightandWrong_Before.3n  ~~ 1*RightandWrong_Before.3n

# lavaan constrains all indicator unique variances to 1.00 by default
# Free this constraint at T2

Healthy_Rel.3n  ~~ 1*Healthy_Rel.3n
Communicate.3n  ~~ NA*Communicate.3n
ConflictManagement.3n ~~ 1*ConflictManagement.3n

RightPartner.3n ~~ 1*RightPartner.3n
LearnPartner.3n ~~ 1*LearnPartner.3n
PaceRelationship.3n ~~ 1*PaceRelationship.3n
WarningSigns.3n ~~ NA*WarningSigns.3n

LearnedGrowingUp.3n ~~ NA*LearnedGrowingUp.3n
PastRelationships.3n ~~ 1*PastRelationships.3n
GetAlongParents.3n ~~ NA*GetAlongParents.3n
FriendshipsAreLike.3n ~~ 1*FriendshipsAreLike.3n

Fights.3n ~~ 1*Fights.3n
FeelingsHurt.3n ~~ 1*FeelingsHurt.3n
RightandWrong.3n  ~~ 1*RightandWrong.3n


# Lagged unique factor covariances

Healthy_Rel_Before.3n  ~~ Healthy_Rel.3n
Communicate_Before.3n  ~~ Communicate.3n
ConflictManagement_Before.3n ~~ ConflictManagement.3n

RightPartner_Before.3n ~~ RightPartner.3n
LearnPartner_Before.3n ~~LearnPartner.3n
PaceRelationship_Before.3n ~~ PaceRelationship.3n
WarningSigns_Before.3n ~~ WarningSigns.3n

LearnedGrowingUp_Before.3n ~~ LearnedGrowingUp.3n
PastRelationships_Before.3n ~~ PastRelationships.3n
GetAlongParents_Before.3n ~~ GetAlongParents.3n
FriendshipsAreLike_Before.3n ~~ FriendshipsAreLike.3n

Fights_Before.3n ~~ Fights.3n
FeelingsHurt_Before.3n ~~ FeelingsHurt.3n
RightandWrong_Before.3n  ~~ RightandWrong.3n

ConflictManagement.3n	~~	RightPartner.3n


'

# fit the model
Fit.Rcomb.model.c2.unique2 <- lavaan::cfa(Rcomb.model.c2.unique2, 
                              data=(Jail_clean %>% 
                                        dplyr::filter(in.analysis.sample3 == TRUE)),
                              estimator = "WLSMV",
                              ordered = c("Healthy_Rel_Before.3n" , "Communicate_Before.3n" ,
                                          "ConflictManagement_Before.3n",
                                          "RightPartner_Before.3n", "LearnPartner_Before.3n",
                                          "PaceRelationship_Before.3n",  "WarningSigns_Before.3n",
                                          "LearnedGrowingUp_Before.3n", "PastRelationships_Before.3n",
                                          "GetAlongParents_Before.3n", "FriendshipsAreLike_Before.3n",
                                          "Fights_Before.3n", "FeelingsHurt_Before.3n",
                                          "RightandWrong_Before.3n",
                                          
                                          "Healthy_Rel.3n" , "Communicate.3n" ,
                                          "ConflictManagement.3n",
                                          "RightPartner.3n", "LearnPartner.3n",
                                          "PaceRelationship.3n",  "WarningSigns.3n",
                                          "LearnedGrowingUp.3n", "PastRelationships.3n",
                                          "GetAlongParents.3n", "FriendshipsAreLike.3n",
                                          "Fights.3n", "FeelingsHurt.3n",
                                          "RightandWrong.3n"),
                               parameterization = "theta")

# display summary output
lavaan::summary(Fit.Rcomb.model.c2.unique2, fit.measures=TRUE, standardized=TRUE )
```

\newpage

### Modification Indices

```{r, echo = FALSE}
lavaan::modificationindices(Fit.Rcomb.model.c2.unique2) %>% 
    data.frame() %>% 
    dplyr::filter(mi>10) %>% 
    dplyr::arrange(-mi)
    
```

### Model Comparison
```{r}
lavaan::anova(Fit.Rcomb.model.c2.thresh2, Fit.Rcomb.model.c2.unique2)
```

\newpage

## Saving Factor Scores

### Final Model

```{r, echo=FALSE}

Jail_clean.fscores.data <- Jail_clean %>% 
                                        dplyr::filter(in.analysis.sample3 == TRUE) %>% 
                                        dplyr::filter(complete.cases(Healthy_Rel_Before.3n , 
                                                                     Communicate_Before.3n ,
                                          ConflictManagement_Before.3n,
                                          RightPartner_Before.3n, LearnPartner_Before.3n,
                                          PaceRelationship_Before.3n,  WarningSigns_Before.3n,
                                          LearnedGrowingUp_Before.3n, PastRelationships_Before.3n,
                                          GetAlongParents_Before.3n, FriendshipsAreLike_Before.3n,
                                          Fights_Before.3n, FeelingsHurt_Before.3n,
                                          RightandWrong_Before.3n,
                                          
                                          Healthy_Rel.3n , Communicate.3n ,
                                          ConflictManagement.3n,
                                          RightPartner.3n, LearnPartner.3n,
                                          PaceRelationship.3n,  WarningSigns.3n,
                                          LearnedGrowingUp.3n, PastRelationships.3n,
                                          GetAlongParents.3n, FriendshipsAreLike.3n,
                                          Fights.3n, FeelingsHurt.3n,
                                          RightandWrong.3n))



# specify the model
Rcomb.model.c2.final <- ' 

# Latent common factor definitions

HSP.rpre =~ Healthy_Rel_Before.3n + HSPL2*Communicate_Before.3n + 
            HSPL3*ConflictManagement_Before.3n +
            HSPL4*RightPartner_Before.3n + HSPL5*LearnPartner_Before.3n + 
            HSPL6*PaceRelationship_Before.3n +  HSPL7*WarningSigns_Before.3n
HSP.post =~ Healthy_Rel.3n + HSPL2*Communicate.3n +   
            HSPL3*ConflictManagement.3n +
            HSPL4*RightPartner.3n + HSPL5*LearnPartner.3n + 
            HSPL6*PaceRelationship.3n + HSPL7*WarningSigns.3n

PBA.rpre =~ LearnedGrowingUp_Before.3n + PBAL2*PastRelationships_Before.3n + 
            PBAL3*GetAlongParents_Before.3n + PBAL4*FriendshipsAreLike_Before.3n +
            PBAL5*Fights_Before.3n + PBAL6*FeelingsHurt_Before.3n + PBAL7*RightandWrong_Before.3n 
PBA.post =~ LearnedGrowingUp.3n + PBAL2*PastRelationships.3n + 
            PBAL3*GetAlongParents.3n + PBAL4*FriendshipsAreLike.3n +
            PBAL5*Fights.3n + PBAL6*FeelingsHurt.3n + PBAL7*RightandWrong.3n 

# Communicate_Before.3n ~~ ConflictManagement_Before.3n
# Communicate.3n ~~ ConflictManagement.3n
# 
# PastRelationships_Before.3n ~~ GetAlongParents_Before.3n + FriendshipsAreLike_Before.3n
# GetAlongParents_Before.3n ~~ FriendshipsAreLike_Before.3n
# PastRelationships.3n ~~ GetAlongParents.3n + FriendshipsAreLike.3n
# GetAlongParents.3n ~~ FriendshipsAreLike.3n

# Latent common factor variances and covariances

HSP.rpre ~~ HSP.rpre + HSP.post + PBA.rpre + PBA.post
HSP.post ~~ HSP.post + PBA.rpre + PBA.post
PBA.rpre ~~ PBA.rpre + PBA.post
PBA.post ~~ PBA.post

# Latent common factor means
# Fix factor means to zero

HSP.rpre ~ 0*1
# Freely estimate T2-T4 common factor means
HSP.post ~ 1 
PBA.rpre ~ 1 
PBA.post ~ 1 


# Thresholds
# t1 and t2 after * represent the first and second 
#    thresholds of an indicator, respectively
# Threshold parameters that are freely estimated have labels VaTbtc,
#   with a representing indicator number, b representing time,
#   c representing ordering of the threshold (first, second)
# Threshold parameters that are constrained to be equal over time
#   are given the labels Vatc, with a representing indicator number, 
#   c representing ordering of the threshold (first, second)

Healthy_Rel_Before.3n | V1t1*t1 + V1t2*t2 
Healthy_Rel.3n        | V1t1*t1 + V1t2*t2 

Communicate_Before.3n | V2t1*t1 + V2t2*t2 
Communicate.3n        | V2t1*t1 + V2t2*t2 

ConflictManagement_Before.3n | V3t1*t1 + V3t2*t2 
ConflictManagement.3n        | V3t1*t1 + V3t2*t2 


RightPartner_Before.3n | V4t1*t1 + V4t2*t2 
RightPartner.3n        | V4t1*t1 + V4t2*t2 

LearnPartner_Before.3n | V5t1*t1 + V5t2*t2 
LearnPartner.3n        | V5t1*t1 + V5t2*t2 

PaceRelationship_Before.3n | V6t1*t1 + V6t2*t2 
PaceRelationship.3n        | V6t1*t1 + V6t2*t2 

WarningSigns_Before.3n | V7t1*t1 + V7t2*t2 
WarningSigns.3n        | V7t1*t1 + V7t2*t2 



LearnedGrowingUp_Before.3n | V8t1*t1 + V8t2*t2 
LearnedGrowingUp.3n        | V8t1*t1 + V8t2*t2 

PastRelationships_Before.3n | V9t1*t1 + V9t2*t2 
PastRelationships.3n        | V9t1*t1 + V9t2*t2 

GetAlongParents_Before.3n | V10t1*t1 + V10T1t2*t2 
GetAlongParents.3n        | V10t1*t1 + V10t2*t2 

FriendshipsAreLike_Before.3n | V11t1*t1 + V11t2*t2 
FriendshipsAreLike.3n        | V11t1*t1 + V11t2*t2 

 

Fights_Before.3n | V12t1*t1 + V12t2*t2 
Fights.3n        | V12t1*t1 + V12t2*t2 

FeelingsHurt_Before.3n | V13t1*t1 + V13t2*t2 
FeelingsHurt.3n        | V13t1*t1 + V13t2*t2 

RightandWrong_Before.3n | V14t1*t1 + V14t2*t2 
RightandWrong.3n        | V14t1*t1 + V14t2*t2 

 
# Intercepts
# Fix all intercepts to zero

Healthy_Rel_Before.3n + Communicate_Before.3n + ConflictManagement_Before.3n ~ 0*1
Healthy_Rel.3n + Communicate.3n + ConflictManagement.3n ~ 0*1
                 
RightPartner_Before.3n + LearnPartner_Before.3n + PaceRelationship_Before.3n +  WarningSigns_Before.3n ~ 0*1
RightPartner.3n + LearnPartner.3n + PaceRelationship.3n +  WarningSigns.3n ~ 0*1

LearnedGrowingUp_Before.3n + PastRelationships_Before.3n + GetAlongParents_Before.3n + FriendshipsAreLike_Before.3n ~ 0*1
LearnedGrowingUp.3n + PastRelationships.3n + GetAlongParents.3n + FriendshipsAreLike.3n ~ 0*1

Fights_Before.3n + FeelingsHurt_Before.3n + RightandWrong_Before.3n  ~ 0*1
Fights.3n + FeelingsHurt.3n + RightandWrong.3n  ~ 0*1


# Unique variances
# Fix unique variances at T1 to 1.00

Healthy_Rel_Before.3n  ~~ 1*Healthy_Rel_Before.3n
Communicate_Before.3n  ~~ 1*Communicate_Before.3n
ConflictManagement_Before.3n ~~ 1*ConflictManagement_Before.3n

RightPartner_Before.3n ~~ 1*RightPartner_Before.3n
LearnPartner_Before.3n ~~ 1*LearnPartner_Before.3n
PaceRelationship_Before.3n ~~ 1*PaceRelationship_Before.3n
WarningSigns_Before.3n ~~ 1*WarningSigns_Before.3n

LearnedGrowingUp_Before.3n ~~ 1*LearnedGrowingUp_Before.3n
PastRelationships_Before.3n ~~ 1*PastRelationships_Before.3n
GetAlongParents_Before.3n ~~ 1*GetAlongParents_Before.3n
FriendshipsAreLike_Before.3n ~~ 1*FriendshipsAreLike_Before.3n

Fights_Before.3n ~~ 1*Fights_Before.3n
FeelingsHurt_Before.3n ~~ 1*FeelingsHurt_Before.3n
RightandWrong_Before.3n  ~~ 1*RightandWrong_Before.3n

# lavaan constrains all indicator unique variances to 1.00 by default
# Free this constraint at T2

Healthy_Rel.3n  ~~ 1*Healthy_Rel.3n
Communicate.3n  ~~ NA*Communicate.3n
ConflictManagement.3n ~~ 1*ConflictManagement.3n

RightPartner.3n ~~ 1*RightPartner.3n
LearnPartner.3n ~~ 1*LearnPartner.3n
PaceRelationship.3n ~~ 1*PaceRelationship.3n
WarningSigns.3n ~~ NA*WarningSigns.3n

LearnedGrowingUp.3n ~~ NA*LearnedGrowingUp.3n
PastRelationships.3n ~~ 1*PastRelationships.3n
GetAlongParents.3n ~~ NA*GetAlongParents.3n
FriendshipsAreLike.3n ~~ 1*FriendshipsAreLike.3n

Fights.3n ~~ 1*Fights.3n
FeelingsHurt.3n ~~ 1*FeelingsHurt.3n
RightandWrong.3n  ~~ 1*RightandWrong.3n


# Lagged unique factor covariances

Healthy_Rel_Before.3n  ~~ Healthy_Rel.3n
Communicate_Before.3n  ~~ Communicate.3n
ConflictManagement_Before.3n ~~ ConflictManagement.3n

RightPartner_Before.3n ~~ RightPartner.3n
LearnPartner_Before.3n ~~LearnPartner.3n
PaceRelationship_Before.3n ~~ PaceRelationship.3n
WarningSigns_Before.3n ~~ WarningSigns.3n

LearnedGrowingUp_Before.3n ~~ LearnedGrowingUp.3n
PastRelationships_Before.3n ~~ PastRelationships.3n
GetAlongParents_Before.3n ~~ GetAlongParents.3n
FriendshipsAreLike_Before.3n ~~ FriendshipsAreLike.3n

Fights_Before.3n ~~ Fights.3n
FeelingsHurt_Before.3n ~~ FeelingsHurt.3n
RightandWrong_Before.3n  ~~ RightandWrong.3n

ConflictManagement.3n	~~	RightPartner.3n


'

# fit the model
Fit.Rcomb.model.c2.final <- lavaan::cfa(Rcomb.model.c2.final, 
                              data=Jail_clean.fscores.data,
                              estimator = "WLSMV",
                              ordered = c("Healthy_Rel_Before.3n" , "Communicate_Before.3n" ,
                                          "ConflictManagement_Before.3n",
                                          "RightPartner_Before.3n", "LearnPartner_Before.3n",
                                          "PaceRelationship_Before.3n",  "WarningSigns_Before.3n",
                                          "LearnedGrowingUp_Before.3n", "PastRelationships_Before.3n",
                                          "GetAlongParents_Before.3n", "FriendshipsAreLike_Before.3n",
                                          "Fights_Before.3n", "FeelingsHurt_Before.3n",
                                          "RightandWrong_Before.3n",
                                          
                                          "Healthy_Rel.3n" , "Communicate.3n" ,
                                          "ConflictManagement.3n",
                                          "RightPartner.3n", "LearnPartner.3n",
                                          "PaceRelationship.3n",  "WarningSigns.3n",
                                          "LearnedGrowingUp.3n", "PastRelationships.3n",
                                          "GetAlongParents.3n", "FriendshipsAreLike.3n",
                                          "Fights.3n", "FeelingsHurt.3n",
                                          "RightandWrong.3n"),
                               parameterization = "theta")

# display summary output
lavaan::summary(Fit.Rcomb.model.c2.final, fit.measures=TRUE, standardized=TRUE )
```
\newpage

### Generating and Saving Factor Scores

```{r, echo = FALSE}

# lavaan::predict(Fit.Rcomb.model.c2.unique2)

Jail_clean.fscores.id <- Jail_clean.fscores.data %>% dplyr::select(ID)

Jail_clean.fscores <- Jail_clean.fscores.id %>% cbind(lavaan::predict(Fit.Rcomb.model.c2.final) %>% data.frame())


Jail_clean.fscores %>% 
    dplyr::select(-ID) %>% 
    furniture::table1()
# str(lavaan::predict(Fit.Rcomb.model.c2.final))

```

```{r, echo = FALSE}
Jail_clean.fscores %>% 
    dplyr::select(HSP.rpre, PBA.rpre,HSP.post,  PBA.post) %>% 
    furniture::tableC()

```

\newpage

### Long factor score data


```{r}
Jail_clean.fscore_long <- Jail_clean %>% 
    dplyr::left_join(Jail_clean.fscores, by = "ID") %>% 
    dplyr::filter(complete.cases(HSP.rpre, HSP.post, PBA.rpre, PBA.post)) %>% 
    dplyr::filter(in.analysis.sample3 == TRUE) %>% 
    dplyr::rename(HSPrpre = HSP.rpre,
                  HSPpost = HSP.post,
                  PBArpre = PBA.rpre,
                  PBApost = PBA.post) %>% 
    dplyr::select(ID, 
                  Age, 
                  `Age (Decades)`,
                  Age_Groups,
                  Ethnic_Code, 
                  Race_Dichotomous,
                  Education_collapsed,
                  Education_3cat,
                  Prior_RshpEducation,
                  Prior_RshpEducation_collapsed,
                  FinancialWorry_cat,
                  Income,
                  `Income (10K)`,
                  Number_Attended,
                  Dosage,
                  Gender,
                  Divorced_Dichotomous,
                  HSPrpre, HSPpost, PBArpre, PBApost) %>% 
    tidyr::gather(key = var,
                  value = Score,
                  HSPrpre, HSPpost, PBArpre, PBApost) %>% 
    tidyr::separate(col = var, into = c("Domain","Time"), sep = -4) %>%  
    dplyr::mutate_at(vars(ID,Domain, Time), factor) %>% 
    dplyr::arrange(ID, Domain, Time) %>% 
    dplyr::mutate(Time = factor(Time, 
                                levels = c("rpre", "post"))) %>% 
    dplyr::mutate(Age_Decades = `Age (Decades)`) %>% 
    dplyr::mutate(Income_10K = `Income (10K)`)

save(Jail_clean.fscore_long, file="./Data/Jail_clean.fscore_long.Rda")

```
